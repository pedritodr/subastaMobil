<!DOCTYPE html>
<html>

<head>
  <!--
        Personalice la directiva de seguridad de contenido en la etiqueta meta como sea necesario. Agregue "unsafe-inline" a default-src para permitir JavaScript insertado.
        Para obtener más detalles, consulte http://go.microsoft.com/fwlink/?LinkID=617521
    -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="viewport"
    content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
  <title>Subasta</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Bootstrap core CSS -->
  <link href="material_bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="material_bootstrap/css/mdb.min.css" rel="stylesheet">
  <!-- Your custom styles (optional) -->
  <link href="material_bootstrap/css/style.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <style>
    .timer {
      margin: 0 0 4px;
      font-family: Lato;
      color: #fff;
      display: inline-block;
      font-weight: 100;
      text-align: center;
      font-size: 30px;
    }

    .timer .conte {
      padding: 1px;
      border-radius: 3px;
      background: #8c1822;
      display: block;
      font-size: 14px;
      font-weight: 400;
      width: auto;
      opacity: 0.9;
      margin-left: 4px;
      margin-right: 4px;
    }

    .timer .smalltext {
      border-radius: 3px;
      color: #fff;
      font-size: 12px;
      font-weight: 500;
      display: block;
      padding: 1px;
      background: #2a3681;
      width: auto;
      margin-left: 4px;
      margin-right: 4px;
    }
  </style>
  <link rel="stylesheet" href="material/css/onsenui.css">
  <link rel="stylesheet" href="material/css/onsen-css-components.min.css">
  <script src="material/js/onsenui.min.js"></script>
</head>

<body style="background-color: #ebebeb;">
  <ons-navigator id="appNavigator" swipeable swipe-target-width="80px">
    <ons-page>
      <ons-splitter id="appSplitter">
        <ons-splitter-side id="sidemenu" page="sidemenu.html" swipeable side="left" collapse="" width="260px">
        </ons-splitter-side>
        <ons-splitter-content page="tabbar.html"></ons-splitter-content>
      </ons-splitter>
    </ons-page>
  </ons-navigator>
  <template id="sidemenu.html">
    <ons-page>
      <ons-toolbar style="background: #80232b;">
        <div class="center">
          <img style="height:55px; margin-left:28%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-list style="background-color: #ebebeb !important">
        <ons-list-item modifier="nodivider" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
          <div class="left" style="padding-bottom: 0px !important; margin-bottom: 0px !important;">
            <img style="height: 60px !important; width: 60px !important;" id="img_perfil" class="list-item__thumbnail"
              src="">
          </div>
          <div class="center" style="padding-bottom: 0px !important; margin-bottom: 0px !important;">
            <span id="user_menu" class="list-item__title text-center"></span><span style="font-size: 10px;"
              id="email_menu" class="list-item__subtitle text-center"></span>
            <span id="user-role" class="list-item__subtitle text-center"></span>
          </div>
        </ons-list-item>
        <ons-list-item style="margin-top: 0px !important; padding-top: 0px !important;" modifier="nodivider">
          <div class="center">
            <span style="font-size: 12px !important;" class="text-center">
              <ons-icon style="color:green" icon="fa-circle"></ons-icon>En-linea
            </span>
          </div>
        </ons-list-item>
        <ons-list-header style="background-color: #ebebeb !important"><span>General</span></ons-list-header>
        <ons-list-item expandable ripple>
          <span class="list-item__title">
            <ons-icon style="color:#80232b" icon="fa-user-o"></ons-icon> Perfil
          </span>
          <div class="expandable-content">
            <ons-list-item onclick="cargar_perfil();" modifier="nodivider" ripple>
              <span class="list-item__title">
                <ons-icon style="color:#80232b" icon="fa-id-card-o"></ons-icon> Datos de generales
              </span>
            </ons-list-item>
            <ons-list-item onclick="cargar_password();" modifier="nodivider" ripple>
              <span class="list-item__title">
                <ons-icon style="color:#80232b" icon="fa-lock"></ons-icon> Contraseña
              </span>
            </ons-list-item>
          </div>
        </ons-list-item>
        <ons-list-item id="membresia_adquirir_dash" style="display: none;" onclick="cargar_membresias()"
          modifier="nodivider" ripple>
          <span class="list-item__title">
            <ons-icon badge="7" style="color:#80232b" icon="fa-user-secret"></ons-icon> Adquirir Membresia
          </span>
        </ons-list-item>
        <ons-list-item id="membresia_user_dash" style="display: none;" modifier="nodivider" ripple
          onclick="cargar_membresia_user()">
          <span class="list-item__title">
            <ons-icon badge="7" style="color:#80232b" icon="fa-user-secret"></ons-icon> Membresia
          </span>
        </ons-list-item>
        <ons-list-item modifier="nodivider" ripple onclick="mis_anuncios()">
          <span class="list-item__title">
            <ons-icon badge="7" style="color:#80232b" icon="fa-briefcase"></ons-icon> Mis anuncios
          </span>
        </ons-list-item>
        <ons-list-item modifier="nodivider" ripple onclick="mis_subastas()">
          <span class="list-item__title">
            <ons-icon style="color:#80232b" icon="fa-trophy"></ons-icon> Mis subastas
          </span>
        </ons-list-item>
        <ons-list-item modifier="nodivider" ripple onclick="cargar_historial()">
          <span class="list-item__title">
            <ons-icon style="color:#80232b" icon="fa-line-chart"></ons-icon> Historial de pagos
          </span>
        </ons-list-item>
        <ons-list-item modifier="nodivider" ripple onclick="abrir_faqs()">
          <span class="list-item__title">
            <ons-icon style="color:#80232b" icon="fa-question-circle-o"></ons-icon> Faqs
          </span>
        </ons-list-item>

      </ons-list>
      <ons-bottom-toolbar>
        <ons-toolbar>
          <div class="left"></div>
          <div class="center"></div>
          <div class="right">
            <ons-button onclick="cerrar_session();" style="color:#80232b;" modifier="quiet">
              <ons-icon style="color:#80232b;" icon="fa-sign-out"></ons-icon><small>Cerrar sessión</small>
            </ons-button>
          </div>
        </ons-toolbar>
      </ons-bottom-toolbar>
    </ons-page>
  </template>
  <template id="tabbar.html">
    <ons-page id="tabbar-page">
      <ons-toolbar style="background: #8c1822;">
        <div class="center">
          <img style="height:55px; margin-left:28%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-toolbar-button onclick="fn.toggleMenu()">
            <ons-icon style="color: #fff !important" icon="ion-navicon, material:md-menu"></ons-icon>
          </ons-toolbar-button>
        </div>
      </ons-toolbar>
      <ons-tabbar style="background-color: #ebebeb !important" swipeable id="appTabbar" position="auto">
        <ons-tab label="Subastas" icon="ion-home" page="home.html" active></ons-tab>
        <ons-tab label="Anuncios" icon="ion-edit" page="anuncios.html"></ons-tab>
      </ons-tabbar>
    </ons-page>
  </template>
  <template id="home.html">
    <ons-page id="page1">
      <ons-pull-hook id="pull-hook">
        Cargando...
      </ons-pull-hook>
      <ons-row id="area_subastas" class="" style="margin:0px !important">
      </ons-row>
      <ons-bottom-toolbar>
        <ons-row>
          <ons-col width="33%">
            <p style="text-align: center;">
              <ons-button id="btn_directa_subasta" onclick="buscar_subastas_tipo(1)" style="color:#8c1822"
                modifier="quiet">
                <ons-icon icon="fa-arrow-circle-o-up"></ons-icon> Directas
              </ons-button>
            </p>
          </ons-col>
          <ons-col width="33%">
            <p style="text-align: center;">
              <ons-button id="btn_inversa_subasta" onclick="buscar_subastas_tipo(2)" style="color:#2a3681"
                modifier="quiet">
                <ons-icon icon="fa-arrow-circle-o-down"></ons-icon> Inversas
              </ons-button>
            </p>
          </ons-col>
          <ons-col width="33%">
            <p style="text-align: center">
              <ons-button onclick="buscar();" id="btn_filtros_subasta" style="color:#2a3681" modifier="quiet">
                <ons-icon icon="fa-bars"></ons-icon> Menú
              </ons-button>
            </p>
          </ons-col>
        </ons-row>
      </ons-bottom-toolbar>

    </ons-page>
  </template>
  <template id="anuncios.html">
    <ons-page id="page_anuncios">
      <ons-pull-hook id="pull-hook">
        Cargando...
      </ons-pull-hook>

      <ons-row id="area_anuncios" style="margin:0px !important">

      </ons-row>

      <!--     <ons-fab onclick="publicar_anuncio(null);" style="background-color: #2a3681 !important;" position="bottom right">
        <ons-icon style="color: #ffffff !important" icon="md-plus"></ons-icon>
      </ons-fab> -->
      <ons-bottom-toolbar>
        <ons-row>
          <ons-col width="50%">
            <p style="text-align: left">
              <ons-button onclick="buscar_anuncio();" id="btn_filtros_subasta" style="color:#2a3681" modifier="quiet">
                <ons-icon icon="fa-bars"></ons-icon> Menú
              </ons-button>
            </p>
          </ons-col>
          <ons-col width="50%">
            <p style="text-align: left">
              <ons-button onclick="publicar_anuncio(null);" id="btn_filtros_subasta" style="color:#2a3681"
                modifier="quiet">
                <ons-icon icon="fa-plus-circle"></ons-icon> Publicar anuncio
              </ons-button>
            </p>
          </ons-col>
          <!--   <ons-col width="33%">
          </ons-col> -->
        </ons-row>
      </ons-bottom-toolbar>
    </ons-page>
  </template>
  <template id="buscar.html">
    <ons-page id="page4">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-row id="body_buscador_subasta">
        <ons-col width="77%">
          <p style="text-align: center; margin-top: 15px;">
            <input style="background-color: #fff !important; width:100% !important;" id="autocomplete" type="search"
              value="" placeholder="Buscar subasta" class="search-input">
          </p>
        </ons-col>
        <ons-col width="23%">
          <p style="text-align: center; margin-top: 10%;">
            <ons-select id="select_tipo_subasta">
              <option value="0">Todas</option>
              <option value="1">Directa</option>
              <option value="2">Inversa</option>
            </ons-select>
          </p>
        </ons-col>
        <ons-col width="100%">
          <p style="text-align: center;">
            <ons-button onclick="mostrar_ciudades_subasta();" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-map-marker"></ons-icon>
              Ciudades
            </ons-button>
            <ons-button onclick="mostrar_categorias_subasta()" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-caret-right"></ons-icon>
              Categorias
            </ons-button>
            <ons-button onclick="mostrar_subcategorias_subasta()" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-caret-right"></ons-icon>
              Subcategorias
            </ons-button>
          </p>
          <!--    <ons-icon style="color:#80232b" icon="fa-map-marker"></ons-icon> <span id="span_ubicacion_subasta"
          style="color:#80232b"> Ciudades</span> -->
        </ons-col>
        <ons-col>
          <p style="text-align: center;">
            <ons-button onclick="buscar_palabra()" style="width: 98%;background:#80232b" modifier="large">Aplicar
              filtros</ons-button>
          </p>
        </ons-col>
        <!--     <div onclick="buscar_lista_ciudades()" class="center">
          <ons-icon style="color:#fff" icon="fa-map-marker"></ons-icon> <span id="span_ubicacion_subasta"
            style="color:#fff"> Tu ubicación</span>
        </div> -->
      </ons-row>
      <div class="center">
        <p id="cargando" style="display: none; text-align: center;">
          <ons-progress-circular indeterminate></ons-progress-circular>
        </p>
      </div>
      <ons-list id="lista_ciudades_subasta" style="display: none;">

      </ons-list>
      <ons-list id="lista_categorias_subasta" style="display: none;">

      </ons-list>
      <ons-list id="lista_subcategorias_subasta" style="display: none;">

      </ons-list>
      <ons-row id="area_autocomplete" style="margin:0px !important">
      </ons-row>
    </ons-page>
  </template>
  <template id="buscar_anuncio.html">
    <ons-page id="page_buscar_anuncio">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-row id="body_buscador_anuncio">
        <ons-col width="100%">
          <p style="text-align: center; margin-top: 15px;">
            <input style="background-color: #fff !important; width:100% !important;" id="autocomplete2" type="search"
              value="" placeholder="Buscar anuncio" class="search-input">
          </p>
        </ons-col>
        <ons-col width="100%">
          <p style="text-align: center;">
            <ons-button onclick="mostrar_ciudades_anuncio();" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-map-marker"></ons-icon>
              Ciudades
            </ons-button>
            <ons-button onclick="mostrar_categorias_anuncio()" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-caret-right"></ons-icon>
              Categorias
            </ons-button>
            <ons-button onclick="mostrar_subcategorias_anuncio()" style="background:#2a3681;font-size: 12px;">
              <ons-icon icon="fa-caret-right"></ons-icon>
              Subcategorias
            </ons-button>
          </p>
          <!--    <ons-icon style="color:#80232b" icon="fa-map-marker"></ons-icon> <span id="span_ubicacion_subasta"
          style="color:#80232b"> Ciudades</span> -->
        </ons-col>
        <ons-col>
          <p style="text-align: center;">
            <ons-button onclick="buscar_palabra_anuncio()" style="width: 98%;background:#80232b" modifier="large">
              Aplicar
              filtros</ons-button>
          </p>
        </ons-col>
        <!--     <div onclick="buscar_lista_ciudades()" class="center">
          <ons-icon style="color:#fff" icon="fa-map-marker"></ons-icon> <span id="span_ubicacion_subasta"
            style="color:#fff"> Tu ubicación</span>
        </div> -->
      </ons-row>

      <ons-list id="lista_ciudades_anuncio" style="display: none;">

      </ons-list>
      <ons-list id="lista_categorias_anuncio" style="display: none;">

      </ons-list>
      <ons-list id="lista_subcategorias_anuncio" style="display: none;">

      </ons-list>
      <ons-row id="area_autocomplete_anuncio" style="margin:0px !important">
      </ons-row>
    </ons-page>
  </template>
  <template id="perfil_cliente.html">
    <ons-page id="page_perfil_cliente">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-card>
        <div class="row">
          <div class="col-5">
            <img id="foto_perfil_usuario" src=""
              style="width: 120px;height: 120px;margin-top:10px;border-radius: 25px;margin-left: 10px;" />
          </div>
          <div class="col-7 text-center">
            <a style="width: 100%; background-color: #80232b !important;" onclick="tomar_foto();"
              class="btn btn-cyan"><i class="fa fa-camera"></i> Foto</a>
            <label>Tómate una foto donde aparezca tu
              rostro
              de una manera nítida.</label>
          </div>
        </div>
        <div class="md-form">
          <i class="fa fa-user prefix grey-text"></i>
          <input onchange="valida_name()" type="text" id="name_perfil" class="form-control input-text">
          <label for="name_perfil" class="font-weight-light active">Primer nombre</label>
        </div>
        <div class="md-form">
          <i class="fa fa-user-plus prefix grey-text"></i>
          <input onchange="valida_surname()" type="text" id="surname_perfil" class="form-control input-text">
          <label for="surname_perfil" class="font-weight-light active">Primer apellido</label>
        </div>
        <div class="md-form">
          <ons-row>
            <ons-col width="30%">
              <ons-select style="margin-top: 7%;" id="tipo_documento_perfil">
                <option value="1">Cédula</option>
                <option value="2">Pasaporte</option>
              </ons-select>
            </ons-col>
            <ons-col width="70%">
              <label style="margin-left: 32%;" for="cedula" class="font-weight-light active">Documento de
                identidad</label>
              <input type="text" id="cedula_perfil" class="form-control">
            </ons-col>
          </ons-row>
        </div>
        <!-- Material input email -->
        <div class="md-form">
          <i class="fa fa-phone prefix grey-text"></i>
          <input onchange="valida_phone()" type="text" id="phone_perfil" class="form-control input-phome">
          <label for="phone_perfil" class="font-weight-light active">Número de teléfono</label>
        </div>
        <div class="text-center py-4 mt-3">
          <button style="width: 100%; background-color: #80232b !important;" onclick="change_user_data();"
            id="btn-actualizar" class="btn btn-cyan" type="button">Actualizar
            perfil</button>
        </div>
      </ons-card>
    </ons-page>
  </template>
  <template id="contrasena.html">
    <ons-page id="page_contrasena">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-card>
        <div class="md-form">
          <i class="fa fa-lock prefix grey-text"></i>
          <input type="password" id="password_actual" class="form-control">
          <label for="password_actual" class="font-weight-light">Contraseña actual</label>
        </div>
        <div class="md-form">
          <i class="fa fa-lock prefix grey-text"></i>
          <input type="password" id="password_perfil" class="form-control">
          <label for="password" class="font-weight-light">Nueva contraseña</label>
        </div>
        <!-- Material input email -->
        <div class="md-form">
          <i class="fa fa-exclamation-triangle prefix grey-text"></i>
          <input type="password" id="repeat_password_perfil" class="form-control">
          <label for="repeat_password" class="font-weight-light">Repita la contraseña </label>
        </div>
        <div class="text-center py-4 mt-3">
          <button style="background-color: #80232b !important" onclick="change_password();" id="btn-actualizar"
            class="btn btn-cyan" type="button">Actualizar
            contraseña</button>
        </div>
      </ons-card>
    </ons-page>
  </template>
  <template id="categoria_subastas.html">
    <ons-page id="page_categoria">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-list-header id="area_categoria">
        <h3 style="color:#80232b" class="text-center">Categorias de subastas</h3>
      </ons-list-header>
    </ons-page>
  </template>
  <template id="categoria_anuncios.html">
    <ons-page id="page_categoria">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <div>
        <ons-list>
          <ons-list-header id="area_categoria_anuncio">
            <h3 style="color:#80232b" class="text-center">Categorias de anuncios</h3>
          </ons-list-header>
        </ons-list>
      </div>
      <!--   <div id="area_categoria_anuncio" class="row">
      </div> -->
    </ons-page>
  </template>
  <template id="categoria_anuncios_publicar.html">
    <ons-page id="page_categoria_publicar">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-icon onclick="siguiente_update_cat()" id="btn_update_cat"
            style="color:#fff !important;margin-right: 15% !important;font-size:24px; display:none"
            icon="md-arrow-forward">
          </ons-icon>
        </div>
      </ons-toolbar>
      <ons-list>
        <ons-list-header id="area_categoria_anuncio_publicar">
          <h3 style="color:#80232b" class="text-center">Selecciona la categoria</h3>
        </ons-list-header>
      </ons-list>
    </ons-page>
  </template>
  <template id="categoria_subasta_filtro.html">
    <ons-page id="page_categoria_subasta_filtro">
      <ons-toolbar>
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo_subasta.png" alt="">
        </div>
      </ons-toolbar>
      <div id="area_subastas_categorias">
      </div>
    </ons-page>
  </template>
  <template id="categoria_anuncio_filtro.html">
    <ons-page id="page_categoria_anuncio_filtro">
      <ons-toolbar>
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo_subasta.png" alt="">
        </div>
      </ons-toolbar>
      <div id="area_anuncio_categoria">
      </div>
    </ons-page>
  </template>
  <template id="detalle_subasta.html">
    <ons-page id="page_detalle_subasta">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-carousel style="margin:2px 7px 0px 7px !important" halfscreen swipeable auto-scroll overscrollable
        id="carousel_subasta">
      </ons-carousel>
      <ons-card id="card_detalle_subasta"
        style="display: none !important; padding-top:1px !important; margin-top: 1px !important;">
        <div class="card-body card-body-cascade text-center">
          <!-- Title -->
          <h5 style="color:#80232b !important; margin-top: 0px !important;" id="titulo_detalle" class="card-title">
            <strong></strong></h5>
          <!-- Subtitle -->
          <h6 style="color:#80232b !important;font-size:10px !important;" id="categoria_detalle"
            class="font-weight-bold indigo-text py-2">
          </h6>
          <!-- Text -->
          <p id="descripcion_detalle" class="card-text">
          </p>
          <h1 style="background-color:#80232b !important; font-size: 20px !important;padding: 2px !important;"
            id="inicial_detalle" class="badge">
          </h1>
          <p id="cierre_detalle" class="text-black-50 py-2">fecha de cierre</p>
          <ons-row style="margin-top: 4%; display:none;" id="win_subasta">
            <ons-col id="name_win">
            </ons-col>
          </ons-row>
        </div>
        <input name="" id="subasta_id" type="hidden" value="">
        <input name="" id="subasta_user_id" type="hidden" value="">
        <button style="width: 95% !important; background-color: #80232b !important; display: none;"
          onclick="pagar_subasta_inversa();" id="entrar_subasta" class="btn btn-cyan" type="button"><span><i
              class="fa fa-sign-in" aria-hidden="true"></i>
            Entrar a la subasta</span></button>
        <button style="display: none; width: 95% !important; background-color: #80232b !important;"
          onclick="subasta_directa_pujar();" id="pujar_subasta" class="btn btn-cyan" type="button"><span><i
              class="fa fa-hand-paper-o" aria-hidden="true"></i>
            Pujar</span></button>
        <button style="display: none; width: 95% !important; background-color: #80232b !important;"
          onclick="pagar_subasta_inversa_2();" id="pagar_subasta_directa" class="btn btn-cyan" type="button"><span><i
              class="fa fa-money" aria-hidden="true"></i>
            Pagar subasta</span></button>

      </ons-card>
    </ons-page>
  </template>
  <template id="detalle_anuncio.html">
    <ons-page id="page_detalle_anuncio">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-carousel style="margin:2px 7px 0px 7px !important" swipeable auto-scroll id="carousel_anuncio">
      </ons-carousel>
      <ons-card style="display: none !important; padding-top:1px !important; margin-top: 1px !important;"
        id="body_detalle_anuncio">
        <div class="card-body card-body-cascade text-center">
          <!-- Title -->
          <h5 style="color:#80232b !important; margin-top: 0px !important;" id="titulo_detalle_anuncio"
            class="card-title">
            <strong></strong></h5>
          <!-- Subtitle -->
          <h6 style="font-size:10px !important;" id="categoria_detalle_anuncio"
            class="font-weight-bold indigo-text py-2">
          </h6>
          <!-- Text -->
          <p id="descripcion_detalle_anuncio" class="card-text">
          </p>
          <p style="background-color:#80232b !important; font-size: 20px !important;" id="precio_anuncio" class="badge">
          </p>
          <a id="number_whatsaap" href="">
            <p style="color:#00bb2d !important" class="font-weight-bold indigo-text py-2"><span id="whatsapp"></span>
            </p>
          </a>
          <p id="direccion_anuncio" class="card-text">
          </p>
          <div class="google-maps-wrapper">
            <div id="google-maps-inner" class="google-maps-inner">
              <div id="map" class="google-maps">
              </div>
            </div>
          </div>
      </ons-card>
    </ons-page>
  </template>
  <template id="subcategorias.html">
    <ons-page id="page_subcategorias">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-icon onclick="siguiente_sub_update()" id="btn_update_sub"
            style="color:#fff !important;margin-right: 15% !important;font-size:24px; display:none"
            icon="md-arrow-forward">
          </ons-icon>
        </div>
      </ons-toolbar>
      <ons-list>
        <ons-list-header id="header_lista">
          <h3 style="color:#80232b" class="text-center">Selecciona la subcategoria</h3>
        </ons-list-header>
      </ons-list>
    </ons-page>
  </template>
  <template id="galeria.html">
    <ons-page id="page_galeria">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-icon id="btn_update_gal"
            style="color:#fff !important;margin-right: 15% !important;font-size:24px; display:none"
            icon="md-arrow-forward">
          </ons-icon>
        </div>
      </ons-toolbar>
      <ons-card>
        <h3 style="color:#80232b" class="text-center">Fotos del anuncio</h3>
        <div id="galeria_imagen" class="row">
        </div>
        <section style="padding: 8px">
          <ons-fab onclick="getImage();" style="background-color: #2a3681 !important;">
            <ons-icon style="color: #fff !important;" icon="md-folder"></ons-icon>
          </ons-fab>
          <ons-fab onclick="tomar_foto2();" style="background-color: #80232b !important;">
            <ons-icon style="color: #fff !important;" icon="md-camera"></ons-icon>
          </ons-fab>
        </section>
        <section style="padding: 8px">
          <ons-button id="btn_siguiente2" onclick="siguiente2();"
            style="width:100%; background-color: #80232b !important; display: none;" modifier="large">
            <ons-icon icon="md-arrow-right"></ons-icon> Siguiente
          </ons-button>
        </section>
      </ons-card>
    </ons-page>
  </template>
  <template id="formulario.html">
    <ons-page id="page_formulario">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-icon id="btn_update_form"
            style="color:#fff !important;margin-right: 15% !important;font-size:24px; display:none"
            icon="md-arrow-forward">
          </ons-icon>
        </div>
      </ons-toolbar>
      <ons-card>
        <!-- Material input text -->
        <div class="md-form">
          <i class="fa fa-tags prefix grey-text"></i>
          <input type="text" id="titulo_publicar" class="form-control">
          <label id="label_titulo" for="titulo_publicar" class="font-weight-light ">Título del anuncio</label>
        </div>
        <!-- Material input text -->
        <div class="md-form">
          <i class="fa fa-info prefix grey-text"></i>
          <textarea class="form-control" rows="5" id="descripcion_publicar"></textarea>
          <label id="label_descripcion" for="descripcion_publicar" class="font-weight-light ">Descripción del
            anuncio</label>
        </div>
        <!-- Material input email -->
        <div class="md-form">
          <i class="fa fa-whatsapp prefix grey-text"></i>
          <input type="number" id="phone_publicar" class="form-control">
          <label id="label_phone" for="phone_publicar" class="font-weight-light ">Teléfono de contacto</label>
        </div>
        <div class="md-form">
          <i class="fa fa-money prefix grey-text"></i>
          <input type="number" id="precio_publicar" class="form-control">
          <label id="label_precio" for="precio_publicar" class="font-weight-light ">Precio</label>
        </div>
        <section style="padding: 8px">
          <ons-button id="btn_siguiente" onclick="siguiente();"
            style="width:100%; background-color: #80232b !important;" modifier="large">
            <ons-icon icon="md-arrow-right"></ons-icon> Siguiente
          </ons-button>
        </section>
      </ons-card>
    </ons-page>
  </template>
  <template id="formulario_editar.html">
    <ons-page id="page_formulario_editar">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
        </div>
      </ons-toolbar>
      <ons-card>
        <!-- Material input text -->
        <div class="md-form">
          <p style="margin-left:10%" class="text-left">Subcategoria del anuncio</p>
          <div id="body_select_sub"></div>
        </div>
        <div class="md-form">
          <i class="fa fa-tags prefix grey-text"></i>
          <input type="text" id="titulo_publicar_edit" class="form-control">
          <label id="label_titulo_edit" for="titulo_publicar_edit" class="font-weight-light ">Título del anuncio</label>
        </div>
        <!-- Material input text -->
        <div class="md-form">
          <i class="fa fa-info prefix grey-text"></i>
          <textarea class="form-control" rows="5" id="descripcion_publicar_edit"></textarea>
          <label id="label_descripcion_edit" for="descripcion_publicar_edit" class="font-weight-light ">Descripción del
            anuncio</label>
        </div>
        <!-- Material input email -->
        <div class="md-form">
          <i class="fa fa-whatsapp prefix grey-text"></i>
          <input type="number" id="phone_publicar_edit" class="form-control">
          <label id="label_phone_edit" for="phone_publicar_edit" class="font-weight-light ">Teléfono de contacto</label>
        </div>
        <div class="md-form">
          <i class="fa fa-money prefix grey-text"></i>
          <input type="number" id="precio_publicar_edit" class="form-control">
          <label id="label_precio_edit" for="precio_publicar_edit" class="font-weight-light ">Precio</label>
        </div>
        <section style="padding: 8px">
          <ons-button id="btn_siguiente_edit" onclick="siguiente_edit();"
            style="width:100%; background-color: #80232b !important;" modifier="large">
            <ons-icon icon="md-arrow-right"></ons-icon> Siguiente
          </ons-button>
        </section>
      </ons-card>
    </ons-page>
  </template>
  <template id="mapa.html">
    <ons-page id="page_galeria">
      <ons-toolbar style="background: #8c1822;">
        <div class="left">
          <ons-back-button style="color:#80232b"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
        <div class="right">
          <ons-icon onclick="ubicacion_actual()" id="btn_update_map"
            style="color:#fff !important;margin-right: 15% !important;font-size:24px; display:none"
            icon="fa-street-view">
          </ons-icon>
        </div>
      </ons-toolbar>
      <div></div>
      <h3 style="color:#80232b;" class="text-center">Ubicación del anuncio</h3>
      <section>
        <div class="google-maps-wrapper">
          <div id="google-maps-inner" class="google-maps-inner">
            <div class="input-group">
              <input id="city_main" type="hidden" value="">
              <input style="width:100%;" id="pac-input" name="pac-input" class="controls input-sm form-control"
                type="text" placeholder="Escribe la dirección aqui">
            </div>
            <div style="width:100%; height:400px;" id="mapa" class="map">
            </div>
          </div>
        </div>
        <input type="hidden" id="lat" name="lat" />
        <input type="hidden" id="lng" name="lng" />
      </section>
      <section style="padding: 8px">
        <ons-button id="btn_culminar_anuncio" onclick="culminar_anuncio()"
          style="width:100%; background-color: #80232b !important;" modifier="large">
          <ons-icon icon="md-check"></ons-icon> Culminar
        </ons-button>
        <ons-button id="btn_actualizar_anuncio" onclick="actualizar_anuncio()"
          style="width:100%; background-color: #80232b !important;display: none;" modifier="large">
          <ons-icon icon="md-check"></ons-icon> Actualizar
        </ons-button>
      </section>
    </ons-page>
  </template>
  <template id="entrada.html">
    <ons-page id="page_entrada">
      <ons-toolbar>
        <div class="left">
          <ons-back-button style="color:#80232b !important;"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo_subasta.png" alt="">
        </div>
      </ons-toolbar>
      <h4 style="text-align: center;">Entrar a la subasta</h4>
      <ons-card>
        <section style="padding: 8px">
          <div id="valor_inicial_entrada">
          </div>
        </section>
        <section style="padding: 8px">
          <ons-button id="" onclick="pagar_entrada()" style="width:100%; background-color: #80232b !important;"
            modifier="large">
            <ons-icon icon="md-check"></ons-icon> Pagar Entrada
          </ons-button>
        </section>
      </ons-card>
    </ons-page>
  </template>
  <template id="adquirir_membresia.html">
    <ons-page id="page_adquirir_membresia">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button style="color:#fff !important"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <h4 style="text-align: center;">Adquirir membresia</h4>
      <div id="body_membresias">
      </div>
    </ons-page>
  </template>
  <template id="membresia_detalle.html">
    <ons-page id="page_detalle_membresia">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button style="color:#fff !important"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-card style="display: none;" id="card_infomacion_membresia">
        <div class="title">
          <h2 style="text-align: center; color:#80232b"> Información</h2>
          <h4 id="nombre_membresia" style="text-align: center; color:#80232b"> </h4>
        </div>
        <div class="content">
          <div id="descripcion_membresia" class="text-center">
          </div>
          <h4 id="anuncios_disponibles" style="text-align: center; color:#80232b"> </h4>
          <h4 id="subastas_disponibles" style="text-align: center; color:#80232b"> </h4>
        </div>
      </ons-card>
    </ons-page>
  </template>
  <template id="mis_anuncios.html">
    <ons-page id="page_mis_anuncios">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-icon id="btn_atras_ads_2" onclick="llamar_anuncios()"
            style="color:#fff !important;margin-left: 15% !important;font-size:24px;display:block" icon="md-arrow-back">
          </ons-icon>
          <!--  <ons-back-button id="btn_back_ads_2" style="color:#fff !important;display:block"></ons-back-button> -->
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-pull-hook id="pull-hook">
        Cargando...
      </ons-pull-hook>
      <ons-row id="area_mis_anuncios" class="" style="margin:0px !important">
      </ons-row>
      <ons-button onclick="publicar_anuncio(null);"
        style="background-color: #fff !important;position:fixed;bottom:0px;z-index: 1000;right:0px;color:#2a3681;">
        <ons-icon icon="md-plus"></ons-icon> Publicar anuncio
      </ons-button>

    </ons-page>
  </template>
  <template id="mis_pagos.html">
    <ons-page id="page_mis_paggos">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button style="color:#fff !important"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-pull-hook id="pull-hook">
        Cargando...
      </ons-pull-hook>
      <ons-list id="header_lista_pagos">

      </ons-list>
    </ons-page>
  </template>
  <template id="mis_subastas.html">
    <ons-page id="page_mis_subastas">
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-icon id="btn_atras_subasta" onclick="llamar_anuncios()"
            style="color:#fff !important;margin-left: 15% !important;font-size:24px;display:none" icon="md-arrow-back">
          </ons-icon>
          <ons-back-button id="btn_back_subasta" style="color:#fff !important"></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-pull-hook id="pull-hook">
        Cargando...
      </ons-pull-hook>
      <ons-row id="area_mis_subastas" class="" style="margin:0px !important">

      </ons-row>
    </ons-page>
  </template>
  <ons-modal id="modal_loading" direction="up">
    <div style="text-align: center">
      <p>
        <ons-progress-circular indeterminate></ons-progress-circular>
      </p>
      <p id="body_modal"></p>
    </div>
  </ons-modal>
  <ons-modal id="modal_confirmacion" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div id="title_confirmacion" style="color:#80232b" class="title text-center">
        Confirmación
      </div>
      <div id="body_mensaje_confirmacion" class="content">
      </div>
      <div class="content">
        <ons-row>
          <ons-col width="90%"><img style="width:100%;" src="images/logosEC.png" alt=""></ons-col>
          <ons-col width="10%"> <img style="width:85%;" src="images/mastercard_pay.png" alt="">
          </ons-col>
        </ons-row>
        <ons-row>
          <ons-col width="25%"></ons-col>
          <ons-col width="75%"><a href="https://www.placetopay.com"> <img style="width: 50%"
                src="images/placetopay-logo.svg" alt=""></a></ons-col>
          <ons-col width="25%"></ons-col>
        </ons-row>
        <!--       <ons-row id="body_condiciones" style="margin-top: 10%;">
          <ons-col width="10%">
            <div class="custom-control custom-checkbox text-center">
              <input type="checkbox" class="custom-control-input" id="selected_tc" checked />
              <label for="selected_tc-id">hola</label>
            </div>
          </ons-col>
            <ons-col width="90%">
            <ons-button onclick="abrir_terminos()" style="color:#80232b; font-size: 10px !important;" modifier="quiet">
              Acepto los términos y
              condiciones</ons-button>
          </ons-col>
        </ons-row> -->
        <ons-row id="body_condiciones" style="margin-top: 10%;">
          <ons-col width="10%">
            <div class="custom-control custom-checkbox text-center">
              <input type="checkbox" class="custom-control-input" id="selected_tc" checked />
              <label class="custom-control-label" for="selected_tc"></label>
            </div>
          </ons-col>
          <ons-col width="90%">
            <ons-button onclick="abrir_terminos()"
              style="color:#80232b; font-size: 12px !important; margin-top:8px !important" modifier="quiet">
              Acepto los términos y
              condiciones</ons-button>
          </ons-col>
        </ons-row>
        <ons-row style="margin-top: 10%;">
          <ons-col id="transaccion_pendiente" width="100%">
          </ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button id="btn_pagar_confirmacion" onclick="adquirir_confimacion()" style="color:#80232b; display: none"
          modifier="quiet">
          Pagar</ons-button>
        <ons-button id="btn_pagar_all" onclick="adquirir_subasta()" style="color:#80232b; display: none;"
          modifier="quiet">
          Pagar</ons-button>
        <ons-button id="btn_pagar_gratis" onclick="adquirir_subasta_gratis()" style="color:#80232b; display: none;"
          modifier="quiet">
          Pagar</ons-button>
        <ons-button onclick="close_confirmacion()" style="color:#80232b" modifier="quiet">Cancelar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
  <ons-modal id="modal_notificacion" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div id="title_confirmacion" style="color:#80232b" class="title text-center">
        Notificación
      </div>
      <div id="body_mensaje_notificacion" class="content">
        <h2 style="color:#008f39 " class="text-center" id="icono_notificacion"></h2>
        <h4 class="text-center" id="status_notificacion"></h4>
        <p class="text-center"><strong>Referencia de la Transacción: </strong></p>
        <p class="text-center" id="referencia_notificacion"></p>
        <p class="text-center" id="mensaje_notificacion"></p>
        <p class="text-center" id="product_adquirido"></p>
      </div>
      <div class="content">
        <ons-row>
          <ons-col width="90%"><img style="width:100%;" src="images/logosEC.png" alt=""></ons-col>
          <ons-col width="10%"> <img style="width:85%;" src="images/mastercard_pay.png" alt="">
          </ons-col>
        </ons-row>
        <ons-row>
          <ons-col width="25%"></ons-col>
          <ons-col width="75%"><a href="https://www.placetopay.com"> <img style="width: 50%"
                src="images/placetopay-logo.svg" alt=""></a></ons-col>
          <ons-col width="25%"></ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button id="btn_notificacion_inversa" onclick="mis_subastas()" style="color:#80232b" modifier="quiet">
          Aceptar</ons-button>
        <ons-button id="btn_notificacion_membresia" onclick="llamar_anuncios()" style="color:#80232b" modifier="quiet">
          Aceptar</ons-button>
        <ons-button id="btn_notificacion_piso" onclick="llamar_subasta_directa()" style="color:#80232b"
          modifier="quiet">
          Aceptar</ons-button>
        <ons-button id="btn_notificacion_aceptar" onclick="llamar_anuncios()" style="color:#80232b" modifier="quiet">
          Aceptar</ons-button>
        <ons-button id="btn_notificacion_desctacar" onclick="mis_anuncios()" style="color:#80232b" modifier="quiet">
          Aceptar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
  <ons-modal id="modal_puja" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div id="title_confirmacion" style="color:#80232b" class="title text-center">
        Pujar
      </div>
      <div class="content">
        <ons-row style="text-align: center; margin-top: 30px;" id="win_subasta_puja">
          <ons-col id="name_win_puja"> <i style="color:#80232b !important;font-size:40px !important;"
              class="fa fa-user"></i> Pedro Duran <span
              style="background: #00bb2d !important;font-size:14px !important;" class="badge badge-danger">
              $1000</span> <i style="color:#80232b !important;font-size:20px !important;" class="fa fa-trophy"></i>
          </ons-col>
        </ons-row>
        <div style="text-align: center; margin-top: 30px;">
          <p>
            <ons-input id="valor_puja_directa" modifier="underbar" type="number" placeholder="Valor de la puja" float>
            </ons-input>
          </p>
        </div>
      </div>
      <br>
      <p style="text-align: right; margin-top: 30px;">
        <ons-button id="btn_confirmar_puja" onclick="confirmar_puja()" style="color:#80232b" modifier="quiet">
          Pujar</ons-button>
        <ons-button id="btn_cancelar_puja" onclick="cancelar_puja()" style="color:#80232b" modifier="quiet">
          Cancelar</ons-button>

      </p>
    </ons-card>
  </ons-modal>
  <template id="action-sheet.html">
    <ons-action-sheet id="sheet" cancelable title="Acciones">
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_ver" icon="md-info-outline" onclick="">
        <span style="color:#858585 !important">Ver anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_update" icon="md-edit" onclick="">
        <span style="color:#858585 !important">Editar anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_destacar" icon="md-star-outline"
        onclick=""><span style="color:#858585 !important">Destacar anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_desactivar" icon="md-block" onclick="">
        <span style="color:#858585 !important">Desactivar anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_activar" icon="md-block" onclick="">
        <span style="color:#858585 !important">Activar anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" id="btn_acciones_eliminar" icon="md-delete" onclick="">
        <span style="color:#858585 !important">Eliminar anuncio</span>
      </ons-action-sheet-button>
      <ons-action-sheet-button style="color:#80232b !important" icon="md-close" onclick="app.hideFromTemplate()"><span
          style="color:#858585 !important">Cerrar</span>
      </ons-action-sheet-button>
    </ons-action-sheet>
  </template>
  <ons-modal id="modal_eliminar_ads" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div style="color:#80232b" class="title text-center">
        Confirmación
      </div>
      <div class="content">
        <ons-row>
          <ons-col>
            <p style="text-align: center" id="mensaje_eliminar"></p>
          </ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button onclick="eliminar_ads()" style="color:#80232b" modifier="quiet">
          Eliminar</ons-button>
        <ons-button onclick="close_eliminar_ads()" style="color:#80232b" modifier="quiet">Cancelar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
  <ons-modal id="modal_activar_ads" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div style="color:#80232b" class="title text-center">
        Confirmación
      </div>
      <div class="content">
        <ons-row>
          <ons-col>
            <p style="text-align: center" id="mensaje_activar"></p>
          </ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button onclick="activar_ads()" style="color:#80232b" modifier="quiet">
          Activar</ons-button>
        <ons-button onclick="close_activar_ads()" style="color:#80232b" modifier="quiet">Cancelar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
  <ons-modal id="modal_desactivar_ads" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div style="color:#80232b" class="title text-center">
        Confirmación
      </div>
      <div class="content">
        <ons-row>
          <ons-col>
            <p style="text-align: center" id="mensaje_desactivar"></p>
          </ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button onclick="desactivar_ads()" style="color:#80232b" modifier="quiet">
          Desactivar</ons-button>
        <ons-button onclick="close_desactivar_ads()" style="color:#80232b" modifier="quiet">Cancelar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
  <ons-modal id="modal_condiciones" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <ons-page style="overflow: hidden! Important; position: fixed! Important;padding:15px 15px !important">
        <div style="text-align:center;margin-left:5px;margin-right:5px;">
          <h5>Términos y Condiciones para el Uso de la Aplicación <b>“APP”</b></h5>
        </div>
        <h5 style="text-align:left;">PRODUCTOS</h5>
        <p style="text-align:justify;">SUBASTANUNCIOS se dedica a la publicación y promoción de anuncios y subastas
          sobre
          productos y/o servicios propiedad de terceros (Clientes Registrados) en Jacinto Egas #1459 y Río Morona,
          Ibarra, Ecuador. Desde la aplicación móvil “SUBASTANUNCIOS” bajo ninguna circunstancia se llevará a cabo la
          venta o promoción de productos o servicios ajenos a nuestro modelo de negocio, sobre todo aquellos productos
          que sean de venta prohibida por la legislación ecuatoriana. </p>
        <h5 class="text-left">FINALIDAD DEL PORTAL <a href="https://subastanuncios.com/portada">WWW.
            SUBASTANUNCIOS.COM</a> Y APP MÓVIL
        </h5>
        <p style="text-align:justify;">En nuestra página web y aplicaciones móviles damos información sobre todo aquello
          que
          puede interesar al cliente: promociones y ofertas de productos, anuncios, subastas directas e inversas,
          horarios y fechas, eventos, ubicación de comercios anunciantes, etc.</p>
        <h5 style="text-align:left;">CONDICIONES DE ACCESO Y UTILIZACIÓN</h5>
        <p style="text-align:justify;">El efectuar un acceso a la web y a aplicaciones móviles, e interactuar con los
          contenidos e información que en ellas se exponen, es responsabilidad exclusiva de los usuarios, y supone
          aceptar y conocer las advertencias legales, condiciones y términos de uso contenidos en ella. La
          Administración de SUBASTANUNCIOS no garantiza que los artículos, productos y/o servicios comercializados,
          estén disponibles en cualquier momento que se realice una compra. Si se diera el caso en que un cliente
          realizara la compra de un artículo en subasta, acepta que en caso de no proceder con la posterior compra
          (pago por el mismo) podría ser penalizado por SUBASTANUNCIOS.</p>
        <h5 style="text-align:left;">PAGOS</h5>
        <p style="text-align:justify;">El comprador podrá realizar los pagos por Transferencia Bancaria, o pago en línea
          con
          tarjetas de crédito o débito, para lo cual se emplea una pasarela de pago que realice operaciones dentro de
          Ecuador. De igual forma el usuario podrá utilizar PayPal, a la hora de realizar una compra. Para lograr
          estos fines, el usuario/cliente acepta que el prestador obtenga datos para efecto de la correspondiente
          autenticación de los controles de acceso. Todo proceso de contratación o que conlleve la introducción de
          datos personales, serán siempre transmitidos mediante protocolo de comunicación segura (HTTPS://) de tal
          forma que ningún tercero tenga acceso a la información transmitida vía electrónica. </p>
        <h5 style="text-align:left;">CALIDAD DE LOS DATOS </h5>
        <p style="text-align:justify;">Los usuarios deberán garantizar la veracidad, exactitud, autenticidad y vigencia
          de
          los datos de carácter personal que les hayan sido recogidos.</p>
        <h5 style="text-align:left;">PROTECCIÓN DE MENORES </h5>
        <p style="text-align:justify;">No recogemos datos personales ni aceptamos compras de menores. Es responsabilidad
          del
          padre/madre/tutor legal velar por la privacidad de los menores, haciendo todo lo posible para asegurar que
          han autorizado la recogida y el uso de los datos personales del menor.</p>
        <h5 style="text-align:left;">CONDICIONES DE COMPRA </h5>
        <p style="text-align:justify;">Los precios y condiciones de venta tienen un carácter meramente informativo y
          pueden
          ser modificados en atención a las fluctuaciones del mercado. No obstante, la realización del pedido (puja)
          en una subasta se confirmará una vez terminado el plazo de la misma. El castellano será la lengua utilizada
          para formalizar el contrato (en caso de requerirlo la operación). El documento electrónico en que se
          formalice el contrato se archivará y el usuario tendrá acceso a él por los diferentes medios de contacto.
        </p>
        <h5 style="text-align:left;">ENVÍO DE NOTIFICACIONES </h5>
        <p style="text-align:justify;">Los plazos de envío para una notificación antes el término de una subasta o
          evento de
          premios, oscilan entre las 72 horas y los 15 días. No podemos garantizar con exactitud la materialización de
          un plazo especifico pues depende en gran parte de la ubicación geográfica donde se encuentre el usuario a la
          cual se le hará llegar en formato físico las descripciones del procedimiento de subasta para proceder con la
          materialización de la compra-venta. </p>
        <h5 style="text-align:left;">DEVOLUCIONES </h5>
        <p style="text-align:justify;">SUBASTANUNCIOS no se responsabiliza por la calidad de los productos o servicios
          adquiridos mediante su plataforma, una vez que el cliente acepte que tiene la responsabilidad de garantizar
          y evaluar la calidad de los mismos durante el proceso de compra. </p>
        <h5 style="text-align:left;">CANCELACIONES DE PEDIDOS </h5>
        <p style="text-align:justify;">En aquellas cancelaciones de pedidos que impliquen una devolución de los derechos
          de
          compra por parte del usuario al cliente y que sean aceptadas por SUBASTANUNCIOS, se notificará vía correo
          electrónico al Usuario el hecho de que SUBASTANUNCIOS dispondrá de un plazo máximo de 30 días por trámites
          administrativos, si bien intentamos que el plazo no sea superior a 7 días.</p>
        <h5 style="text-align:left;">RESPONSABILIDADES DEL CLIENTE</h5>
        <p style="text-align:justify;">El Cliente se obliga a realizar un uso lícito de los servicios brindados en la
          aplicación, sin contravenir la legislación vigente, ni lesionar los derechos e intereses de terceras
          personas.
          El Cliente garantiza la veracidad y exactitud de los datos facilitados al cumplimentar los formularios de
          contratación, evitando que por su causa ocurran perjuicios en contra de los intereses de SUBASTANUNCIOS,
          especialmente como consecuencia de la incorrección de los mismos.
          El incumplimiento de cualquiera de las Condiciones de Uso podrá dar lugar a la retirada o cancelación de los
          servicios por parte de SUBASTANUNCIOS, sin necesidad de previo aviso al Cliente y sin que ello dé derecho a
          indemnización alguna (incluyendo cancelación de Perfiles de Usuario).
        </p>
        <h5 style="text-align:left;">SERVICIOS POSTVENTA</h5>
        <p style="text-align:justify;">Para cualquier consulta, incidencia, queja o reclamación tras la adquisición de
          los
          productos o servicios, SUBASTANUNCIOS pone a disposición del Cliente un Servicio de Atención al Cliente en
          el correo electrónico <a href="info@subastanuncios.com">info@subastanuncios.com</a> y el teléfono +(593)
          967133720.</p>
        <h5 style="text-align:left;">PROPIEDAD INDUSTRIAL E INTELECTUAL</h5>
        <p style="text-align:justify;">Los derechos de propiedad intelectual e industrial sobre las obras, marcas,
          logos, y
          cualquier otro susceptible de protección, contenidos en la Plataforma SUBASTANUNCIOS, propiedad de
          SUBASTANUNCIOS corresponden en exclusiva a SUBASTANUNCIOS (o a terceros autorizantes), a quien corresponde
          el ejercicio exclusivo de los derechos de explotación de los mismos en cualquier forma y, en especial, con
          carácter enunciativo y no limitativo, los derechos de reproducción, copia, distribución, transformación,
          comercialización, y comunicación pública. La reproducción, distribución, comercialización o transformación
          no autorizadas de tales obras, marcas, logos, etc., constituye una infracción de los derechos de propiedad
          intelectual e industrial de SUBASTANUNCIOS o del titular de los mismos, y podrá dar lugar al ejercicio de
          cuantas acciones judiciales o extrajudiciales les pudieran corresponder en el ejercicio de sus derechos.</p>
        <p style="text-align:justify;">Mediante la aceptación de las presentes Condiciones Generales de Contratación, el
          Cliente se compromete a respetar los derechos de Propiedad Industrial e Intelectual titularidad de
          SUBASTANUNCIOS y de terceros.</p>
        <h5 style="text-align:left;">JURISDICCIÓN Y LEY APLICABLE</h5>
        <p style="text-align:justify;">En el supuesto de que surja cualquier conflicto o discrepancia en la
          interpretación o
          aplicación de las presentes condiciones contractuales, los Juzgados y Tribunales que, en su caso, conocerán
          del asunto, serán los que disponga la normativa legal aplicable en materia de jurisdicción competente, en la
          que se atiende, tratándose de consumidores finales, al lugar del cumplimiento de la obligación o al del
          domicilio de la parte compradora.</p>
        <h5 style="text-align:left;">Nivel del Servicio</h5>
        <p style="text-align:justify;">SUBASTANUNCIOS realizará los esfuerzos necesarios para mantener el Servicio de
          Subastas y Anuncios se encuentre operativo en todo momento. Sin embargo, problemas técnicos pueden provocar
          interrupciones esporádicamente. Hay que tener en cuenta que la disponibilidad y la calidad del Servicio
          pueden variar en función de diversos factores, como pueden ser el dispositivo que se utilice, la ubicación
          geográfica del usuario, el ancho de banda disponible y/o la velocidad de la conexión a Internet, por lo que
          será responsabilidad del usuario asegurar que los sistemas e infraestructuras de los que dispone son los
          adecuados y necesarios para la correcta recepción del Servicio, así como la configuración de los mismos.
          SUBASTANUNCIOS no será responsable por las deficiencias o falta de disponibilidad del Servicio causadas por
          el usuario, por las deficiencias en el acceso a Internet o por cualquier otra causa fuera del control de
          SUBASTANUNCIOS</p>
        <p style="text-align:justify;">SUBASTANUNCIOS realizará de forma esporádica actualizaciones y tareas de
          mantenimiento
          del Servicio, durante las cuales es posible que el Servicio no esté disponible. SUBASTANUNCIOS intentará
          establecer las actualizaciones y tareas de mantenimiento fuera de las horas punta, nunca superior a 30
          minutos y no más de dos veces al mes. La falta de disponibilidad debido a actualizaciones y tareas de
          mantenimiento no dan derecho al usuario a ningún tipo de reembolso o compensación.</p>
        <br>
        <p style="text-align: right">
          <ons-button onclick="cerrar_terminos()" style="color:#80232b" modifier="quiet">Cerrar</ons-button>
        </p>
      </ons-page>
    </ons-card>
  </ons-modal>
  <template id="faqs.html">
    <ons-page>
      <ons-toolbar style="background: #80232b;">
        <div class="left">
          <ons-back-button></ons-back-button>
        </div>
        <div class="center">
          <img style="height:55px; margin-left:22%; margin-right: 25%; padding-bottom: 5px; padding-top: 5px;"
            src="images/logo-subasta-hor.png" alt="">
        </div>
      </ons-toolbar>
      <ons-card>
        <div style="text-align: center;" class="title">
          <h3 class="h4 text-center py-4">¿Pagos electrónicos?</h3>
        </div>
        <h5>1. ¿Qué es PlacetoPay?</h5>
        <p>
          PlacetoPay es la plataforma de pagos electrónicos que usa Subastanuncios.com para procesar en línea
          las
          transacciones generadas en la tienda virtual con las formas de pago habilitadas para tal fin.
        </p>
        <h5>2. ¿Cómo puedo pagar?</h5>
        <p>
          En la tienda virtual de Subastanuncios.com usted podrá realizar su pago con los medios habilitados
          para
          tal fin. Usted, de acuerdo a las opciones de pago escogidas por el comercio, podrá pagar a través
          (Diners, Discover, Visa y MasterCard); de todos los bancos con pago corriente y en los diferido,
          únicamente las tarjetas emitidas por Banco Pichincha, Diners, Loja, BGR y Manabí.
        </p>
        <h5>3. ¿Es seguro ingresar mis datos bancarios en este sitio web?</h5>
        <p>
          Para proteger tus datos Subastanuncios.com delega en PlacetoPay la captura de la información
          sensible.
          Nuestra plataforma de pagos cumple con los más altos estándares exigidos por la norma internacional
          PCI
          DSS de seguridad en transacciones con tarjeta de crédito. Además tiene certificado de seguridad SSL
          expedido por GeoTrust una compañía Verisign, el cual garantiza comunicaciones seguras mediante la
          encriptación de todos los datos hacia y desde el sitio; de esta manera, te podrás sentir seguro a la
          hora de ingresar la información de su tarjeta.
        </p>
        <p>
          Durante el proceso de pago, en el navegador se muestra el nombre de la organización autenticada, la
          autoridad que lo certifica y la barra de dirección cambia a color verde. Estas características son
          visibles de inmediato y dan garantía y confianza para completar la transacción en PlacetoPay.
        </p>
        <p> PlacetoPay también cuenta con el monitoreo constante de McAfee Secure y la firma de mensajes
          electrónicos con Certicámara.</p>
        <p> PlacetoPay es una marca de la empresa colombiana EGM Ingeniería Sin Fronteras S.A.S.</p>
        <h5>4. PlacetoPay es una marca de la empresa colombiana EGM Ingeniería Sin Fronteras S.A.S.</h5>
        <p>Sí, en Subastanuncios.com podrás realizar tus compras en línea los 7 días de la semana, las 24 horas
          del
          día a sólo un clic de distancia. </p>
        <h5>5. ¿Puedo cambiar la forma de pago?</h5>
        <p>Si aún no has finalizado tu pago, podrás volver al paso inicial y elegir la forma de pago que
          prefieras.
          Una vez finalizada la compra no es posible cambiar la forma de pago.</p>
        <h5>6. ¿Pagar electrónicamente tiene algún valor para mí como comprador? </h5>
        <p>No, los pagos electrónicos realizados a través de PlacetoPay no generan costos adicionales para el
          comprador. </p>
        <h5>7. ¿Qué debo hacer si mi transacción no concluyó?</h5>
        <p>En primera instancia deberás revisar si llegó un mail de confirmación del pago en tu cuenta de correo
          electrónico (la inscrita en el momento de realizar el pago), en caso de no haberlo recibido, deberás
          contactar a <a href="info@subastanuncios.com ">info@subastanuncios.com </a> para confirmar el estado
          de
          la transacción.</p>
        <p>En caso que tu transacción haya declinado, debes verificar si la información de la cuenta es válida,
          está
          habilitada para compras no presenciales y si tienes cupo o saldo disponible. Si después de esto
          continua
          con la declinación debes comunicarte con <a href="info@subastanuncios.com ">info@subastanuncios.com
          </a>. En última instancia, puedes remitir tu solicitud a <a
            href="servicioposventa@placetopay.ec">servicioposventa@placetopay.ec</a>. </p>
        <h5>8. ¿Qué debo hacer si no recibí el comprobante de pago?</h5>
        <p>Por cada transacción aprobada a través de PlacetoPay, recibirás un comprobante del pago con la
          referencia
          de compra en la dirección de correo electrónico que indicaste al momento de pagar. Si no lo recibes,
          podrás contactar a la línea +(593) 967133720 o al correo electrónico <a
            href="info@subastanuncios.com ">info@subastanuncios.com </a>, para solicitar el reenvío del
          comprobante a la misma dirección de correo electrónico registrada al momento de pagar. En última
          instancia, puedes remitir tu solicitud a <a
            href="servicioposventa@placetopay.ec">servicioposventa@placetopay.ec</a> . </p>
        <h5>9. No me llegó el producto que compré ¿qué hago?</h5>
        <p>Debes verificar si la transacción fue exitosa en tu extracto bancario. En caso de ser así, debes
          revisar
          nuestras políticas de envío en el sitio web <a
            href="https://subastanuncios.com/">https://subastanuncios.com/</a> para identificar los tiempos
          de
          entrega.</p>
      </ons-card>
    </ons-page>
  </template>
  <ons-modal id="modalComprarInversa" direction="up">
    <ons-card style="margin-left:6% !important; margin-right:6% !important;">
      <div style="color:#80232b" class="title text-center">
        Comprar
      </div>
      <div class="content">
        <ons-row>
          <ons-col>
            <h1 style="text-align: center" id="mensajeComprar"></h1>
           <b><h3 style="text-align: center" id="precioComprar"></h3></b>
          </ons-col>
        </ons-row>
        <ons-row id="body_condiciones" style="margin-top: 10%;">
          <ons-col width="10%">
            <div class="custom-control custom-checkbox text-center">
              <input type="checkbox" class="custom-control-input" id="selected_tc" checked />
              <label class="custom-control-label" for="selected_tc"></label>
            </div>
          </ons-col>
          <ons-col width="90%">
            <ons-button onclick="abrir_terminos()"
              style="color:#80232b; font-size: 12px !important; margin-top:8px !important" modifier="quiet">
              Acepto los términos y
              condiciones</ons-button>
          </ons-col>
        </ons-row>
      </div>
      <br>
      <p style="text-align: right">
        <ons-button onclick="comprarInversa()" style="color:#80232b" modifier="quiet">
          Lo quiero</ons-button>
        <ons-button onclick="closeComprarInversa()" style="color:#80232b" modifier="quiet">Cancelar</ons-button>
      </p>
    </ons-card>
  </ons-modal>
</body>
<!-- SCRIPTS -->
<!-- JQuery -->
<script type="text/javascript" src="material_bootstrap/js/jquery-3.3.1.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="material_bootstrap/js/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="material_bootstrap/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="material_bootstrap/js/mdb.min.js"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/urls.js"></script>
<script type="text/javascript" src="js/index_dash.js"></script>
<script type="text/javascript" src="js/popper.js"></script>
<script type="text/javascript" src="js/scroll_infinito.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0jIY1DdGJ7yWZrPDmhCiupu_K2En_4HY&libraries=places" async
  defer></script>
<script src="https://secure.placetopay.ec/redirection/lightbox.min.js"></script>

</html>
<script>
  //variables
  var scroll = 800;
  var final = 0;
  var id_confirmacion = null;
  var detalle_confirmacion = null;
  var valor_confirmacion = null;
  var lista;
  var imageURL = '';
  var item_auth = get_data_local();
  var modal = $('#modal_loading');
  var modal_notificacion = $('#modal_notificacion');
  var pullHook = document.getElementById('pull-hook2');
  var modal_confirmacion = $('#modal_confirmacion');
  var modal_puja_directa = $('#modal_puja');
  var modal_activar_ads = $('#modal_activar_ads');
  var modal_desactivar_ads = $('#modal_desactivar_ads');
  var modal_condiciones = $('#modal_condiciones');
  var modal_eliminar_ads = $('#modal_eliminar_ads');
  var modalComprarInversa = $('#modalComprarInversa');
  var page;
  var lat;
  var lng;
  var detalle_payment = null;
  var response_payment = null;
  var detalle_pago = null;
  var tipo_detalle = null;
  var puja_user_id = null;
  var valor_inicial = null;
  var valor_pago = null;
  var id = null;
  var monto = null;
  var subasta_id = null;
  var comienzo = null;
  var titulo_publicar = null;
  var descripcion_publicar = null;
  var phone_publicar = null;
  var precio_publicar = null;
  var subcategoria = null;
  var latidud = null;
  var longitud = null;
  var ciudad = null;
  var array_fotos = [];
  var contador = 1;
  var precio_inicial_subasta = 0;
  var detalle_inicial_subasta = null;
  var tipo_inicial_subasta = null;
  var subasta_activa_pay = null;
  var page_active = null;
  var puja_mayor = 0;
  var valida_modal_open = false;
  var comienza_mis_anuncios = null;
  var limite_mis_anuncios = null;
  var app = {};
  var valida_piso_gratis = false;
  var anuncio_objecto = null;
  var categoria_update = null;
  var subcategoria_update = null;
  var valida_categoria_update = false;
  var contador_fotos_id = 1;
  var valida_mis_anuncios = false;
  var ads_id = null;
  var ads_objet = null;
  var comienza_mis_subastas = 0;
  var comienza_buscar_subastas = 0;
  var limite_buscar_subastas = 11;
  var limite_mis_subastas = 11;
  var valido_subasta_pefil = false;
  var ubicacion_subasta = 0;
  var valida_buscar_subasta = false;
  var ubicacion_cargada_inicial = 0;
  var tipo_subasta_init = 1;
  var valida_infinito_anuncio = false;
  var categoria_filter_subasta = 0;
  var subcategoria_filter_subasta = 0;
  var ciudad_filter_subasta = 0;
  var ubicacion_filter_subasta = 0;
  var categoria_filter_anuncio = 0;
  var subcategoria_filter_anuncio = 0;
  var ciudad_filter_anuncio = 0;
  var ubicacion_filter_anuncio = 0;
  var ubicacion_anuncio = 0;
  var comienza_buscar_anuncio = 0;
  var valido_mis_subastas = false;
  var validar_terminos_condiciones = false;
  ons.ready(function () {
    ons.createElement('action-sheet.html', {
        append: true
      })
      .then(function (sheet) {
        app.showFromTemplate = sheet.show.bind(sheet);
        app.hideFromTemplate = sheet.hide.bind(sheet);
      });


  });

  function cerrar_terminos() {
    modal_condiciones.hide();
  }

  function abrir_terminos() {
    //   pushPage('#appNavigator', 'terminos.html', '');
    ///  validar_terminos_condiciones = true;
    //modal_confirmacion.hide();
    modal_condiciones.show();

  }

  function abrir_faqs() {
    pushPage('#appNavigator', 'faqs.html', '');
  }

  function buscar_subastas_tipo(tipo) {
    if (tipo == 1) {
      $('#btn_directa_subasta').css('color', '#8c1822');
      $('#btn_inversa_subasta').css('color', '#2a3681');
    } else {
      $('#btn_directa_subasta').css('color', '#2a3681');
      $('#btn_inversa_subasta').css('color', '#8c1822');
    }
    tipo_subasta_init = tipo;
    $('#area_subastas').hide();
    $('#body_modal').text("Cargando subasta...");
    modal.show();
    $('#area_subastas').empty();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/cargar_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      comienza = 0;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza,
        limite: limite,
        tipo: tipo_subasta_init
      };
      send_data_server(url, data_to_server, success_all_subastas,
        error);
    }, 1000);
  }

  function mi_ubicacion() {
    $('#lista_ciudades_subasta').hide();
    $('#body_buscador_subasta').show();
    $('.filter_ciudad').removeClass('ciudad_filter_subasta');
    $('#mi_ubicacion_subasta_inicial').addClass('ciudad_filter_subasta');
    $('#area_autocomplete').show();
    ubicacion_filter_subasta = ubicacion_subasta;
  }

  function mi_ubicacion_ads() {
    $('#lista_ciudades_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('.filter_ciudad_ads').removeClass('ciudad_filter_anuncio');
    $('#mi_ubicacion_ads_inicial').addClass('ciudad_filter_anuncio');
    $('#area_autocomplete_anuncio').show();
    ubicacion_filter_anuncio = ubicacion_anuncio;
  }

  function seleccion_ciudad(ciudad) {
    ciudad_filter_subasta = ciudad;
    $('.filter_ciudad').removeClass('ciudad_filter_subasta');
    $('#ciudad_subasta_' + ciudad).addClass('ciudad_filter_subasta');
    $('#lista_ciudades_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
  }

  function seleccion_ciudad_anuncio(ciudad) {
    ciudad_filter_anuncio = ciudad;
    $('.filter_ciudad_ads').removeClass('ciudad_filter_anuncio');
    $('#ciudad_anuncio_' + ciudad).addClass('ciudad_filter_anuncio');
    $('#lista_ciudades_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
  }

  function buscar_lista_ciudades() {
    modal.show();
    $('#body_modal').text("Cargando ciudades...");
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/ciudades';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_ciudades,
        error);
    }, 1000);
  }

  function success_ciudades(response) {
    var status = response.status;
    var lista_ciudades = response.lista;
    $('#lista_ciudades_subasta').empty();
    if (status == 200) {
      var cadena_ciudades =
        "<ons-list-item onclick=mi_ubicacion() modifier='chevron' tappable> <ons-icon icon='fa-street-view'></ons-icon> Tu ubicación</ons-list-item>";
      lista_ciudades.forEach(element => {
        cadena_ciudades += "<ons-list-item onclick=seleccion_ciudad('" + element.name_ciudad +
          "') modifier='chevron' tappable>" + element.name_ciudad + "</ons-list-item>"
      });
      $('#lista_ciudades_subasta').append(cadena_ciudades);
      modal.hide();
      $('#lista_ciudades_subasta').show();
      $('#body_buscador_subasta').hide();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No tiene pagos realizados.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }

  function cargar_historial() {
    pushPage('#appNavigator', 'mis_pagos.html', '');
    modal.show();
    $('#body_modal').text("Cargando historial de pagos...");
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_payment/mis_pagos';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        anuncio_id: ads_id
      };
      send_data_server(url, data_to_server, success_cargar_pagos,
        error);
    }, 1000);
  }

  function success_cargar_pagos(response) {
    var status = response.status;
    var lista_pagos = response.pagos;
    if (status == 200) {
      cargar_pagos(lista_pagos);
    }
    if (status == 500) {
      modal.hide();
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      modal.hide();
      $('#header_lista_pagos').empty();
      $('#header_lista_pagos').html("<h3 style='text-align: center;'>No tiene pagos realizados</h3>");

      navigator.notification.alert(
        'No tiene pagos realizados.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }

  }

  function cargar_pagos(lista_pagos) {

    $('#header_lista_pagos').empty();
    var cadena_pagos = "<ons-list-header>Historial de pagos</ons-list-header>";
    for (let i = 0; i < lista_pagos.length; i++) {
      var estado_pago = "";
      if (lista_pagos[i].status == 0) {
        estado_pago = "Nuevo pago";
      } else if (lista_pagos[i].status == 1) {
        estado_pago = "Aprobado";
      } else if (lista_pagos[i].status == 2) {
        estado_pago = "Cancelada por el cliente ó rechazada";
      } else if (lista_pagos[i].status == 3) {
        estado_pago = "Pendiente por aprobar";
      } else {
        estado_pago = "Reverso";
      }

      cadena_pagos = cadena_pagos + "<ons-list-item expandable>Referencia: " + lista_pagos[i].reference + " valor: $" +
        parseFloat(lista_pagos[i].monto).toFixed(2) +
        "<div class='expandable-content'><p style='text-align:center'>Estado: " + estado_pago +
        "</p><p style='text-align:center'>Detalle: " + lista_pagos[i].detalle +
        "</p><p style='text-align:center'>Fecha: " + lista_pagos[i].date + "</p></div></ons-list-item>";

    }
    $('#header_lista_pagos').append(cadena_pagos);
    modal.hide();
  }

  function acciones_anuncios(obj) {
    obj = atob(obj);
    obj = JSON.parse(obj);
    ads_objet = obj;
    if (obj.is_active == 1 && obj.destacado == 1) {
      $('#btn_acciones_ver').show();
      $('#btn_acciones_update').show();
      $('#btn_acciones_desactivar').show();
      $('#btn_acciones_destacar').hide();
      $('#btn_acciones_activar').hide();
      $('#btn_acciones_eliminar').show();
    }
    if (obj.is_active == 1 && obj.destacado == 0) {
      $('#btn_acciones_ver').show();
      $('#btn_acciones_update').show();
      $('#btn_acciones_desactivar').show();
      $('#btn_acciones_destacar').show();
      $('#btn_acciones_activar').hide();
      $('#btn_acciones_eliminar').show();
    }
    if (obj.is_active == 0) {
      $('#btn_acciones_ver').hide();
      $('#btn_acciones_update').hide();
      $('#btn_acciones_desactivar').hide();
      $('#btn_acciones_destacar').hide();
      $('#btn_acciones_activar').show();
      $('#btn_acciones_eliminar').show();
    }
    $('#btn_acciones_ver').attr('onclick', 'detalle_anuncio("' + obj.anuncio_id + '")');
    $('#btn_acciones_update').attr('onclick', 'editar_anuncio("' + btoa(JSON.stringify(obj)) + '")');
    $('#btn_acciones_desactivar').attr('onclick', 'desactivar_anuncio("' + btoa(JSON.stringify(obj)) + '")');
    $('#btn_acciones_destacar').attr('onclick', 'pagar_subasta_inversa()');
    $('#btn_acciones_activar').attr('onclick', 'activar_anuncio("' + btoa(JSON.stringify(obj)) + '")');
    $('#btn_acciones_eliminar').attr('onclick', 'eliminar_anuncio("' + btoa(JSON.stringify(obj)) + '")');
    app.showFromTemplate();
  }

  function desactivar_anuncio(obj) {
    obj = atob(obj);
    obj = JSON.parse(obj);
    $('#mensaje_desactivar').html("<p style='text-align:center'>¿Desactivar anuncio?</p><p style='text-align:center'>" +
      obj.titulo + "</p>");
    ads_id = obj.anuncio_id;
    modal_desactivar_ads.show();
    app.hideFromTemplate();
  }

  function eliminar_anuncio(obj) {
    obj = atob(obj);
    obj = JSON.parse(obj);
    $('#mensaje_eliminar').html("<p style='text-align:center'>Eliminar anuncio?</p><p style='text-align:center'>" +
      obj.titulo + "</p>");
    ads_id = obj.anuncio_id;
    modal_eliminar_ads.show();
    app.hideFromTemplate();
  }

  function close_desactivar_ads() {
    modal_desactivar_ads.hide();
  }

  function close_eliminar_ads() {
    modal_eliminar_ads.hide();
  }

  function activar_anuncio(obj) {
    obj = atob(obj);
    obj = JSON.parse(obj);
    $('#mensaje_activar').html("<p style='text-align:center'>¿Activar anuncio?</p><p style='text-align:center'>" +
      obj.titulo + "</p>");
    ads_id = obj.anuncio_id;
    modal_activar_ads.show();
    app.hideFromTemplate();
  }

  function close_activar_ads() {
    modal_activar_ads.hide();
  }

  function desactivar_ads() {
    modal_desactivar_ads.hide();
    modal.show();
    $('#body_modal').text("Desactivando anuncio...");
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/desactivar_anuncio';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        anuncio_id: ads_id
      };
      send_data_server(url, data_to_server, success_desactivar_ads,
        error);
    }, 1000);
  }

  function eliminar_ads() {
    modal_eliminar_ads.hide();
    modal.show();
    $('#body_modal').text("Eliminando anuncio...");
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/delete';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        anuncio_id: ads_id
      };
      send_data_server(url, data_to_server, success_eliminar_ads,
        error);
    }, 1000);
  }

  function success_eliminar_ads(response) {
    var status = response.status;
    if (status == 200) {
      valida_mis_anuncios = true;
      navigator.notification.alert(
        'Anuncio eliminado correctamente', // message
        mis_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrio un problema en la eliminación del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }

  }

  function success_desactivar_ads(response) {
    var status = response.status;
    if (status == 200) {
      valida_mis_anuncios = true;
      navigator.notification.alert(
        'Anuncio desactivado correctamente', // message
        mis_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrio un problema en la actualización del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }

  }

  function activar_ads() {
    modal_activar_ads.hide();
    modal.show();
    $('#body_modal').text("Activando anuncio...");
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/activar_anuncio';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        anuncio_id: ads_id
      };
      send_data_server(url, data_to_server, success_activar_ads,
        error);
    }, 1000);
  }

  function success_activar_ads(response) {
    var status = response.status;
    if (status == 200) {
      valida_mis_anuncios = true;
      navigator.notification.alert(
        'Anuncio activado correctamente', // message
        mis_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrio un problema en la actualización del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }

  }
  //carga cuando se ejecuta antes del cambio
  document.addEventListener('preopen', function (event) {
    buscar_membresia_user();
  });
  //carga cuando se ejecuta un cambio previo
  document.addEventListener('prechange', function (event) {
    //document.querySelector('ons-toolbar .center').innerHTML = event.tabItem.getAttribute('label');
    var etiqueta = null;
    if (event.tabItem) {
      var etiqueta = event.tabItem.getAttribute('label');
    }
    if (etiqueta == "Subastas") {
      comienza2 = 0;
      item_auth = get_data_local();
      $('#area_subastas').hide();
      $('#body_modal').text("Cargando subastas...");
      modal.show();
      $('#area_subastas').empty();
      setTimeout(function () {
        var url = base_url + 'rest_subasta/cargar_subastas';
        var user_id = item_auth.user_id;
        comienza = 0;
        var security_token = item_auth.security_token;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          comienza: comienza,
          limite: limite,
          tipo: tipo_subasta_init
        };
        send_data_server(url, data_to_server, success_all_subastas,
          error);
      }, 1000);
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito();
          done();
        }, 1000);
      }
    }
    if (etiqueta == "Anuncios") {
      comienza = 0;
      valida_infinito_anuncio = false;
      $('#area_anuncios').hide();
      modal.show();
      $('#body_modal').text("Cargando anuncios...");
      $('#area_anuncios').empty();
      var item_auth = get_data_local();
      console.log("csm ok")
      setTimeout(function () {
        var url = base_url + 'rest_anuncio/cargar_anuncios';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        comienza2 = 0;
        limite2 = 11;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          comienza: comienza2,
          limite: limite2
        };
        send_data_server(url, data_to_server, success_all_anuncios,
          error);
      }, 1000);
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito_anuncio();

          done();
        }, 1000);
      }
    }

  });
  //carga despues que se carga la app
  document.addEventListener('postchange', function (event) {
    // console.log(event);
  });
  //carga durante el incio de la app
  var pag_subasta = null;
  document.addEventListener('init', function (event) {

    item_auth = get_data_local();
    page = event.target;
    //   console.log(page);
    page_active = page.id;
    if (page.id == "page1") {
      comienza2 = 0;
      $('#area_subastas').empty();
      $('#body_modal').text("Cargando subastas...");
      modal.show();
      setTimeout(function () {
        var url = base_url + 'rest_subasta/cargar_subastas';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          comienza: comienza,
          limite: limite,
          tipo: tipo_subasta_init
        };
        send_data_server(url, data_to_server, success_all_subastas,
          error);
      }, 1000);
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito();
          done();
        }, 1000);
      }
      //buscar membresia
      buscar_membresia_user();
    }
    if (page.id == "page_perfil_cliente") {
      var item_auth = get_data_local();
      $("#name_perfil").val(item_auth.name);
      $('#surname_perfil').val(item_auth.surname);
      $("#cedula_perfil").val(item_auth.cedula);
      $("#tipo_documento_perfil").val(item_auth.tipo_documento);
      $("#phone_perfil").val(item_auth.phone);
      if (item_auth.photo) {
        var imageURL = item_auth.photo;
        let valido = imageURL.indexOf("uploads");
        if (valido > 0) {
          $('#foto_perfil_usuario').attr("src", url_photo + imageURL);
        } else {
          $('#foto_perfil_usuario').attr("src", imageURL);
        }
      } else {
        var imageURL = "images/icon_profile_dash.png";
        $("#foto_perfil_usuario").attr("src", "images/icon_profile_dash.png");
      }
    }
    if (page.id == "page_anuncios") {
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito_anuncio();
          done();
        }, 1000);
      }
    }
    if (page.id == "page_buscar_anuncio") {
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito_buscar_palabra_anuncio();
          done();
        }, 1000);

      }
    }
    if (page.id == "page_mis_subastas") {
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito_mis_subastas();
          done();
        }, 1000);

      }
    }
    if (page.id == "page4") {
      page.onInfiniteScroll = function (done) {
        setTimeout(() => {
          infinito_buscar_palabra();
          done();
        }, 1000);
      }
    }

    var prev = function () {
      var carousel = document.getElementById('carousel');
      carousel.prev();
    };

    var next = function () {
      var carousel = document.getElementById('carousel');
      carousel.next();
    };
    /*     document.querySelector('ons-back-button').onClick = function(event) {


    }; */

  });
  //valida el input phone
  function valida_phone() {
    var phone = $("#phone_perfil").val();
    ValidatePhone(phone);
  }
  //valida el input name
  function valida_name() {
    let texto = $('#name_perfil').val();
    texto = texto.trim();
    texto = texto.split(" ");
    if (texto.length > 1) {
      texto = texto[0];
    } else {
      texto = texto[0];
    }
    $('#name_perfil').val(texto);
    ValidateName(texto);
  }
  //valida el input surname
  function valida_surname() {
    let texto = $('#surname_perfil').val();
    texto = texto.trim();
    texto = texto.split(" ");
    if (texto.length >= 2) {
      texto = texto[0] + " " + texto[1];
    } else {
      texto = texto[0];
    }
    $('#surname_perfil').val(texto);
    ValidateSurname(texto);
  }
  //funcion que valida el input phone
  function ValidatePhone(phone) {
    var regex = /^[0-9+ ]+$/;
    valido = regex.test(phone.trim());
    if (valido) {
      $('#phone_perfil').val(phone.trim());
    } else {
      $('#phone_perfil').val("");
      $('#phome_perfil').focus();
      navigator.notification.alert(
        'Formato del teléfono es incorrecto', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que valida el input name
  function ValidateName(name) {
    var regex = /^[a-zA-ZáéíóúñüàèÑ ]+$/;
    valido = regex.test(name.trim());
    if (valido) {
      $('#name_perfil').val(name.trim());
    } else {
      $('#name_perfil').val("");
      $('#name_perfil').focus();
      navigator.notification.alert(
        'Formato del nombre es incorrecto', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que valida el input surname
  function ValidateSurname(surname) {
    var regex = /^[a-zA-ZáéíóúñüàèÑ ]+$/;
    valido = regex.test(surname.trim());
    if (valido) {
      $('#surname_perfil').val(surname.trim());
    } else {
      $('#surname_perfil').val("");
      $('#surname_perfil').focus();
      navigator.notification.alert(
        'Formato del apellido es incorrecto', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion para las subastas con membresias activas y pisos disponible
  function adquirir_subasta_gratis() {
    modal_confirmacion.hide();
    $('#body_modal').text("Cargando...")
    modal.show();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/pagar_entrada';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id: id_confirmacion
      };
      send_data_server(url, data_to_server, success_adquirir_gratis,
        error);
    }, 1000);
  };
  //respuesta de la creacion del piso gratis
  function success_adquirir_gratis(response) {
    modal.hide();
    let status = response.status;
    if (status == 200) {
      $('#btn_notificacion_membresia').hide();
      $('#btn_notificacion_inversa').hide();
      $('#btn_notificacion_piso').show();
      $('#btn_notificacion_aceptar').hide();
      $('#btn_notificacion_desctacar').hide();
      //piso de subasta
      $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
      $('#status_notificacion').text("Transacción Aprobada");
      $('#product_adquirido').html("<strong>Descripción : </strong>" + detalle_confirmacion);
      $('#mensaje_notificacion').text("Valor de entrada pagada exitosamente");
      $('#referencia_notificacion').html("");
      valida_piso_gratis = true;
      modal_notificacion.show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrió un error vuelva a intentarlo', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //se ejecuta con el boton membresia en el dash
  function cargar_membresia_user() {
    pushPage('#appNavigator', 'membresia_detalle.html', '');
    modal.show();
    $('#body_modal').text("Cargando membresia...")
    setTimeout(function () {
      var url = base_url + 'rest_membresia/buscar_membresia_user';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_detalle_membresia,
        error);
    }, 1000);
  }
  //se ejecuta con el boton adquirir membresia
  function cargar_membresias() {
    pushPage('#appNavigator', 'adquirir_membresia.html', '');
    modal.show();
    $('#body_modal').text("Cargando membresias...")
    setTimeout(function () {
      var url = base_url + 'rest_membresia/listar';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_adquirir_membresias,
        error);
    }, 1000);
  }
  //success de cargar_membresia_user muestra la informacion de la membresia adquirida
  function success_detalle_membresia(response) {
    modal.hide();
    let status = response.status;
    let membresia = response.membresia_user;
    if (status == 200) {
      $('#nombre_membresia').text(membresia.nombre);
      $('#descripcion_membresia').html(membresia.descripcion);
      $('#descripcion_membresia').after(
        "<p style='color:#80232b' class='text-center'><strong>Fecha de compra:</strong> " + membresia.fecha_inicio +
        " </p><p style='color:#80232b' class='text-center'><strong>Fecha de vencimiento:</strong> " + membresia
        .fecha_fin + " </p>")
      $('#anuncios_disponibles').text("Anuncios disponibles: " + membresia.anuncios_publi);
      $('#subastas_disponibles').text("Subastas disponibles: " + membresia.qty_subastas);
      $('#card_infomacion_membresia').show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay membresias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //success de cargar_membresia mostrando un listado de las membresias
  function success_adquirir_membresias(response) {
    modal.hide();
    // response = JSON.parse(response);
    var status = response.status;
    let membresias = response.membresias;
    let card = "";
    if (status == 200) {
      if (membresias.length > 0) {
        for (let i = 0; i < membresias.length; i++) {
          card += " <ons-card><div class='title'><div style='color:#80232b' class='text-center'>" + membresias[i]
            .nombre +
            "</div><div style='color:#80232b' class='text-center'>$" + parseFloat(membresias[i].precio).toFixed(2) +
            "</div></div><div class='content text-center'>" + membresias[i].descripcion +
            "</div> <button style='width: 95% !important; background-color: #80232b !important;' onclick=buy_membresia('" +
            btoa(JSON.stringify(membresias[i])) +
            "');  class='btn btn-cyan' type='button'><span> Adquirir</span></button></ons-card>";
        }
        $('#body_membresias').append(card);
      }
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay membresias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que cierra el modal confirmacion que es de pago.
  function close_confirmacion() {
    let modal_confirmacion = $('#modal_confirmacion');
    modal_confirmacion.hide();
  }
  //function que se ejecuta previo al pago placetopay
  function adquirir_subasta() {
    var aceptado_tc = $('#selected_tc').is(":checked");
    if (aceptado_tc) {
      close_confirmacion();
      modal.show();
      $('#body_modal').text("Cargando ...");
      setTimeout(function () {
        var url = base_url + 'rest_payment/checkout';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          id: id_confirmacion,
          detalle: detalle_confirmacion,
          tipo: tipo_inicial_subasta,
          monto: valor_confirmacion
        };
        send_data_server(url, data_to_server, success_producto_adquirida,
          error);
      }, 1000);
    } else {
      navigator.notification.alert(
        'Usted debe aceptar los términos y condiciones', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //function que se ejecuta previo al pago placetopay
  function adquirir_confimacion() {
    var aceptado_tc = $('#selected_tc').is(":checked");
    if (aceptado_tc) {
      close_confirmacion();
      modal.show();
      $('#body_modal').text("Cargando ...");
      setTimeout(function () {
        var url = base_url + 'rest_payment/checkout';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          id: id_confirmacion,
          detalle: detalle_confirmacion,
          tipo: tipo_detalle,
          monto: valor_confirmacion
        };
        send_data_server(url, data_to_server, success_producto_adquirida,
          error);
      }, 1000);
    } else {
      navigator.notification.alert(
        'Usted debe aceptar los términos y condiciones', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //regreso al comercio luego de pagar
  P.on('response', function (data) {
    console.log(data);
    response_payment = data;
    // console.log(response_payment);
    let requestId = data.requestId;
    let reference = data.reference;
    let estado_payment = 0;
    if (data.status.status == "APPROVED") {
      estado_payment = 1;
    } else if (data.status.status == "REJECTED") {
      estado_payment = 2;
    } else if (data.status.status == "PENDING") {
      estado_payment = 3;
    }
    console.log(estado_payment);
    if (estado_payment > 1) {
      var url = base_url + 'rest_payment/update_request';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        request_id: requestId,
        reference: reference,
        status: estado_payment
      };
      send_data_server(url, data_to_server, success_update_payment,
        error);
    } else {
      modal.hide();
      if (estado_payment == 1 && detalle_payment.tipo == 0) {
        $('#btn_notificacion_membresia').show();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        //compra de membresia
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Membresia adquirida : </strong>" + detalle_payment.detalle);
        $('#mensaje_notificacion').text(data.status.message);
        $('#referencia_notificacion').html(data.reference);
        modal_notificacion.show();
      } else if (estado_payment == 1 && detalle_payment.tipo == 1) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').show();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        //piso de subasta
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Descripción : </strong>" + detalle_payment.detalle);
        $('#mensaje_notificacion').text(data.status.message);
        $('#referencia_notificacion').html(data.reference);
        modal_notificacion.show();
      } else if (estado_payment == 1 && detalle_payment.tipo == 2) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').show();
        valida_mis_anuncios = true;
        //anuncio destacado
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Anuncio detacado : </strong>" + detalle_payment.detalle);
        $('#mensaje_notificacion').text(data.status.message);
        $('#referencia_notificacion').html(data.reference);
        modal_notificacion.show();
      } else if (estado_payment == 1 && detalle_payment.tipo == 3) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').show();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        valido_mis_subastas = true;
        //compra de inversa
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Subasta adquirida : </strong>" + detalle_payment.detalle);
        $('#mensaje_notificacion').text(data.status.message);
        $('#referencia_notificacion').html(data.reference);
        modal_notificacion.show();
      }
    }
  });
  //relacionado con el boton de pago placetopay
  $("#lightboxIt").on('click', function () {
    P.init($("#processUrl").val());
  });
  //funcion que se ejecuta luego de dar click en boton regresar al comercio para actualizar los estatus de la transaccion en caso de que sea rechazada o pendiente.
  function success_update_payment(response) {
    var result = response.payment;
    var status = response.status;
    // let membresias = response.membresia_user;+
    if (status == 200) {
      modal.hide();
      if (result.status == 1 && result.tipo == 0) {
        //compra de membresia
        $('#btn_notificacion_membresia').show();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Membresia adquirida : </strong>" + result.detalle);
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      } else if (result.status == 1 && result.tipo == 1) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').show();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        //piso de subasta
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Descripción : </strong>" + result.detalle);
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      } else if (result.status == 1 && result.tipo == 2) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').show();
        //anuncio destacado
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Anuncio detacado : </strong>" + result.detalle);
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      } else if (result.status == 1 && result.tipo == 3) {
        //compra de inversa
        valido_mis_subastas = true;
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').show();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').hide();
        $('#btn_notificacion_desctacar').hide();
        $('#icono_notificacion').html("<i class='fa fa-check-circle-o'></i>");
        $('#status_notificacion').text("Transacción Aprobada");
        $('#product_adquirido').html("<strong>Subasta adquirida : </strong>" + result.detalle);
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      }
      if (result.status == 2) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').show();
        $('#btn_notificacion_desctacar').hide();
        $('#icono_notificacion').html("<i class='fa fa-times-circle-o'></i>");
        $('#status_notificacion').text("El pago ha sido rechazado");
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      } else if (result.status == 3) {
        $('#btn_notificacion_membresia').hide();
        $('#btn_notificacion_inversa').hide();
        $('#btn_notificacion_piso').hide();
        $('#btn_notificacion_aceptar').show();
        $('#btn_notificacion_desctacar').hide();
        $('#icono_notificacion').html("<i class='fa fa-question-circle-o'></i>");
        $('#status_notificacion').text("El proceso de pago está pendiente");
        $('#mensaje_notificacion').text(response_payment.status.message);
        $('#referencia_notificacion').html(result.reference);
        modal_notificacion.show();
      }
    }
    if (status == 500) {
      navigator.notification.alert(
        'Ocurrio un error intente mas tarde', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta como respuesta del boton pagar placetopay y levanta el modal de pago
  function success_producto_adquirida(response) {
    //  modal.hide();
    // response = JSON.parse(response);
    detalle_payment = response.payment;
    var result = response.result;
    var status = response.status;
    // let membresias = response.membresia_user;
    if (status == 200) {
      var processUrl = result.processUrl;
      P.init(processUrl);
      $("#processUrl").val(processUrl);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que ejecuta la seleccion de la membresia y abre el modal de confirmacion
  function buy_membresia(obj) {
    detalle_pago = atob(obj);
    detalle_pago = JSON.parse(detalle_pago);
    tipo_detalle = 0;
    modal.show();
    $('#btn_pagar_confirmacion').hide();
    setTimeout(function () {
      var url = base_url + 'rest_payment/payments_user';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_confirmacion_payment,
        error);
    }, 1000);
  };
  //funcion que ejecuta el modal de confirmacion
  function pagar_subasta_inversa() {
    if (app) {
      app.hideFromTemplate();
    }
    modal.show();
    $('#body_modal').text("Cargando ...");
    $('#btn_pagar_confirmacion').hide();
    setTimeout(function () {
      var url = base_url + 'rest_payment/payments_user';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_confirmacion_payment_all,
        error);
    }, 1000);
  };
  function pagar_subasta_inversa_2() {
    if (app) {
      app.hideFromTemplate();
    }
 modalComprarInversa.show();
 $('#mensajeComprar').text(detalle_inicial_subasta);
 $('#precioComprar').text('$'+parseFloat(precio_payment).toFixed(2));
  };
  function comprarInversa() {
    closeComprarInversa();
    modal.show();
    $('#body_modal').text("Generando pedido...");
    setTimeout(function () {
      var url = base_url + 'rest_subasta/generar_pedido_inversa';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id:subasta_activa_pay
      };
      send_data_server(url, data_to_server, successGenerarInversa,
        error);
    }, 1000);
  }
  function closeComprarInversa() {
    modalComprarInversa.hide();
  }
  function successGenerarInversa(response) {
    let status = response.status;
    modal.hide();
    if (status == 200) {
      navigator.notification.alert(
        'Su pedido está en proceso de verificación, en breves minutos nuestros asistentes de ventas se comunicarán para concretar la compra.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'Disculpe intente mas tarde', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta para mostrar el mensaje de lo ocurrido con la transaccion y abre el modal de notificacion
  function success_confirmacion_payment_all(response) {
    modal.hide();
    $('#body_condiciones').hide();
    $('#transaccion_pendiente').hide();
    $('#btn_pagar_confirmacion').hide();
    $('#btn_pagar_gratis').hide();
    $('#btn_pagar_all').show();
    let status = response.status;
    if (status == 200) {
      if (ads_objet) {
        $('#body_mensaje_confirmacion').empty();
        let cadena = "<h5  class='text-center'> Anuncio:" + ads_objet.titulo +
          "</h5><h5  class='text-center'>$3.99</h5>";
        $('#body_mensaje_confirmacion').append(cadena);
        $('#title_confirmacion').text("Destacar");
        $('#transaccion_pendiente').html(
          "<p class='text-center'><b>Estimado usuario actualmente tiene una transacción pendiente.</b></p><p style='text-align:center'>Referencia: #" +
          response.obj[0].reference + "<p>");
        $('#transaccion_pendiente').show();
        id_confirmacion = ads_objet.anuncio_id;
        valor_confirmacion = 3.99;
        detalle_confirmacion = ads_objet.titulo;
        $('#btn_pagar_all').hide();
        $('#btn_pagar_gratis').hide();
        $('#body_condiciones').hide();
        modal_confirmacion.show();
      } else {
        $('#body_mensaje_confirmacion').empty();
        let cadena = "<h5  class='text-center'>" + detalle_inicial_subasta +
          "</h5><h5  class='text-center'>$" + parseFloat(precio_payment).toFixed(2) + "</h5>";
        $('#body_mensaje_confirmacion').append(cadena);
        $('#title_confirmacion').text("Subasta");
        $('#transaccion_pendiente').html(
          "<p class='text-center'><b>Estimado usuario actualmente tiene una transacción pendiente.</b></p><p style='text-align:center'>Referencia: #" +
          response.obj[0].reference + "<p>");
        $('#transaccion_pendiente').show();
        id_confirmacion = subasta_activa_pay;
        valor_confirmacion = precio_payment;
        detalle_confirmacion = detalle_inicial_subasta;
        $('#btn_pagar_all').hide();
        $('#body_condiciones').hide();
        $('#btn_pagar_gratis').hide();
        modal_confirmacion.show();
      }

    }
    if (status == 404) {
      if (ads_objet) {
        $('#body_mensaje_confirmacion').empty();
        let cadena = "<h5  class='text-center'> Anuncio:" + ads_objet.titulo +
          "</h5><h5  class='text-center'>$3.99</h5>";
        $('#body_mensaje_confirmacion').append(cadena);
        $('#title_confirmacion').text("Destacar");
        $('#transaccion_pendiente').html(
          "<p class='text-center'><b>Estimado usuario actualmente tiene una transacción pendiente.</b></p>");
        $('#transaccion_pendiente').hide();
        id_confirmacion = ads_objet.anuncio_id;
        valor_confirmacion = 3.99;
        detalle_confirmacion = ads_objet.titulo;
        tipo_inicial_subasta = 2;
        $('#btn_pagar_gratis').hide();
        $('#btn_pagar_all').show();
        $('#body_condiciones').show();
        modal_confirmacion.show();
      } else {
        if (tipo_inicial_subasta == 1) {
          if (response.membresia_user) {
            var membresia_qty_subastas = parseInt(response.membresia_user.qty_subastas);
            var membresia_descuento = parseFloat(response.membresia_user.descuento);
            var membresia_user_id = response.membresia_user.membre_user_id;
            if (membresia_qty_subastas > 0) {
              $('#body_mensaje_confirmacion').empty();
              let cadena = "<h5  class='text-center'>" + detalle_inicial_subasta +
                "</h5><h5  class='text-center'>Antes <span  class='badge badge-danger strikethrough'>$" + parseFloat(
                  precio_payment).toFixed(2) + "</span> Ahora <span  class='badge badge-success'>$0.00</span</h5>";
              $('#body_mensaje_confirmacion').append(cadena);
              $('#title_confirmacion').text("Subasta");
              id_confirmacion = subasta_activa_pay;
              valor_confirmacion = precio_payment;
              detalle_confirmacion = detalle_inicial_subasta;
              $('#btn_pagar_gratis').show();
              $('#btn_pagar_all').hide();
              $('#body_condiciones').show();
              modal_confirmacion.show();
            } else {
              var descuento_new = (membresia_descuento / 100) + 1;
              precio_payment_old = precio_payment;
              precio_payment = parseFloat(parseFloat(precio_payment).toFixed(2)) / descuento_new;
              $('#body_mensaje_confirmacion').empty();
              let cadena = "<h5  class='text-center'>" + detalle_inicial_subasta +
                "</h5><h5  class='text-center'>Antes <span  class='badge badge-danger strikethrough'>$" + parseFloat(
                  precio_payment_old).toFixed(2) + "</span> Ahora <span  class='badge badge-success'>$" + parseFloat(
                  precio_payment).toFixed(2) + "</span</h5>";
              $('#body_mensaje_confirmacion').append(cadena);
              $('#title_confirmacion').text("Subasta");
              id_confirmacion = subasta_activa_pay;
              valor_confirmacion = precio_payment;
              detalle_confirmacion = detalle_inicial_subasta;
              $('#btn_pagar_gratis').hide();
              $('#btn_pagar_all').show();
              $('#body_condiciones').show();
              modal_confirmacion.show();
            }
          } else {
            $('#body_mensaje_confirmacion').empty();
            let cadena = "<h5  class='text-center'>" + detalle_inicial_subasta +
              "</h5><h5  class='text-center'>$" + parseFloat(precio_payment).toFixed(2) + "</h5>";
            $('#body_mensaje_confirmacion').append(cadena);
            $('#title_confirmacion').text("Subasta");
            id_confirmacion = subasta_activa_pay;
            valor_confirmacion = precio_payment;
            detalle_confirmacion = detalle_inicial_subasta;
            $('#btn_pagar_all').show();
            $('#btn_pagar_gratis').hide();
            $('#body_condiciones').show();
            modal_confirmacion.show();
          }
        } else {
          $('#body_mensaje_confirmacion').empty();
          let cadena = "<h5  class='text-center'>" + detalle_inicial_subasta +
            "</h5><h5  class='text-center'>$" + parseFloat(precio_payment).toFixed(2) + "</h5>";
          $('#body_mensaje_confirmacion').append(cadena);
          $('#title_confirmacion').text("Subasta");
          id_confirmacion = subasta_activa_pay;
          valor_confirmacion = precio_payment;
          detalle_confirmacion = detalle_inicial_subasta;
          $('#btn_pagar_all').show();
          $('#btn_pagar_gratis').hide();
          $('#body_condiciones').show();
          modal_confirmacion.show();
        }
      }
    }
    if (status == 500) {
      navigator.notification.alert(
        'Disculpe intente mas tarde', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta para mostrar el mensaje de lo ocurrido con la transaccion y abre el modal de notificacion
  function success_confirmacion_payment(response) {
    modal.hide();
    $('#body_condiciones').hide();
    $('#transaccion_pendiente').hide();
    let status = response.status;
    if (status == 200) {
      $('#body_mensaje_confirmacion').empty();
      let cadena = "<h5  class='text-center'>" + detalle_pago.nombre +
        "</h5><h5  class='text-center'>$" + parseFloat(detalle_pago.precio).toFixed(2) + "</h5>";
      $('#body_mensaje_confirmacion').append(cadena);
      $('#title_confirmacion').text("Membresia");
      $('#transaccion_pendiente').html(
        "<p class='text-center'><b>Estimado usuario actualmente tiene una transacción pendiente.</b></p><p style='text-align:center'>Referencia: #" +
        response.obj[0].reference + "<p>");
      $('#transaccion_pendiente').show();
      id_confirmacion = detalle_pago.membresia_id;
      valor_confirmacion = detalle_pago.precio;
      detalle_confirmacion = detalle_pago.nombre;
      $('#btn_pagar_confirmacion').hide();
      $('#body_condiciones').hide();
      modal_confirmacion.show();
    }
    if (status == 404) {
      $('#body_mensaje_confirmacion').empty();
      let cadena = "<h5  class='text-center'>" + detalle_pago.nombre +
        "</h5><h5  class='text-center'>$" + parseFloat(detalle_pago.precio).toFixed(2) + "</h5>";
      $('#body_mensaje_confirmacion').append(cadena);
      $('#title_confirmacion').text("Membresia");
      id_confirmacion = detalle_pago.membresia_id;
      valor_confirmacion = detalle_pago.precio;
      detalle_confirmacion = detalle_pago.nombre;
      $('#btn_pagar_confirmacion').show();
      $('#body_condiciones').show();
      modal_confirmacion.show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'Disculpe intente mas tarde', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion para pagar el piso de la subasta
  function pagar_entrada_subasta() {
    pushPage('#appNavigator', 'entrada.html', '');
    modal.show();
    setTimeout(function () {
      $('#valor_inicial_entrada').html(
        "<h3 style='color:#80232b !important; font-size: 20px !important;' class='text-center'>$" +
        parseFloat(valor_inicial).toFixed(2) + "</h3>");
      modal.hide();
    }, 1000);
  }
  //funcion que ejecuta la carga de las categorias de subata
  function cargar_categorias_subastas() {
    pushPage('#appNavigator', 'categoria_subastas.html', '');
    modal.show();
    $('#body_modal').text("Cargando categorias...")
    setTimeout(function () {
      var url = base_url + 'rest_subasta/subasta_categoria';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_subasta_categoria,
        error);
    }, 1000);
  }
  //funcion de respuesta para cargar las categorias de anuncios
  function success_anuncio_categoria(response) {
    lista = response.lista;
    count = lista.length;
    modal.hide();
    //  response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      ads_objet = null;
      cargar_categorias_anuncio(lista, count);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta para cargar las categorias de anuncios
  function success_anuncio_categoria2(response) {
    lista = response.lista;
    anuncio_objecto = response.obj_anuncio;
    count = lista.length;
    modal.hide();
    //  response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      ads_objet = null;
      /*     if (anuncio_objecto) {
            categoria_update = anuncio_objecto.subcategoria.cate_anuncio_id;
            subcategoria_update = anuncio_objecto.subcate_id;
            $('#btn_update_cat').show();
          } */
      cargar_categorias_anuncio2(lista, count);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta para cargar las subcategorias de anuncios
  function success_anuncio_subcategoria(response) {
    modal.hide();
    //  response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      lista = response.object;
      count = lista.length;
      cargar_subcategorias_anuncio(lista, count);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }

  function success_anuncio_subcategoria2(response) {
    modal.hide();
    //  response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      lista = response.object;
      count = lista.length;
      cargarFormEditar(lista);
      // cargar_subcategorias_anuncio(lista, count);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de repuesta para cargar las categorias de la subasta
  function success_subasta_categoria(response) {
    lista = response.lista;
    count = lista.length;
    modal.hide();
    //  response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      cargar_categorias(lista, count);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //carga las categoias de la subasta
  function cargar_categorias(lista, count) {
    colores = ["#3498DB", "#2ECC71", "#9B59B6", "#D5658D", "#B89579", "#53B9C5", "#757790", "#344953", "#3498DB",
      "#2ECC71", "#9B59B6", "#D5658D", "#B89579", "#53B9C5", "#757790", "#344953", "#3498DB", "#2ECC71", "#9B59B6",
      "#D5658D", "#B89579", "#53B9C5", "#757790", "#344953"
    ];
    contador = 7;
    cadena_cate = ""
    if (count > 0) {
      for (let i = 0; i < count; i++) {
        var img = base_url + lista[i].photo;
        cadena_cate +=
          "   <ons-list-item onclick='buscar_subastas(" +
          lista[i].categoria_id +
          ");' ripple modifier='chevron' tappable><div class='left'><img  style='background-color:" +
          colores[i] +
          ";' class='list-item__thumbnail' src='" +
          img +
          "'></div> <div class='center'><h4><span class='list-item__title'>" + lista[i].name_espa +
          "</span></h4></div></ons-list-item>";
      }
      $('#area_categoria').after(cadena_cate);
    }
  }
  //carga las categorias de los anuncios
  function cargar_categorias_anuncio(lista, count) {
    colores = ["#3498DB", "#2ECC71", "#9B59B6", "#D5658D", "#B89579", "#53B9C5", "#757790", "#344953"];
    contador = 7;
    cadena_cate = ""
    if (count > 0) {
      for (let i = 0; i < count; i++) {
        var img = base_url + lista[i].photo;
        cadena_cate +=
          "   <ons-list-item onclick='buscar_anuncios(" +
          lista[i].cate_anuncio_id +
          ");' ripple modifier='chevron' tappable><div class='left'><img class='list-item__thumbnail' src='" +
          img +
          "'></div> <div class='center'><h4><span class='list-item__title'>" + lista[i].nombre +
          "</span><span> (" + lista[i].contador + ")</span></h4></div></ons-list-item>";
      }
      $('#area_categoria_anuncio').after(cadena_cate);
    }
  }
  //carga las categorias de los anuncios
  function cargar_subcategorias_anuncio(lista, count) {
    if (valida_categoria_update) {
      $('#btn_update_sub').show();
      cadena_cate = ""
      if (count > 0) {
        for (let i = 0; i < count; i++) {
          if (subcategoria_update == lista[i].subcate_id) {
            cadena_cate += "<ons-list-item style='background:#e6e6e6' id='subcategoria_'" + lista[i].subcate_id +
              " onclick='cargar_formulario(" +
              lista[i].subcate_id + ");'ripple modifier='chevron' tappable><h4>" + lista[i].nombre +
              "</h4></ons-list-item>";
          } else {
            cadena_cate += "<ons-list-item id='subcategoria_'" + lista[i].subcate_id + " onclick='cargar_formulario(" +
              lista[i].subcate_id + ");'ripple modifier='chevron' tappable><h4>" + lista[i].nombre +
              "</h4></ons-list-item>";
          }
        }
        $('#header_lista').append(cadena_cate);
      }
    } else {
      $('#btn_update_sub').hide();
      cadena_cate = ""
      if (count > 0) {
        for (let i = 0; i < count; i++) {
          cadena_cate += "<ons-list-item id='subcategoria_'" + lista[i].subcate_id + " onclick='cargar_formulario(" +
            lista[i].subcate_id + ");'ripple modifier='chevron' tappable><h4>" + lista[i].nombre +
            "</h4></ons-list-item>";
        }
        $('#header_lista').append(cadena_cate);
      }
    }

  }
  //carga las categorias de los anuncios
  function cargar_categorias_anuncio2(lista, count) {
    if (anuncio_objecto) {
      $('#btn_update_cat').show();
      cadena_cate = ""
      if (count > 0) {
        for (let i = 0; i < count; i++) {
          if (lista[i].cate_anuncio_id == categoria_update) {
            var img = base_url + lista[i].photo;
            cadena_cate +=
              "   <ons-list-item style='background:#e6e6e6' onclick='buscar_subcategoria(" +
              lista[i].cate_anuncio_id +
              ");' ripple modifier='chevron' tappable><div class='left'><img class='list-item__thumbnail' src='" +
              img +
              "'></div> <div class='center'><h4><span class='list-item__title'>" + lista[i].nombre +
              "</span><span> (" + lista[i].contador + ")</span></h4></div></ons-list-item>";
          } else {
            var img = base_url + lista[i].photo;
            cadena_cate +=
              "   <ons-list-item onclick='buscar_subcategoria(" +
              lista[i].cate_anuncio_id +
              ");' ripple modifier='chevron' tappable><div class='left'><img class='list-item__thumbnail' src='" +
              img +
              "'></div> <div class='center'><h4><span class='list-item__title'>" + lista[i].nombre +
              "</span><span> (" + lista[i].contador + ")</span></h4></div></ons-list-item>";
          }

        }
        $('#area_categoria_anuncio_publicar').after(cadena_cate);
      }
    } else {
      cadena_cate = ""
      if (count > 0) {
        for (let i = 0; i < count; i++) {
          var img = base_url + lista[i].photo;
          cadena_cate +=
            "   <ons-list-item onclick='buscar_subcategoria(" +
            lista[i].cate_anuncio_id +
            ");' ripple modifier='chevron' tappable><div class='left'><img class='list-item__thumbnail' src='" +
            img +
            "'></div> <div class='center'><h4><span class='list-item__title'>" + lista[i].nombre +
            "</span><span> (" + lista[i].contador + ")</span></h4></div></ons-list-item>";
        }
        $('#area_categoria_anuncio_publicar').after(cadena_cate);
      }
    }

  }
  //funciton para seguir al forulario en el editar
  function siguiente_sub_update() {
    cargar_formulario(subcategoria_update);
  }

  //carga la ventana para buscar las subastas
  function buscar() {
    modal.show();
    $('#body_modal').text("Cargando");
    pushPage('#appNavigator', 'buscar.html', 'Buscar subasta');
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/ciudades';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_filtros_subasta,
        error);
    }, 1000);

  }
  var on_ubicacion_sub = function (position) {
    var promise = new Promise(function (resolve, reject) {
      latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      new google.maps.Geocoder().geocode({
        'latLng': latlng
      }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          if (results[1]) {
            var country = null,
              countryCode = null,
              city = null,
              cityAlt = null;
            var c, lc, component;
            for (var r = 0, rl = results.length; r < rl; r += 1) {
              var result = results[r];

              if (!city && result.types[0] === 'locality') {
                for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                  component = result.address_components[c];

                  if (component.types[0] === 'locality') {
                    city = component.long_name;
                    break;
                  }
                }
              } else if (!city && !cityAlt && result.types[0] ===
                'administrative_area_level_1') {
                for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                  component = result.address_components[c];
                  if (component.types[0] === 'administrative_area_level_1') {
                    cityAlt = component.long_name;
                    break;
                  }
                }
              } else if (!country && result.types[0] === 'country') {
                country = result.address_components[0].long_name;
                countryCode = result.address_components[0].short_name;
              }
              if (city && country) {
                break;
              }
            }
            $("#city_main").val(city);
            ubicacion_subasta = city
            resolve(ubicacion_subasta);
          }
        }
      });

    })
    promise.then(function (result) {
      // $('#span_ubicacion_subasta').text(ubicacion_subasta);
      modal.hide();
    })
  }

  function success_filtros_subasta(response) {
    var status = response.status;
    var lista_ciudades = response.lista;
    var lista_categorias = response.categorias;
    $('#lista_ciudades_subasta').empty();
    if (status == 200) {
      var cadena_ciudades =
        "<ons-list-item><div class='left'>Ciudades</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_ciudades_subasta()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item id='mi_ubicacion_subasta_inicial' class='filter_ciudad' onclick=mi_ubicacion() modifier='chevron' tappable> <ons-icon icon='fa-street-view'></ons-icon> Tu ubicación</ons-list-item><ons-list-item id='ciudades_subasta_inicial' class='filter_ciudad' onclick=todas_ciudades_subasta() modifier='chevron' tappable>Todas las ciudades</ons-list-item>";
      lista_ciudades.forEach(element => {
        cadena_ciudades += "<ons-list-item id='ciudad_subasta_" + element.ciudad_id +
          "' class='filter_ciudad' onclick=seleccion_ciudad('" + element.ciudad_id +
          "') modifier='chevron' tappable>" + element.name_ciudad + "</ons-list-item>"
      });
      $('#lista_ciudades_subasta').append(cadena_ciudades);
      var cadena_categorias =
        "<ons-list-item><div class='left'>Categoria</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_cat_subasta()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item id='cat_filter_subasta_0' class='filter_cat'  onclick=seleccion_categoria_subasta('0') modifier='chevron' tappable>Todas las categorias</ons-list-item>";
      lista_categorias.forEach(element => {
        cadena_categorias += "<ons-list-item id='cat_filter_subasta_" + element.categoria_id +
          "' class='filter_cat'  onclick=seleccion_categoria('" + btoa(JSON.stringify(element.subcategorias)) +
          "','" + element.categoria_id + "') modifier='chevron' tappable>" + element.name_espa + "</ons-list-item>"
      });
      $('#lista_categorias_subasta').append(cadena_categorias);
      $('#lista_ciudades_subasta').hide();
      // $('#body_buscador_subasta').hide();
      navigator.geolocation.getCurrentPosition(on_ubicacion_sub, onErrorSub);
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrió un problema.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }

  function onErrorSub(error) {
    modal.hide();
    navigator.notification.alert(
      'Ocurrio un error al obtener tu ubicación', // message
      pedir_ubicacion_sub, // callback
      'Notificación', // title
      'Aceptar' // buttonName
    );
    /*  alert('code: ' + error.code + '\n' +
       'message: ' + error.message + '\n'); */
  }

  function pedir_ubicacion_sub() {
    //   navigator.geolocation.getCurrentPosition(on_ubicacion_sub, onErrorSub);
    ciudad_filter_subasta = 0;
  }

  function todas_ciudades_subasta() {
    ciudad_filter_subasta = 0;
    $('.filter_ciudad').removeClass('ciudad_filter_subasta');
    $('#ciudades_subasta_inicial').addClass('ciudad_filter_subasta');
    $('#lista_ciudades_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();

  }

  function seleccion_categoria_subasta(params) {
    $('.filter_cat').removeClass('subcat_filter_subasta');
    $('#cat_filter_subasta_0').addClass('subcat_filter_subasta');
    categoria_filter_subasta = params;
    $('#body_buscador_subasta').show();
    $('#lista_categorias_subasta').hide();
    $('#area_autocomplete').show();
  }

  function seleccion_categoria(params, id) {
    $('.filter_cat').removeClass('subcat_filter_subasta');
    $('#cat_filter_subasta_' + id).addClass('subcat_filter_subasta');
    categoria_filter_subasta = id;
    $('#lista_categorias_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
    params = atob(params);
    params = JSON.parse(params);
    $('#lista_subcategorias_subasta').empty();
    var cadena_categorias =
      "<ons-list-item><div class='left'>Subcategoria</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_sub_subasta()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item style='margin-top:-2px !important;' id='filter_sub_0' class='filter_sub' onclick=seleccion_subcategoria('0') modifier='chevron' tappable>Todas las subcategorias</ons-list-item>";
    params.forEach(element => {
      cadena_categorias += "<ons-list-item id='filter_sub_" + element.subcat_id +
        "' class='filter_sub'  onclick=seleccion_subcategoria('" + element.subcat_id +
        "') modifier='chevron' tappable>" + element.nombre + "</ons-list-item>"
    });
    $('#lista_subcategorias_subasta').append(cadena_categorias);
    $('#lista_subcategorias_subasta').hide();
  }

  function cerrar_lista_sub_subasta() {
    $('#lista_subcategorias_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
  }

  function cerrar_lista_cat_subasta() {
    $('#lista_categorias_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
  }

  function cerrar_lista_ciudades_subasta() {
    $('#lista_ciudades_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
  }

  function seleccion_subcategoria(params) {
    $('.filter_sub').removeClass('cat_filter_subasta');
    $('#filter_sub_' + params).addClass('cat_filter_subasta');
    subcategoria_filter_subasta = params;
    $('#lista_subcategorias_subasta').hide();
    $('#body_buscador_subasta').show();
    $('#area_autocomplete').show();
  }

  function mostrar_ciudades_subasta() {
    $('#lista_ciudades_subasta').show();
    $('#body_buscador_subasta').hide();
    $('#area_autocomplete').hide();
  }

  function mostrar_categorias_subasta() {
    $('#lista_categorias_subasta').show();
    $('#body_buscador_subasta').hide();
    $('#area_autocomplete').hide();
  }

  function mostrar_subcategorias_subasta() {
    if (categoria_filter_subasta > 0) {
      $('#lista_subcategorias_subasta').show();
      $('#body_buscador_subasta').hide();
      $('#area_autocomplete').hide();
    } else {
      navigator.notification.alert(
        'Seleccione una categoria', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
      $('#area_autocomplete').show();
    }

  }

  function success_filtros_anuncio(response) {
    var status = response.status;
    var lista_ciudades = response.lista;
    var lista_categorias = response.categorias;
    $('#lista_ciudades_anuncio').empty();
    if (status == 200) {
      var cadena_ciudades =
        "<ons-list-item><div class='left'>Ciudades</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_ciudades_anuncio()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item id='mi_ubicacion_ads_inicial' class='filter_ciudad_ads' onclick=mi_ubicacion_ads() modifier='chevron' tappable> <ons-icon icon='fa-street-view'></ons-icon> Tu ubicación</ons-list-item><ons-list-item id='ciudades_anuncio_inicial' class='filter_ciudad_ads' onclick=todas_ciudades_anuncio() modifier='chevron' tappable>Todas las ciudades</ons-list-item>";
      lista_ciudades.forEach(element => {
        cadena_ciudades += "<ons-list-item id='ciudad_anuncio_" + element.ciudad_id +
          "' class='filter_ciudad_ads' onclick=seleccion_ciudad_anuncio('" + element.ciudad_id +
          "') modifier='chevron' tappable>" + element.name_ciudad + "</ons-list-item>"
      });
      $('#lista_ciudades_anuncio').append(cadena_ciudades);
      var cadena_categorias =
        "<ons-list-item><div class='left'>Categoria</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_cat_anuncio()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item id='cat_filter_anuncio_0' class='filter_cat_ads'  onclick=seleccion_categoria_anuncio_unico() modifier='chevron' tappable>Todas las categorias</ons-list-item>";
      lista_categorias.forEach(element => {
        cadena_categorias += "<ons-list-item id='cat_filter_anuncio_" + element.cate_anuncio_id +
          "' class='filter_cat_ads'  onclick=seleccion_categoria_anuncio('" + btoa(JSON.stringify(element
            .subcategorias)) +
          "','" + element.cate_anuncio_id + "') modifier='chevron' tappable>" + element.nombre + "</ons-list-item>"
      });
      $('#lista_categorias_anuncio').append(cadena_categorias);
      $('#lista_ciudades_anuncio').hide();
      // $('#body_buscador_subasta').hide();
      navigator.geolocation.getCurrentPosition(ubicacion_ads, onErrorAds);
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrió un problema.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }

  function onErrorAds(error) {
    modal.hide();
    navigator.notification.alert(
      'Ocurrio un error al obtener tu ubicación', // message
      pedir_ubicacion_ads, // callback
      'Notificación', // title
      'Aceptar' // buttonName
    );
    /*  alert('code: ' + error.code + '\n' +
       'message: ' + error.message + '\n'); */
  }

  function pedir_ubicacion_ads() {
    // navigator.geolocation.getCurrentPosition(_sub_ads, onErrorAds);
    ciudad_filter_anuncio = 0;
  }
  var ubicacion_ads = function (position) {
    var promise = new Promise(function (resolve, reject) {
      latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      new google.maps.Geocoder().geocode({
        'latLng': latlng
      }, function (results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          if (results[1]) {
            var country = null,
              countryCode = null,
              city = null,
              cityAlt = null;
            var c, lc, component;
            for (var r = 0, rl = results.length; r < rl; r += 1) {
              var result = results[r];

              if (!city && result.types[0] === 'locality') {
                for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                  component = result.address_components[c];

                  if (component.types[0] === 'locality') {
                    city = component.long_name;
                    break;
                  }
                }
              } else if (!city && !cityAlt && result.types[0] ===
                'administrative_area_level_1') {
                for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                  component = result.address_components[c];
                  if (component.types[0] === 'administrative_area_level_1') {
                    cityAlt = component.long_name;
                    break;
                  }
                }
              } else if (!country && result.types[0] === 'country') {
                country = result.address_components[0].long_name;
                countryCode = result.address_components[0].short_name;
              }
              if (city && country) {
                break;
              }
            }
            $("#city_main").val(city);
            ubicacion_anuncio = city
            resolve(ubicacion_anuncio);
          }
        }
      });

    })
    promise.then(function (result) {
      // $('#span_ubicacion_subasta').text(ubicacion_subasta);
      modal.hide();
    })
  }

  function todas_ciudades_anuncio() {
    ciudad_filter_anuncio = 0;
    $('.filter_ciudad_ads').removeClass('ciudad_filter_anuncio');
    $('#ciudades_anuncio_inicial').addClass('ciudad_filter_anuncio');
    $('#lista_ciudades_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();

  }

  function seleccion_categoria_anuncio_unico() {
    $('.filter_cat_ads').removeClass('subcat_filter_anuncio');
    $('#cat_filter_anuncio_0').addClass('subcat_filter_anuncio');
    categoria_filter_anuncio = 0;
    $('#body_buscador_anuncio').show();
    $('#lista_categorias_anuncio').hide();
    $('#area_autocomplete_anuncio').show();
  }

  function seleccion_categoria_anuncio(params, id) {
    $('.filter_cat_ads').removeClass('subcat_filter_anuncio');
    $('#cat_filter_anuncio_' + id).addClass('subcat_filter_anuncio');
    categoria_filter_anuncio = id;
    $('#lista_categorias_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
    params = atob(params);
    params = JSON.parse(params);
    $('#lista_subcategorias_anuncio').empty();
    var cadena_categorias =
      "<ons-list-item><div class='left'>Subcategoria</div><div class='center'></div><div class='right'><ons-icon onclick='cerrar_lista_sub_anuncio()' style='font-size:18px;color:#8c1822' icon='md-close'></ons-icon></div></ons-list-item><ons-list-item style='margin-top:-2px !important;' id='filter_ads_sub_0' class='filter_ads_sub' onclick=seleccion_subcategoria_anuncio('0') modifier='chevron' tappable>Todas las subcategorias</ons-list-item>";
    params.forEach(element => {
      cadena_categorias += "<ons-list-item id='filter_ads_sub_" + element.subcate_id +
        "' class='filter_ads_sub'  onclick=seleccion_subcategoria_anuncio('" + element.subcate_id +
        "') modifier='chevron' tappable>" + element.nombre + "</ons-list-item>"
    });
    $('#lista_subcategorias_anuncio').append(cadena_categorias);
    $('#lista_subcategorias_anuncio').hide();
  }

  function cerrar_lista_sub_anuncio() {
    $('#lista_subcategorias_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
  }

  function cerrar_lista_cat_anuncio() {
    $('#lista_categorias_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
  }

  function cerrar_lista_ciudades_anuncio() {
    $('#lista_ciudades_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
  }

  function seleccion_subcategoria_anuncio(params) {
    $('.filter_ads_sub').removeClass('cat_filter_anuncio');
    $('#filter_ads_sub_' + params).addClass('cat_filter_anuncio');
    subcategoria_filter_anuncio = params;
    $('#lista_subcategorias_anuncio').hide();
    $('#body_buscador_anuncio').show();
    $('#area_autocomplete_anuncio').show();
  }

  function mostrar_ciudades_anuncio() {
    $('#lista_ciudades_anuncio').show();
    $('#body_buscador_anuncio').hide();
    $('#area_autocomplete_anuncio').hide();
  }

  function mostrar_categorias_anuncio() {
    $('#lista_categorias_anuncio').show();
    $('#body_buscador_anuncio').hide();
    $('#area_autocomplete_anuncio').hide();
  }

  function mostrar_subcategorias_anuncio() {
    if (categoria_filter_anuncio > 0) {
      $('#lista_subcategorias_anuncio').show();
      $('#body_buscador_anuncio').hide();
      $('#area_autocomplete_anuncio').hide();
    } else {
      navigator.notification.alert(
        'Seleccione una categoria', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
      $('#area_autocomplete').show();
    }

  }
  //carga la ventana para buscar anuncios
  function buscar_anuncio() {
    comienza_buscar_anuncio = 0;
    modal.show();
    $('#body_modal').text("Cargando ...");
    pushPage('#appNavigator', 'buscar_anuncio.html', 'Buscar subasta');
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/filtros';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_filtros_anuncio,
        error);
    }, 1000);
  }
  //funcion que se ejecuta para buscar la membresia del cliente
  function buscar_membresia_user() {
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_membresia/buscar_membresia_user';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_get_membresia,
        error);
    }, 1000);
  }
  //infinito para subasta
  function infinito() {
    comienza = comienza + 11;
    setTimeout(function () {
      var url = base_url + 'rest_subasta/cargar_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza,
        limite: limite,
        tipo: tipo_subasta_init
      };
      send_data_server(url, data_to_server, success_all_subastas,
        error);
    }, 1000);

  }
  //infinito para los anuncios
  function infinito_anuncio() {
    comienza2 = comienza2 + 11;
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/cargar_anuncios';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza2,
        limite: limite2
      };
      send_data_server(url, data_to_server, success_all_anuncios,
        error);
    }, 1000);
  }
  //respuesta para carga la membresias
  function success_get_membresia(response) {
    var status = response.status;
    if (status == 200) {
      $('#membresia_adquirir_dash').hide();
      $('#membresia_user_dash').show();
    }
    if (status == 404) {
      $('#membresia_adquirir_dash').show();
      $('#membresia_user_dash').hide();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //crea el obj del menu
  window.fn = {};
  //funcion el obj del menu
  window.fn.toggleMenu = function () {
    document.getElementById('appSplitter').left.toggle();
  };
  //funcion el obj del menu
  window.fn.loadView = function (index) {
    document.getElementById('appTabbar').setActiveTab(index);
    document.getElementById('sidemenu').close();
  };
  //funcion el obj del menu
  window.fn.loadLink = function (url) {
    window.open(url, '_blank');
  };
  //funcion el obj del menu
  window.fn.pushPage = function (page, anim) {
    if (anim) {
      document.getElementById('appNavigator').pushPage(page.id, {
        data: {
          title: page.title
        },
        animation: anim
      });
    } else {
      document.getElementById('appNavigator').pushPage(page.id, {
        data: {
          title: page.title
        }
      });
    }
  };
  //funcion que carga los datos del perfil
  function cargar_perfil() {
    pushPage('#appNavigator', 'perfil_cliente.html', '');
    modal.show();
    $('#body_modal').text("Cargando");
    setTimeout(function () {
      modal.hide();
    }, 1000);
  }
  //funcion que carga las credenciales
  function cargar_password() {
    fn.toggleMenu();
    pushPage('#appNavigator', 'contrasena.html', '');
    modal.show();
    $('#body_modal').text("Cargando");
    setTimeout(function () {
      modal.hide();
    }, 1000);
  }
  //carga el listado de subasta
  function cargar_subastas(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        var img = base_url + lista[i].photo;
        var tipo_subasta = ""
        var precio_subasta = 0
        var tipo_subasta_lista = null;
        if (lista[i].tipo_subasta == 1) {
          tipo_subasta_lista = 1;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100; color:#fff !important' class='badge badge-danger'> Directa</span>";
          precio_subasta = parseFloat(lista[i].valor_inicial).toFixed(2);

        } else {
          tipo_subasta_lista = 2;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100;' class='badge badge-danger'> Inversa</span>";
          precio_subasta = parseFloat(lista[i].intervalo[0].valor).toFixed(2);
          cadena_qty = lista[i].intervalo[lista[i].intervalo.length - 1].cantidad;
        }
        cadena = cadena +
          "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas_" +
          lista[i].subasta_id +
          "' onclick=''><div class='row'><div class='col-12'><h4 id='desc_" +
          lista[i].subasta_id +
          "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
          lista[i].nombre_espa +
          " </strong></h4> </div><div class='col-12'>" + tipo_subasta +
          "<div style='width:129.5px; height:129.5px'><img id='image_" + lista[i].subasta_id +
          "' style='width:100%; position:relative' class='rounded' src='" +
          img +
          "' alt='Card image cap'></div><p id='body_footer_" + lista[i].subasta_id +
          "' style='font-size:10px !important; text-align:center !important;' class='text-center'>Precio inicial <span style='margin-top:0px !important;margin-bottom:0px !important;  background: #80232b !important' class='badge badge-danger'>$" +
          precio_subasta +
          "</span></p></div></div></ons-card></ons-col>";

      }
      $('#area_subastas').append(cadena);
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas_' + lista[k].subasta_id).attr('onclick', 'detalle_subasta("' + lista[k].subasta_id + '")');
        if (lista[k].tipo_subasta == 1) {
          var cadena_win = null;
          if (lista[k].user_win) {
            cadena_win =
              "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
              lista[k].user_win.name + " " + lista[k].user_win.surname +
              "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
              parseFloat(lista[k].puja_win.valor).toFixed(2) +
              "</span>";
          }
          if (cadena_win) {
            var cadena_nueva = "<br><span id='name_win_portada_" + lista[k].subasta_id + "'>" + cadena_win +
              "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[k].ciudad.name_ciudad + "</span>";
            $('#body_footer_' + lista[k].subasta_id).append(cadena_nueva);
          } else {
            var cadena_nueva =
              "<br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[k].ciudad.name_ciudad + "</span>";
            $('#body_footer_' + lista[k].subasta_id).append(cadena_nueva);
          }

        } else {
          var cadena_qty = lista[k].intervalo[lista[k].intervalo.length - 1].cantidad;
          var cadena_nueva_inversa = "<br><span> Cantidad disponible: " +
            cadena_qty +
            "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
            lista[k].ciudad.name_ciudad + "</span>";
          $('#body_footer_' + lista[k].subasta_id).append(cadena_nueva_inversa);
        }

      }
    }
  }
  //carga el lista de subasta por categorias
  function cargar_subastas_categorias(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        var img = base_url + lista[i].photo;
        cadena = cadena +
          "<ons-card ripple id='ver_mas_" +
          lista[i].subasta_id +
          "' onclick='' ><div class='row'><div class='col-4'><img style='width:100%' class='rounded' src='" +
          img +
          "' alt='Card image cap'> <p class='text-center'><span style='margin-left:10% !important; background: #80232b !important' class='badge badge-danger'>$" +
          parseFloat(lista[i]
            .valor_inicial).toFixed(2) +
          "</span></p></div><div class='col-8' style='padding: 1px 1px 1px 1px !important;'> <h4 id='desc_" +
          lista[
            i]
          .subasta_id +
          "' style='font-size:16px !important; color:#80232b !important; line-height:1.5px !important; margin-top:15px !important;' class='card-title'><strong>" +
          lista[i].nombre_espa +
          "</strong></h4> <p style='font-size:10px !important; line-height:1.5px !important;' class='card-text'><span><i class='fa fa-tag' aria-hidden='true'></i> " +
          lista[i].categoria.name_espa +
          "</span>&nbsp<span><i class='fa fa-map-marker' aria-hidden='true'></i> " +
          lista[i]
          .ciudad.name_ciudad +
          "</span></p> <div class='text-left'><div class='timer'><div class='timer conte'><span class='days'  id='day_3" +
          lista[i]
          .subasta_id +
          "'></span></div><div class='smalltext'>Dias</div></div><div class='timer'><div class='timer conte'><span class='hours' id='hour_3" +
          lista[i]
          .subasta_id +
          "'></span></div><div class='smalltext'>Horas</div></div><div class='timer'><div class='timer conte'><span class='minutes' id='minute_3" +
          lista[i]
          .subasta_id +
          "'></span></div><div class='smalltext'>Minutos</div></div><div class='timer'><div class='timer conte'><span class='seconds' id='second_3" +
          lista[i]
          .subasta_id +
          "'></span></div><div class='smalltext'>Segundos</div></div></div></div></div></ons-card>";
      }
      $('#area_subastas_categorias').append(cadena);
      for (let j = 0; j < lista.length + 1; j++) {
        var x = setInterval(function () {
          var fecha = lista[j].fecha_cierre;
          var deadline = new Date(fecha).getTime();
          var currentTime = new Date().getTime();
          var t = deadline - currentTime;
          var days = Math.floor(t / (1000 * 60 * 60 * 24));
          var hours = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
          var seconds = Math.floor((t % (1000 * 60)) / 1000);
          $('#day_3' + lista[j].subasta_id).html(days);
          $('#hour_3' + lista[j].subasta_id).html(hours);
          $('#minute_3' + lista[j].subasta_id).html(minutes);
          $('#second_3' + lista[j].subasta_id).html(seconds);
          if (t < 0) {
            clearInterval(x);
            $('#day_3' + lista[j].subasta_id).html(0);
            $('#hour_3' + lista[j].subasta_id).html(0);
            $('#minute_3' + lista[j].subasta_id).html(0);
            $('#second_3' + lista[j].subasta_id).html(0);
          }
        }, 1000);
      }
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas_' + lista[k].subasta_id).attr('onclick', 'detalle_subasta("' + lista[k].subasta_id + '")');
        var myP = $('#desc_' + lista[k].subasta_id);
        if (myP.text().length > 27) {
          myP.text(myP.text().substring(0, 24));
          $('#desc_' + lista[k].subasta_id).html(myP.text() + "...");
        }
      }
    }
  }
  //carga las subasta buscada
  function cargar_subastas_buscadas(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        var img = base_url + lista[i].photo;
        var tipo_subasta = ""
        var precio_subasta = 0
        var tipo_subasta_lista = null;
        if (lista[i].tipo_subasta == 1) {
          tipo_subasta_lista = 1;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100; color:#fff !important' class='badge badge-danger'> Directa</span>";
          precio_subasta = parseFloat(lista[i].valor_inicial).toFixed(2);

        } else {
          tipo_subasta_lista = 2;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100;' class='badge badge-danger'> Inversa</span>";
          precio_subasta = parseFloat(lista[i].intervalo[0].valor).toFixed(2);
          cadena_qty = lista[i].intervalo[0].cantidad;
        }
        cadena = cadena +
          "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas_buscar" +
          lista[i].subasta_id +
          "' onclick=''><div class='row'><div class='col-12'><h4 id='desc_" +
          lista[i].subasta_id +
          "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
          lista[i].nombre_espa +
          " </strong></h4> </div><div class='col-12'>" + tipo_subasta +
          "<div style='width:129.5px; height:129.5px'><img style='width:100%; position:relative' class='rounded' src='" +
          img +
          "' alt='Card image cap'></div><p id='body_footer_buscar" + lista[i].subasta_id +
          "' style='font-size:10px !important; text-align:center !important;' class='text-center'>Precio inicial <span style='margin-top:0px !important;margin-bottom:0px !important;  background: #80232b !important' class='badge badge-danger'>$" +
          precio_subasta +
          "</span></p></div></div></ons-card></ons-col>";

      }
      modal.hide();
      $('#area_autocomplete').append(cadena);
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas_buscar' + lista[k].subasta_id).attr('onclick', 'detalle_subasta("' + lista[k].subasta_id + '")');
        if (lista[k].tipo_subasta == 1) {
          var cadena_win = null;
          if (lista[k].user_win) {
            cadena_win =
              "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
              lista[k].user_win.name + " " + lista[k].user_win.surname +
              "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
              parseFloat(lista[k].puja_win.valor).toFixed(2) +
              "</span>";
          }
          if (cadena_win) {
            var cadena_nueva = "<br><span id='name_win_portada_buscar" + lista[k].subasta_id + "'>" + cadena_win +
              "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[k].ciudad.name_ciudad + "</span>";
            $('#body_footer_buscar' + lista[k].subasta_id).append(cadena_nueva);
          } else {
            var cadena_nueva =
              "<br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[k].ciudad.name_ciudad + "</span>";
            $('#body_footer_buscar' + lista[k].subasta_id).append(cadena_nueva);
          }

        } else {
          var cadena_qty = lista[k].intervalo[0].cantidad;
          var cadena_nueva_inversa = "<br><span> Cantidad disponible: " +
            cadena_qty +
            "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
            lista[k].ciudad.name_ciudad + "</span>";
          $('#body_footer_buscar' + lista[k].subasta_id).append(cadena_nueva_inversa);
        }

      }
    }
  }

  //funcion de respuesta cargar subastas
  function success_all_subastas(response) {
    var status = response.status;
    //  response = JSON.parse(response.lista);
    // var status = response.status;

    modal.hide();
    if (status == 200) {
      // $('#area_subastas').show();
      lista = response.lista;
      cargar_subastas(lista);
      $('#area_subastas').show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      navigator.notification.alert(
        'No hay subastas disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta para cargar las categorias de las subastas
  function success_all_subastas_categorias(response) {
    var status = response.status;
    //  response = JSON.parse(response.lista);
    // var status = response.status;
    modal.hide();
    if (status == 200) {
      // $('#area_subastas').show();
      lista = response.lista;
      cargar_subastas_categorias(lista);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay categorias disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion para buscar las subasta por palabra
  function buscar_palabra() {
    var compara = $("#autocomplete").val().trim();
    var tipo_seleccionada = $('#select_tipo_subasta').val();
    modal.show();
    $('#body_modal').text("Buscando subastas...");
    setTimeout(function () {
      var url = base_url + 'rest_subasta/buscar_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      comienza_buscar_subastas = 0;
      $('#area_autocomplete').empty();
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        buscar: compara,
        tipo: tipo_seleccionada,
        ubicacion: ubicacion_filter_subasta,
        comienza: comienza_buscar_subastas,
        ciudad: ciudad_filter_subasta,
        categoria: categoria_filter_subasta,
        subcategoria: subcategoria_filter_subasta
      };
      send_data_server(url, data_to_server, success_buscadas,
        error);
    }, 1000);


  }
  //infinito para subasta
  function infinito_buscar_palabra() {
    comienza_buscar_subastas = comienza_buscar_subastas + 11;
    var compara = $("#autocomplete").val().trim();
    var tipo_seleccionada = $('#select_tipo_subasta').val();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/buscar_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        buscar: compara,
        tipo: tipo_seleccionada,
        ubicacion: ubicacion_filter_subasta,
        comienza: comienza_buscar_subastas,
        ciudad: ciudad_filter_subasta,
        categoria: categoria_filter_subasta,
        subcategoria: subcategoria_filter_subasta
      };
      send_data_server(url, data_to_server, success_buscadas,
        error);
    }, 1000);
  }

  function infinito_buscar_palabra_anuncio() {
    comienza_buscar_anuncio = comienza_buscar_anuncio + 11;
    var compara = $("#autocomplete2").val().trim();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/buscar_anuncios';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        buscar: compara,
        ubicacion: ubicacion_filter_anuncio,
        comienza: comienza_buscar_anuncio,
        ciudad: ciudad_filter_anuncio,
        categoria: categoria_filter_anuncio,
        subcategoria: subcategoria_filter_anuncio
      };
      send_data_server(url, data_to_server, success_anuncios_buscados,
        error);
    }, 1000);
  }

  //funcion que busca los anuncios por palabra
  function buscar_palabra_anuncio() {
    var compara = $("#autocomplete2").val().trim();
    modal.show();
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/buscar_anuncios';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      comienza_buscar_anuncio = 0;
      $('#area_autocomplete_anuncio').empty();
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        buscar: compara,
        ubicacion: ubicacion_filter_anuncio,
        comienza: comienza_buscar_anuncio,
        ciudad: ciudad_filter_anuncio,
        categoria: categoria_filter_anuncio,
        subcategoria: subcategoria_filter_anuncio
      };
      send_data_server(url, data_to_server, success_anuncios_buscados,
        error);
    }, 1000);

  }
  //funcion que realiza la busqueda por categorias de la subastas
  function buscar_subastas(id) {
    pushPage('#appNavigator', 'categoria_subasta_filtro.html', '');
    modal.show();
    $('#body_modal').text("Cargando subastas");
    setTimeout(function () {
      var url = base_url + 'rest_subasta/cargar_subastas2';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: 0,
        limite: 200,
        id: id
      };
      send_data_server(url, data_to_server, success_all_subastas_categorias,
        error);
    }, 1000);
  }
  //funcion que realiza la busqueda por categorias de anuncios
  function buscar_anuncios(id) {
    pushPage('#appNavigator', 'categoria_anuncio_filtro.html', '');
    modal.show();
    $('#body_modal').text("Cargando anuncios...");
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/cargar_anuncio2';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: 0,
        limite: 200,
        id: id
      };
      send_data_server(url, data_to_server, success_all_anuncio_categorias,
        error);
    }, 1000);
  }
  //funcion de respuesta de cargar las subastas
  function success_buscadas(response) {

    var status = response.status;
    if (status == 200) {
      cargar_subastas_buscadas(response.lista);
    }
    if (status == 500) {
      modal.hide();
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      modal.hide();
      navigator.notification.alert(
        'No hay resultados en la busqueda', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta de los anuncios buscados
  function success_anuncios_buscados(response) {
    var status = response.status;
    if (status == 200) {
      lista = response.lista;
      cargar_anuncios_buscados(lista);
    }
    if (status == 500) {
      modal.hide();
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      modal.hide();
      navigator.notification.alert(
        '"No hay resultados en la busqueda.', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion para cargar el detalle de la subasta
  function detalle_subasta(id, valido) {
    if (!valido) {
      valido = 0;
    }
    pushPage('#appNavigator', 'detalle_subasta.html', '');
    modal.show();
    $('#body_modal').text("Cargando detalle de la subasta...");
    setTimeout(function () {
      var url = base_url + 'rest_subasta/detalle_subasta';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        id: id,
        subasta_user_id: valido
      };
      send_data_server(url, data_to_server, success_detalle_subasta,
        error);
    }, 1000);
  }
  //funcion de la respuesta del detalle de subasta
  function success_detalle_subasta(response) {
    console.log(response)
    modal.hide();
    $('#name_win').empty();
    // response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      // $('#area_detalle_subasta').show();
      subasta_activa_pay = response.detalle.subasta_id;
      var precio_inicial_subasta = 0;
      var fecha_cierre_subasta = null;
      var stock_inversa = 0;
      if (response.detalle.tipo_subasta == 1) {
        fecha_cierre_subasta = response.detalle.fecha_cierre;
        precio_inicial_subasta = parseFloat(response.detalle.valor_inicial).toFixed(2);
        precio_payment = parseFloat(response.detalle.valor_pago).toFixed(2);
        detalle_inicial_subasta = response.detalle.nombre_espa;
        tipo_inicial_subasta = 1;
        var tipo_subasta_name =
          "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100;' class='badge badge-danger'> Directa</span>";
      } else {
        fecha_cierre_subasta = response.detalle.intervalo.fecha;
        precio_inicial_subasta = parseFloat(response.detalle.intervalo.valor).toFixed(2);
        precio_payment = precio_inicial_subasta;
        detalle_inicial_subasta = response.detalle.nombre_espa;
        tipo_inicial_subasta = 3;
        stock_inversa = response.detalle.intervalo.cantidad;
        var tipo_subasta_name =
          "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100;' class='badge badge-danger'> Inversa</span>";
      }
      var fecha_actual = new Date();
      var fecha_cierre = new Date(fecha_cierre_subasta);
      var resultado = fecha_cierre.getTime() > fecha_actual.getTime();
      subasta_id = response.detalle.subasta_id;
      if (response.subcategoria) {
        var subcategoriaSubasta = response.subcategoria.nombre;
      } else {
        var subcategoriaSubasta = "Todas";
      }

      $('#titulo_detalle').html(response.detalle.nombre_espa + tipo_subasta_name);
      $('#categoria_detalle').html("<span><i class='fa fa-tag' aria-hidden='true'></i> " + response.categoria
        .name_espa +
        "</span>&nbsp|&nbsp" + subcategoriaSubasta +
        "<br><span><i class='fa fa-map-marker' aria-hidden='true'></i> " + response.ciudad
        .name_ciudad +
        "</span> ");
      $('#descripcion_detalle').html(response.detalle.descrip_espa);
      if (stock_inversa > 0 && !response.detalle.wim_inversa) {
        $('#descripcion_detalle').after("Cantidad disponible: " + stock_inversa + "<br>");
      }
      $('#entrada_detalle').text("Valor de entrada: $" + parseFloat(response.detalle.valor_pago).toFixed(2));
      if (tipo_inicial_subasta == 3) {
        if (response.detalle.wim_inversa) {
          $('#inicial_detalle').text("Adquirida: $" + parseFloat(response.detalle.wim_inversa.valor).toFixed(2));
        } else {
          $('#inicial_detalle').text("Precio: $" + precio_inicial_subasta);
        }

      } else {
        $('#inicial_detalle').text("Precio inicial: $" + precio_inicial_subasta);
      }
      $('#cierre_detalle').text("Fecha de cierre: " + fecha_cierre_subasta);
      if (resultado) {
        var cronometro =
          "<div class='col-12'><div class='timer'><div class='timer conte'><span class='days'  id='day_2" +
          response.detalle.subasta_id +
          "'></span></div><div class='smalltext'>Dias</div></div><div class='timer'><div class='timer conte'><span class='hours' id='hour_2" +
          response.detalle.subasta_id +
          "'></span></div><div class='smalltext'>Horas</div></div><div class='timer'><div class='timer conte'><span class='minutes' id='minute_2" +
          response.detalle.subasta_id +
          "'></span></div><div class='smalltext'>Minutos</div></div><div class='timer'><div class='timer conte'><span class='seconds' id='second_2" +
          response.detalle.subasta_id +
          "'></span></div><div class='smalltext'>Segundos</div></div></div>";
      }

      var imagen1 = base_url + response.detalle.photo;
      valor_inicial = response.detalle.valor_inicial;
      valor_pago = response.detalle.valor_pago;
      //slider
      var slider =
        "<ons-carousel-item><img style='width:100%' src='" +
        imagen1 + "'></ons-carousel-item>";
      if (response.foto_object.length > 0) {
        for (let i = 0; i < response.foto_object.length; i++) {
          if (response.foto_object[i].url_photo.indexOf("upload") >= 0) {
            imagen2 = base_url + response.foto_object[i].url_photo;
          } else {
            imagen2 = response.foto_object[i].url_photo;
          }
          slider = slider +
            "<ons-carousel-item><img style='width:100%' src='" +
            imagen2 + "'></ons-carousel-item>";
        }
      }
      $('#carousel_subasta').append(slider);
      if (resultado) {
        $('#cierre_detalle').after(cronometro);
      }
      if (resultado) {
        if (response.subasta_user) {
          if (!response.puja_user.valor) {
            if (!response.user_win) {
              $('#name_win').empty();
              var cadena_win =
                "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> Subasta anuncio <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                parseFloat(response.detalle.valor_inicial).toFixed(2) +
                "</span>";
              $('#name_win').append(cadena_win);
              $('#win_subasta').show();
            } else {
              if (response.user_win) {
                $('#name_win').empty();
                var cadena_win =
                  "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                  response.user_win.name + " " + response.user_win.surname +
                  " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                  parseFloat(response.puja_win.valor).toFixed(2) +
                  "</span>";
                $('#name_win').append(cadena_win);
                $('#win_subasta').show();
              }
            }
            $('#pujar_subasta').show();
          } else {
            if (response.user_win) {
              $('#name_win').empty();
              var cadena_win =
                "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                response.user_win.name + " " + response.user_win.surname +
                " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                parseFloat(response.puja_win.valor).toFixed(2) +
                "</span>";
              $('#name_win').append(cadena_win);
              $('#win_subasta').show();
            }
            if (response.puja_win.valor > response.puja_user.valor) {
              $('#pujar_subasta').show();
            } else {
              $('#pujar_subasta').hide();
            }

          }
        } else {
          if (response.user_win) {
            $('#name_win').empty();
            var cadena_win =
              "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
              response.user_win.name + " " + response.user_win.surname +
              " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
              parseFloat(response.puja_win.valor).toFixed(2) +
              "</span>";
            $('#name_win').append(cadena_win);
            $('#win_subasta').show();
          }
        }
      } else {
        if (response.user_win) {
          $('#name_win').empty();
          var cadena_win =
            "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
            response.user_win.name + " " + response.user_win.surname +
            " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
            parseFloat(response.puja_win.valor).toFixed(2) +
            "</span>";
          $('#name_win').append(cadena_win);
          $('#win_subasta').show();
        }
      }

      if (resultado) {
        var x = setInterval(function () {
          var fecha = fecha_cierre_subasta;
          var deadline = new Date(fecha).getTime();
          var currentTime = new Date().getTime();
          var t = deadline - currentTime;
          var days = Math.floor(t / (1000 * 60 * 60 * 24));
          var hours = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
          var seconds = Math.floor((t % (1000 * 60)) / 1000);
          $('#day_2' + response.detalle.subasta_id).html(days);
          $('#hour_2' + response.detalle.subasta_id).html(hours);
          $('#minute_2' + response.detalle.subasta_id).html(minutes);
          $('#second_2' + response.detalle.subasta_id).html(seconds);
          if (t < 0) {
            clearInterval(x);
            $('#day_2' + response.detalle.subasta_id).html(0);
            $('#hour_2' + response.detalle.subasta_id).html(0);
            $('#minute_2' + response.detalle.subasta_id).html(0);
            $('#second_2' + response.detalle.subasta_id).html(0);
          }
        }, 1000);
      }
      if (!resultado) {
        $('#entrar_subasta').hide();
        $('#pujar_subasta').hide();
        $('#pagar_subasta_directa').hide();
      }
      $('#card_detalle_subasta').show();
      if (response.detalle.tipo_subasta == 1) {
        if (response.subasta_user == null) {
          $('#entrar_subasta').show();
        } else {
          $('#subasta_user_id').val(response.subasta_user.subasta_user_id);
          //  $('#pujar_subasta').show();
        }
      }
      if (stock_inversa > 0 && response.detalle.tipo_subasta == 2) {
        $('#pagar_subasta_directa').show();
      }
      if (response.puja) {
        monto = response.puja.valor;
      }
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay detalle de la subasta', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //modal entrar a la subasta
  function modal_entrar() {
    $('#modal_entrar').modal('show');
    $('#entrar').text("$" + parseFloat(valor_pago).toFixed(2));
  }
  //modal para pujar subasta
  function modal_pujar() {
    $('#modal_pujar').modal('show');;
    if (monto) {
      $('#valor_alto').text("$" + parseFloat(monto).toFixed(2));
    } else {
      $('#valor_alto').text("$" + parseFloat(valor_inicial).toFixed(2));
    }
  }
  //funcion de respuesta para la puja alta
  function success_alta(response) {
    // response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      if (response.object.valor != null) {
        var valor_user = response.object_user.valor;
        var valor_max = response.object.valor;
        if ((valor_user >= valor_max)) {
          $('#entrar_subasta').hide();
          $('#pujar_subasta').hide();
          if (response.object) {
            $('#inicial_detalle').text("$" + parseFloat(valor_max).toFixed(2));
            $('#inicial_detalle').css('font-size', '30px');
            $('#inicial_detalle').css('background', '#28a745');
          }
        } else {
          //$('#entrar_subasta').hide();
          $('#pujar_subasta').show();
          if (response.object) {
            if (response.object.valor > 0) {
              $('#inicial_detalle').text("$" + parseFloat(response.object.valor).toFixed(2));
              $('#inicial_detalle').css('font-size', '30px');
              $('#inicial_detalle').css('background', '#28a745');
            }
          }
        }
      } else {
        $('#pujar_subasta').show();
      }
    }
  }
  //pagar entrada de la subasta
  function pagar_entrada() {
    modal.show();
    $('#body_modal').text("Realizando pago")
    setTimeout(function () {
      var url = base_url + 'rest_subasta/entrar_subasta';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id: subasta_id
      };
      send_data_server(url, data_to_server, success_pagar_entrada,
        error);
    }, 1000);
  }

  //funcion de la respuesta de pagar la entrada de la subasta
  function success_pagar_entrada(response) {
    modal.hide();
    response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      $('#subasta_user_id').val(response.object.subasta_user_id);
      navigator.notification.alert(
        'Ya puedes comenzar a pujar en la subasta', // message
        llamar_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
      $('#entrar_subasta').hide();
      $('#pujar_subasta').show();
      if (response.puja) {
        $('#inicial_detalle').text(response.puja.valor);
        $('#inicial_detalle').css('font-size', '30px');
        $('#inicial_detalle').css('background', '#28a745');
      }
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No se realizo el pago', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que ejecuta el cambio de password
  function change_password() {
    $("#success-password").hide();
    $("#error-password").hide();
    var old_password = $("#password_actual").val();
    var password = $("#password_perfil").val();
    var repeta_password = $("#repeat_password_perfil").val();
    if (old_password.trim().length > 0) {
      if (password.trim().length > 0) {
        if (password.trim() == repeta_password.trim()) {
          var item_auth = get_data_local();
          if (!item_auth) {
            cerrar_session();
          } else {
            if (item_auth.user_id == 0) {
              cerrar_session();
            }
          }
          modal.show();
          $('#body_modal').text("Cambiando contraseña");
          setTimeout(function () {
            var url = base_url + 'rest_user/change_password';
            var puser_id = item_auth.user_id;
            var security_token = item_auth.security_token;
            data_to_server = {
              user_id: puser_id,
              security_token: security_token,
              old_password: old_password,
              new_password: password
            };
            send_data_server(url, data_to_server, success_password,
              error);
          }, 1000);
        } else {
          navigator.notification.alert(
            'La contraseña nueva y su repetición no coinciden', // message
            alertDismissed1, // callback
            'Información', // title
            'Aceptar' // buttonName
          );
        }
      } else { //email requerido
        navigator.notification.alert(
          'La contraseña nueva no puede esta vacía', // message
          alertDismissed1, // callback
          'Información', // title
          'Aceptar' // buttonName
        );
      }
    } else { //el campo nombre se ha quedado vacío
      navigator.notification.alert(
        'La contraseña anterior no puede esta vacía', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta de la actualizacion del password
  function success_password(response) {
    modal.hide();
    var status = response.status;
    if (status == 404) { // si existe error de autenticación
      cerrar_session();
    } else if (status == 500) { //no coincide la contraseña anterior
      navigator.notification.alert(
        'La contraseña anterior no coincide', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else {
      var token = response.token;
      var item_auth = get_data_local();
      save_data_local(item_auth.user_id, item_auth.email, token, 2, item_auth.name, item_auth.photo, item_auth.phone,
        item_auth.cedula);
      cargar_datos_perfil();
      $("#old_password").val("");
      $("#password").val("");
      $("#repeat_password").val("");
      navigator.notification.alert(
        'La contraseña ha sido cambiada correctamente', // message
        llamar_anuncios, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta para actualizar el perfil del cliente
  function change_user_data() {
    var nombre = $("#name_perfil").val();
    var cedula = $("#cedula_perfil").val();
    var phone = $("#phone_perfil").val();
    var apellido = $("#surname_perfil").val();
    var tipo_documento = $("#tipo_documento_perfil").val();
    if (nombre.trim().length > 0) {
      if (apellido.trim().length > 0) {
        if (cedula.trim().length > 0) {
          if (phone.trim().length > 0) {
            var item_auth = get_data_local();
            if (!item_auth) {
              cerrar_session();
            } else {
              if (item_auth.user_id == 0) {
                cerrar_session();
              }
            }
            //mandar a cambiar los datos de usuarios
            modal.show();
            $('#body_modal').text("Actualizando perfil del usuario.")
            setTimeout(function () {
              var url = base_url + 'rest_user/update_datos_perfil';
              var puser_id = item_auth.user_id;
              var security_token = item_auth.security_token;
              data_to_server = {
                user_id: puser_id,
                security_token: security_token,
                name: nombre,
                phone: phone,
                cedula: cedula,
                photo: imageURL,
                tipo_documento: tipo_documento,
                surname: apellido
              };
              send_data_server(url, data_to_server, success_update_user, error);
            }, 1000);
          } else {
            navigator.notification.alert(
              'El teléfono es requerido', // message
              alertDismissed1, // callback
              'Información', // title
              'Aceptar' // buttonName
            );
          }
        } else { //email requerido
          navigator.notification.alert(
            'La cédula/pasaporte es requerida', // message
            alertDismissed1, // callback
            'Información', // title
            'Aceptar' // buttonName
          );
        }
      } else {
        navigator.notification.alert(
          'El apellido es requerido', // message
          alertDismissed1, // callback
          'Información', // title
          'Aceptar' // buttonName
        );
      }
    } else { //el campo nombre se ha quedado vacío
      navigator.notification.alert(
        'El nombre es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta de la actualizacion del perfil del cliente
  function success_update_user(response) {
    modal.hide();
    var status = response.status;
    if (status == 404) { // si existe error de autenticación
      cerrar_session();
    }
    if (status == 200) {
      update_data_local(response.user_object.name, response.user_object.photo, response.user_object.phone, response
        .user_object.cedula, response.user_object.surname, response.user_object.tipo_documento);
      cargar_datos_perfil();
      navigator.notification.alert(
        'Los datos han sido actualizados correctamente', // message
        alertDismissed, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        response.msg, // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta para abrir la camara del phone
  function tomar_foto() {
    var srcType = Camera.PictureSourceType.CAMERA;
    var options = setOptions(srcType);
    options.targetHeight = 240;
    options.targetWidth = 240;
    navigator.camera.getPicture(function cameraSuccess(imageData) {
      displayImage(imageData);
      // You may choose to copy the picture, save it somewhere, or upload.
    }, function cameraError(error) {
      console.debug("No se puede obtener la foto: " + error, "app");
    }, options);
  }
  //funcion que se ejecuta luego de tomar la foto con la camara
  function setOptions(srcType) {
    var options = {
      // Some common settings are 20, 50, and 100
      quality: 100,
      destinationType: Camera.DestinationType.DATA_URL,
      // In this app, dynamically set the picture source, Camera or photo gallery
      sourceType: srcType,
      encodingType: Camera.EncodingType.JPEG,
      mediaType: Camera.MediaType.PICTURE,
      allowEdit: true,
      cameraDirection: 1
    }
    return options;
  }
  //funcion que muestra la foto tomada para el perfil del cliente
  function displayImage(imageData) {
    var elem = document.getElementById('foto_perfil_usuario');
    elem.src = "data:image/jpeg;base64," + imageData;
    // imageURL = "data:image/jpeg;base64," + imageData;
    imageURL = imageData;
  }
  //funcion de respuesta al cargar los anuncios en el home
  function success_all_anuncios(response) {
    console.log(response)
    var status = response.status;
    //  response = JSON.parse(response.lista);
    // var status = response.status;
    if (!response.infinito) {
      valida_infinito_anuncio = true;
    }
    modal.hide();
    if (status == 200) {
      // $('#area_subastas').show();
      lista = response.lista;
      cargar_anuncios(lista);
      $('#area_anuncios').show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      navigator.notification.alert(
        'No hay anuncios disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion de respuesta para cargar las categorias de los anuncios
  function success_all_anuncio_categorias(response) {
    var status = response.status;
    //  response = JSON.parse(response.lista);
    // var status = response.status;
    modal.hide();
    if (status == 200) {
      lista = response.lista;
      cargar_anuncios_categoria(lista);
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay anuncios disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que ejecuta cargar las categorias de anuncios
  function cargar_categorias_anuncios() {
    pushPage('#appNavigator', 'categoria_anuncios.html', '');
    modal.show();
    $('#body_modal').text("Cargando categorias...")
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/anuncio_categoria';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
      };
      send_data_server(url, data_to_server, success_anuncio_categoria,
        error);
    }, 1000);
  }
  //funcion que lista los anuncios
  function cargar_anuncios(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        if (lista[i].anuncio_photo.indexOf("upload") >= 0) {
          img = base_url + lista[i].anuncio_photo;
        } else {
          img = lista[i].anuncio_photo;
        }
        var ads_destacado = ""
        if (lista[i].destacado == 1) {
          ads_destacado =
            "<span style='background: #00bb2d !important;font-size:10px !important ;position:absolute; top:2%;z-index:100; color:#fff !important; class='badge badge-danger'><strong> Destacado</strong></span>";
        } else {
          ads_destacado = "";
        }
        cadena = cadena +
          "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas2_" +
          lista[i].anuncio_id +
          "' onclick=''><div class='row'><div class='col-12'><h4 id='titulo_anuncio_" +
          lista[i].anuncio_id +
          "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
          lista[i].titulo +
          " </strong></h4> </div><div class='col-12'>" + ads_destacado +
          "<div style='width:129.5px; height:129.5px'><img style='max-width:129.5px; position:relative; max-height:129.5px' class='rounded' src='" +
          img +
          "' alt='Card image cap'></div> <p class='text-center'><span style='margin-left:10% !important;margin-top:0px !important; background: #80232b !important' class='badge badge-danger'>$" +
          parseFloat(lista[i]
            .precio).toFixed(2) +
          "</span></p></div><div class='col-12' style='padding: 1px 1px 1px 1px !important;'><p style='font-size:10px !important; line-height:1.5px !important; margin-bottom:2px !important;text-align:center !important' class='card-text'>&nbsp<span></b><i class='fa fa-map-marker' aria-hidden='true'></i> " +
          lista[i].ciudad +
          "</b></span></p></div></div></ons-card></ons-col>";
      }
      $('#area_anuncios').append(cadena);
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas2_' + lista[k].anuncio_id).attr('onclick', 'detalle_anuncio("' + lista[k].anuncio_id + '")');
      }
    }
  }
  //funcion que lista los anuncios por categoria
  function cargar_anuncios_categoria(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        if (lista[i].anuncio_photo.indexOf("upload") >= 0) {
          img = base_url + lista[i].anuncio_photo;
        } else {
          img = lista[i].anuncio_photo;
        }
        cadena = cadena +
          "<ons-card id='ver_mas3_" +
          lista[i].anuncio_id +
          "' onclick=''><div class='row'><div class='col-4'><img style='width:100%' class='rounded' src='" +
          img +
          "' alt='Card image cap'> <p class='text-center'><span style='margin-left:10% !important; background: #80232b !important' class='badge badge-danger'>$" +
          parseFloat(lista[i]
            .precio).toFixed(2) +
          "</span></p></div><div class='col-8' style='padding: 1px 1px 1px 1px !important;'><h4 id='titulo_anuncio3_" +
          lista[i].anuncio_id +
          "' style='font-size:16px !important; color:#80232b !important; line-height:1.5px !important; margin-top:15px !important;' class='card-title'><strong>" +
          lista[i].titulo +
          "</strong></h4> <p style='font-size:10px !important; line-height:1.5px !important;' class='card-text'><span><i class='fa fa-tag' aria-hidden='true'></i> " +
          lista[i].categoria +
          "/" + lista[i].subcategoria + "</span>&nbsp<span><i class='fa fa-map-marker' aria-hidden='true'></i> " +
          lista[i].ciudad +
          "</span></p><p style='font-size:12px !important;' class='card-text'>" + lista[i]
          .corta +
          "<span><i class='fa fa-whatsapp' aria-hidden='true'></i> " +
          lista[i]
          .whatsapp +
          " </span></p></div></div></ons-card>";
      }
      $('#area_anuncio_categoria').append(cadena);
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas3_' + lista[k].anuncio_id).attr('onclick', 'detalle_anuncio("' + lista[k].anuncio_id + '")');
        var myP = $('#titulo_anuncio3_' + lista[k].anuncio_id);
        if (myP.text().length > 27) {
          myP.text(myP.text().substring(0, 24));
          $('#titulo_anuncio3_' + lista[k].anuncio_id).html(myP.text() + "...");
        }
      }
    }
  }
  //funcion que lista los anuncios por busqueda
  function cargar_anuncios_buscados(lista) {
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        if (lista[i].anuncio_photo.indexOf("upload") >= 0) {
          img = base_url + lista[i].anuncio_photo;
        } else {
          img = lista[i].anuncio_photo;
        }
        var ads_destacado = ""
        if (lista[i].destacado == 1) {
          ads_destacado =
            "<span style='background: #00bb2d !important;font-size:10px !important ;position:absolute; top:2%;z-index:100; color:#fff !important; class='badge badge-danger'><strong> Destacado</strong></span>";
        } else {
          ads_destacado = "";
        }
        cadena = cadena +
          "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas3_" +
          lista[i].anuncio_id +
          "' onclick=''><div class='row'><div class='col-12'><h4 id='titulo_anuncio_" +
          lista[i].anuncio_id +
          "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
          lista[i].titulo +
          " </strong></h4> </div><div class='col-12'>" + ads_destacado +
          "<div style='width:129.5px; height:129.5px'><img style='max-width:129.5px; position:relative; max-height:129.5px' class='rounded' src='" +
          img +
          "' alt='Card image cap'></div> <p class='text-center'><span style='margin-left:10% !important;margin-top:0px !important; background: #80232b !important' class='badge badge-danger'>$" +
          parseFloat(lista[i]
            .precio).toFixed(2) +
          "</span></p></div><div class='col-12' style='padding: 1px 1px 1px 1px !important;'><p style='font-size:10px !important; line-height:1.5px !important; margin-bottom:2px !important;text-align:center !important' class='card-text'>&nbsp<span><b><i class='fa fa-map-marker' aria-hidden='true'></i> " +
          lista[i].ciudad +
          "</b></span></p></div></div></ons-card></ons-col>";
      }
      $('#area_autocomplete_anuncio').append(cadena);
      $('#area_autocomplete_anuncio').show();
      modal.hide();
      for (let k = 0; k < lista.length; k++) {
        $('#ver_mas3_' + lista[k].anuncio_id).attr('onclick', 'detalle_anuncio("' + lista[k].anuncio_id + '")');
      }
    }

  }
  //funcion que se ejecuta para ver el detalle del anuncio
  function detalle_anuncio(id) {
    $('#body_detalle_anuncio').hide();
    app.hideFromTemplate();
    pushPage('#appNavigator', 'detalle_anuncio.html', '');
    modal.show();
    $('#body_modal').text("Cargando detalle del anuncio...");
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/detalle_anuncio';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        id: id
      };
      send_data_server(url, data_to_server, success_detalle_anuncio,
        error);
    }, 1000);
  }
  //funcion que muestra el detalle del anuncio
  function success_detalle_anuncio(response) {
    modal.hide();
    // response = JSON.parse(response.data);
    var status = response.status;
    if (status == 200) {
      // $('#area_detalle_subasta').show();
      $('#titulo_detalle_anuncio').text(response.detalle.titulo);
      $('#categoria_detalle_anuncio').html("<span><i class='fa fa-tag' aria-hidden='true'></i> " + response.detalle
        .categoria +
        "|" + response.detalle.subcategoria +
        "</span>&nbsp;<br><span><i class='fa fa-map-marker' aria-hidden='true'></i> " + response.detalle
        .ciudad +
        "</span> ");
      $('#descripcion_detalle_anuncio').html(response.detalle.descripcion);
      $('#precio_anuncio').text("Precio: $" + parseFloat(response.detalle.precio).toFixed(2));
      $('#number_whatsaap').attr("href", "https://api.whatsapp.com/send?phone=593" + response.detalle.whatsapp);
      $('#whatsapp').html("<i class='fa fa-whatsapp' aria-hidden='true'></i> " + response.detalle.whatsapp + "");
      /* $('#inicial_detalle').text(" $" + parseFloat(response.detalle.valor_inicial).*/
      if (response.detalle.anuncio_photo.indexOf("upload") >= 0) {
        imagen1 = base_url + response.detalle.anuncio_photo;
      } else {
        imagen1 = response.detalle.anuncio_photo;
      }
      //slider
      var slider =
        "<ons-carousel-item><img style='width:100%' src='" +
        imagen1 + "'></ons-carousel-item>";
      if (response.foto_object.length > 0) {
        for (let i = 0; i < response.foto_object.length; i++) {
          if (response.detalle.anuncio_photo.indexOf("upload") >= 0) {
            imagen2 = base_url + response.foto_object[i].photo_anuncio;
          } else {
            imagen2 = response.foto_object[i].photo_anuncio;
          }
          slider = slider +
            "<ons-carousel-item><img style='width:100%' src='" +
            imagen2 + "'></ons-carousel-item>";
        }
      }
      //$('.carousel-indicators').html(peq);
      $('#carousel_anuncio').append(slider);
      lat = response.detalle.lat;
      lng = response.detalle.lng;
      mapa =
        " <iframe width='280' height='170'frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='https://maps.google.com/maps?q=" +
        lat + "," + lng + "&hl=es&z=14&amp;output=embed'></iframe>";
      $('#map').html(mapa);
      getReverseGeocodingData(lat, lng);
      $('#body_detalle_anuncio').show();
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No hay detalle del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que dadas la kongitud y latitud devuelve la direccion
  function getReverseGeocodingData(lat, lng) {
    var latlng = new google.maps.LatLng(lat, lng);
    // This is making the Geocode request
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({
      'latLng': latlng
    }, function (results, status) {
      if (status !== google.maps.GeocoderStatus.OK) {
        //  alert(status);
      }
      // This is checking to see if the Geoeode Status is OK before proceeding
      if (status == google.maps.GeocoderStatus.OK) {
        var address = (results[0].formatted_address);
        $('#direccion_anuncio').html("Direccion:<span>" + address + "</span>");
      }
    });
  }

  function editar_anuncio(obj) {
    obj = atob(obj);
    obj = JSON.parse(obj);
    ads_objet = obj;
    app.hideFromTemplate();
    document.querySelector('ons-navigator').bringPageTop('formulario_editar.html');
    //  pushPage('#appNavigator', 'formulario_editar.html', '');
    modal.show();
    $('#body_modal').text("Cargando anuncio...")
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/subcategorias';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        id: ads_objet.cate_anuncio_id
      };
      send_data_server(url, data_to_server, success_anuncio_subcategoria2,
        error);
    }, 1000);
  }
  //funcion que busca las categorias de los anuncios
  function publicar_anuncio(id) {
    app.hideFromTemplate();
    pushPage('#appNavigator', 'categoria_anuncios_publicar.html', '');
    modal.show();
    $('#body_modal').text("Cargando categorias...")
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/anuncio_categoria';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        anuncio_id: id
      };
      send_data_server(url, data_to_server, success_anuncio_categoria2,
        error);
    }, 1000);
  }
  //funcion para cargar las subcategorias en editar
  function siguiente_update_cat() {
    buscar_subcategoria(categoria_update);
    valida_categoria_update = true;
  }
  //funcion que busca las subcategorias para los anuncios
  function buscar_subcategoria(id) {
    /*    if (id == categoria_update) {
         valida_categoria_update = true;
       } */
    array_fotos = [];
    pushPage('#appNavigator', 'subcategorias.html', '');
    modal.show();
    $('#body_modal').text("Cargando subcategorias...");
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/subcategorias';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        id: id
      };
      send_data_server(url, data_to_server, success_anuncio_subcategoria,
        error);
    }, 1000);
  }
  //funcion que carga el formulario del anuncio
  function cargarFormEditar(lista) {
    $('#label_titulo_edit').addClass('active');
    $('#label_descripcion_edit').addClass('active');
    $('#label_phone_edit').addClass('active');
    $('#label_precio_edit').addClass('active');
    $('#titulo_publicar_edit').val("");
    $('#descripcion_publicar_edit').val("");
    $('#phone_publicar_edit').val("");
    $('#precio_publicar_edit').val("");
    $('#titulo_publicar_edit').val(ads_objet.titulo_completo);
    $('#descripcion_publicar_edit').val(ads_objet.descripcion);
    $('#phone_publicar_edit').val(ads_objet.whatsapp);
    $('#precio_publicar_edit').val(ads_objet.precio);
    var cadena_sub = '<ons-select style="margin-left:10%" id="select_subcategoria">';
    if (lista.length > 0) {
      lista.forEach(element => {
        cadena_sub += '<option value="' + element.subcate_id + '">' + element.nombre + '</option>'
      });
    }
    cadena_sub += '</ons-select>'
    $('#body_select_sub').html(cadena_sub);
    $('#select_subcategoria').val(ads_objet.subcate_id);
  }

  function cargar_formulario(id) {
    subcategoria = id;
    pushPage('#appNavigator', 'formulario.html', '');
    $('#titulo_publicar').val("");
    $('#descripcion_publicar').val("");
    $('#phone_publicar').val("");
    $('#precio_publicar').val("");
    modal.show();
    $('#body_modal').text("Cargando...");
    setTimeout(function () {
      modal.hide();
    }, 1000);
  }

  function siguiente_edit() {
    titulo_publicar = $('#titulo_publicar_edit').val();
    descripcion_publicar = $('#descripcion_publicar_edit').val();
    phone_publicar = $('#phone_publicar_edit').val();
    precio_publicar = $('#precio_publicar_edit').val();
    subcategoria_update = $('#select_subcategoria').val();
    if (titulo_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El titulo del anuncio es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (descripcion_publicar.trim().length == 0) {
      navigator.notification.alert(
        'La descripción del anuncio es requerida', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (phone_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El telefono de contacto es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (precio_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El precio del anuncio es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else {
      // document.querySelector('ons-navigator').bringPageTop('galeria.html');
      pushPage('#appNavigator', 'galeria.html', '');
      modal.show();
      $('#body_modal').text("Cargando...");
      $('#galeria_imagen').empty();
      setTimeout(function () {
        array_fotos=[];
        if (ads_objet) {
          if (array_fotos.length == 0) {
            var img_data = base_url + ads_objet.anuncio_photo;
            var img =
              "<div id='" + contador_fotos_id +
              "' class='col-4' style='margin-bottom:2px !important;'><img src='" +
              img_data +
              "' style='width: 80px; height: 80px;'><ons-button id='" + contador_fotos_id +
              "' onclick='deleteItem(this)' modifier='quiet' ripple style='position: absolute; right:10px'><ons-icon style='color:#80232b; font-size:20px' icon='md-delete'></ons-icon></ons-button></div>";
            $('#galeria_imagen').append(img);
                var contador_fotos_cargadas = 2;
            array_fotos.push({
              "id": contador_fotos_id,
              "imagen": ads_objet.anuncio_photo,
              'foto_anuncio_id': ads_objet.anuncio_id,
              'name':'image_1'
            });
            contador_fotos_id++;
            if (ads_objet.fotos) {
              if (ads_objet.fotos.length > 0) {
                contador = ads_objet.fotos.length;
                var contador_fotos_cargadas = 2;
                for (let i = 0; i < ads_objet.fotos.length; i++) {
                  var img_data = base_url + ads_objet.fotos[i].photo_anuncio;
                  var id_cargado = contador_fotos_cargadas;
                     var cadena_name_cargada = "image_" + id_cargado;
                  var img =
                    "<div id='" + contador_fotos_id +
                    "' class='col-4' style='margin-bottom:2px !important;'><img src='" +
                    img_data +
                    "' style='width: 80px; height: 80px;'><ons-button id='" + contador_fotos_id +
                    "' onclick='deleteItem(this)' modifier='quiet' ripple style='position: absolute; right:10px'><ons-icon style='color:#80232b; font-size:20px' icon='md-delete'></ons-icon></ons-button></div>";
                  $('#galeria_imagen').append(img);
                  contador_fotos_cargadas++;
                  array_fotos.push({
                    "id": contador_fotos_id,
                    "imagen": ads_objet.fotos[i].photo_anuncio,
                    'foto_anuncio_id': ads_objet.fotos[i].photo_anuncio_id,
                    'name':cadena_name_cargada
                  });
                  contador_fotos_id++;
                }
              }
            }
          }

        }

        if (array_fotos.length > 0) {
          console.log(array_fotos);
          $('#btn_siguiente2').show();
        }
        modal.hide();
      }, 3000);
    }
  }
  //funcion que ejecuta para darle paso a la continuacion de la creacion del anuncio
  function siguiente() {
    titulo_publicar = $('#titulo_publicar').val();
    descripcion_publicar = $('#descripcion_publicar').val();
    phone_publicar = $('#phone_publicar').val();
    precio_publicar = $('#precio_publicar').val();
    if (titulo_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El titulo del anuncio es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (descripcion_publicar.trim().length == 0) {
      navigator.notification.alert(
        'La descripción del anuncio es requerida', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (phone_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El telefono de contacto es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else if (precio_publicar.trim().length == 0) {
      navigator.notification.alert(
        'El precio del anuncio es requerido', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    } else {
      pushPage('#appNavigator', 'galeria.html', '');
      modal.show();
      $('#galeria_imagen').empty();
      $('#body_modal').text("Cargando...");
      setTimeout(function () {
        if (array_fotos.length > 0) {
          $('#btn_siguiente2').show();
        }
        modal.hide();
      }, 1000);
    }
  }
  //funcion que se ejecuta para obtener imgenes de la galeria del telefono
  function getImage() {
    if (array_fotos.length < 4) {
      var srcType = Camera.PictureSourceType.SAVEDPHOTOALBUM;
      var options = setOptions(srcType);
      //var func = createNewFileEntry;
      options.targetHeight = 1936;
      options.targetWidth = 1936;
      navigator.camera.getPicture(function cameraSuccess(imageUri) {
        uploadPhoto(imageUri);
        // Do something with image
      }, function cameraError(error) {
        console.debug("Unable to obtain picture: " + error, "app");
      }, options);
    } else {
      navigator.notification.alert(
        'Ya alcanzo el límite de imagenes', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }

  ////funcion que muestra las fotos de la galeria
  function uploadPhoto(imageURI) {
    imagen = imageURI;
    array_fotos.push({
      "id": contador_fotos_id,
      "imagen": "data:image/jpeg;base64," + imagen,
      'foto_anuncio_id': null
    });
    var img =
      "<div id='" + contador_fotos_id +
      "' class='col-4' style='margin-bottom:2px !important;'><img src='data:image/jpeg;base64," +
      imagen +
      "' style='width: 80px; height: 80px;'><ons-button id='" + contador_fotos_id +
      "' onclick='deleteItem(this)' modifier='quiet' ripple style='position: absolute; right:10px'><ons-icon style='color:#80232b; font-size:20px' icon='md-delete'></ons-icon></ons-button></div>";
    $('#galeria_imagen').append(img);
    // $('#img_load').show();
    //$('#img_load').attr('src', imagen);
    contador_fotos_id++;
    if (array_fotos.length > 0) {
      $('#btn_siguiente2').show();
    }
  };
  //funcion que se ejecuta al tomar una foto con la camara del phone
  function tomar_foto2() {
    if (array_fotos.length < 4) {
      var srcType = Camera.PictureSourceType.CAMERA;
      var options = setOptions2(srcType);
      options.targetHeight = 1936;
      options.targetWidth = 1936;
      navigator.camera.getPicture(function cameraSuccess(imageData) {
        displayImage2(imageData);
        // You may choose to copy the picture, save it somewhere, or upload.
      }, function cameraError(error) {
        console.debug("No se puede obtener la foto: " + error, "app");
      }, options);
    } else {
      navigator.notification.alert(
        'Ya alcanzo el límite de imagenes', // message
        alertDismissed1, // callback
        'Información', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta luego de tomar una foto para la galeria del anuncio
  function setOptions2(srcType) {
    var options = {
      // Some common settings are 20, 50, and 100
      quality: 100,
      destinationType: Camera.DestinationType.DATA_URL,
      // In this app, dynamically set the picture source, Camera or photo gallery
      sourceType: srcType,
      encodingType: Camera.EncodingType.JPEG,
      mediaType: Camera.MediaType.PICTURE,
      allowEdit: true,
      cameraDirection: 1
    }
    return options;
  }
  //funcion que muestra las fotos de la galeria
  function displayImage2(imageData) {

    array_fotos.push({
      "id": contador_fotos_id,
      "imagen": "data:image/jpeg;base64," + imageData,
      'foto_anuncio_id': null
    });
    var img = "<div id='" + contador_fotos_id +
      "' style='margin-bottom:2px !important;' class='col-4'><img src='data:image/jpeg;base64," +
      imageData +
      "' style='width: 80px; height: 80px;'><ons-button  onclick='deleteItem(this)' modifier='quiet' ripple style='position: absolute; right:10px'><ons-icon style='color:#80232b; font-size:20px' icon='md-delete'></ons-icon></ons-button></div>";

    $('#galeria_imagen').append(img);
    contador_fotos_id++;
    if (array_fotos.length > 0) {
      $('#btn_siguiente2').show();
    }


  }
  //funcion que borra los item de la galeria de las fotos pertenecientes al anuncio
  function deleteItem(e) {
    let id = $(e.parentElement).attr('id');
    $(e.parentElement).remove();
    let indice = -1;
    //eliminar del array inicio
    if (array_fotos) {
      if (array_fotos.length > 0) {
        for (var i = 0; i < array_fotos.length; i++) {
          if (id == array_fotos[i].id) {
            indice = i;
          }
        }
      }
      if (indice != -1) {
        array_fotos.splice(indice, 1)
      }
    }
    if (array_fotos.length == 0) {
      $('#btn_siguiente2').hide();
    }
  }
  //ejecuta la ventana del mapa
  function siguiente2() {
    pushPage('#appNavigator', 'mapa.html', '');
    $('#body_modal').text("Cargando...");
    console.log(array_fotos);
    modal.show();
    if (ads_objet) {
      setTimeout(function () {
        cargar_mapa(ads_objet.lat, ads_objet.lng);
        modal.hide();
      }, 2500);
    } else {
      setTimeout(function () {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
        modal.hide();
      }, 2500);
    }
  }
  //funcion para carga la unbicacion
  function ubicacion_actual() {
    modal.show();
    $('#body_modal').text("Cargando ...");
    setTimeout(function () {
      $('#mapa').empty();
      mapa = null;
      navigator.geolocation.getCurrentPosition(onSuccess, onError);
      modal.hide();
    }, 2500);
  }
  //funcion para cargar el mapa en el update anuncio
  function cargar_mapa(lat, lng) {
    $('#mapa').empty();
    search_city_2(lat, lng);
    //  $('#btn_update_map').show();
    $('#btn_culminar_anuncio').hide();
    $('#btn_actualizar_anuncio').show();
    var latlng = new google.maps.LatLng(lat, lng);
    // This is making the Geocode request
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({
      'latLng': latlng
    }, function (results, status) {
      if (status !== google.maps.GeocoderStatus.OK) {
        ///alert(status);
      }
      // This is checking to see if the Geoeode Status is OK before proceeding
      if (status == google.maps.GeocoderStatus.OK) {
        var direccion = (results[0].formatted_address);
        $('#pac-input').val(direccion);
        $.ajax({
          url: "https://maps.googleapis.com/maps/api/geocode/json?address=" + direccion +
            ",+EC&key=AIzaSyCxSjmDtXEki2dmimctXMPd5y-FQrZpGmQ",
          dataType: 'json',
          success: function (response) {
            var pos = {
              lat: parseFloat(response.results[0].geometry.location.lat),
              lng: parseFloat(response.results[0].geometry.location.lng)
            };
            var mapa = new google.maps.Map(document.getElementById('mapa'), {
              center: pos,
              scrollwheel: false,
              zoom: 13
            });
            var marker = new google.maps.Marker({
              position: pos,
              map: mapa,
              draggable: true
            });
            marker.addListener("dragend", function () {
              var currentLocation = marker.getPosition();
              var lat = currentLocation.lat(); //latitude
              var lng = currentLocation.lng(); //longitude
              search_city(lat, lng);
              getReverseGeocodingData2(lat, lng);
              $('#lat').val(lat);
              $('#lng').val(lng);
              mapa.setZoom(16);
              mapa.setCenter(currentLocation);

            });
            // Create the search box and link it to the UI element.
            var input = document.getElementById('pac-input');
            var searchBox = new google.maps.places.SearchBox(input);
            // map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
            $('#lat').val(pos.lat);
            $('#lng').val(pos.lng);
            // Bias the SearchBox results towards current map's viewport.
            mapa.addListener('bounds_changed', function () {
              searchBox.setBounds(mapa.getBounds());
            });
            var markers = [];
            // Listen for the event fired when the user selects a prediction and retrieve
            // more details for that place.
            searchBox.addListener('places_changed', function () {
              var places = searchBox.getPlaces();
              if (places.length == 0) {
                return;
              }
              // Clear out the old markers.
              markers.forEach(function (marker) {
                marker.setMap(null);
              });
              //  marker = [];
              // For each place, get the icon, name and location.
              var bounds = new google.maps.LatLngBounds();
              places.forEach(function (place) {
                if (!place.geometry) {
                  console.log("Returned place contains no geometry");
                  return;
                }
                var icon = {
                  url: "https://maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",
                  size: new google.maps.Size(71, 71),
                  origin: new google.maps.Point(0, 0),
                  anchor: new google.maps.Point(17, 34),
                  scaledSize: new google.maps.Size(25, 25)
                };
                if (marker === false) {
                  marker = new google.maps.Marker({
                    position: place.geometry.location,
                    map: mapa,
                    draggable: true //make it draggable
                  });
                } else {
                  marker.setPosition(place.geometry.location);
                }
                if (place.geometry.viewport) {
                  // Only geocodes have viewport.
                  bounds.union(place.geometry.viewport);
                } else {
                  bounds.extend(place.geometry.location);
                }
              });
              mapa.fitBounds(bounds);
              var currentLocation = marker.getPosition();
              var lat = currentLocation.lat(); //latitude
              var lng = currentLocation.lng(); //longitude
              $('#lat').val(lat);
              $('#lng').val(lng);
              search_city(lat, lng);
              getReverseGeocodingData2(lat, lng)
              google.maps.event.addListener(marker, 'dragend', function (event) {
                var currentLocation = marker.getPosition();
                var lat = currentLocation.lat(); //latitude
                var lng = currentLocation.lng(); //longitude
                $('#lat').val(lat);
                $('#lng').val(lng);
                search_city(lat, lng);
                getReverseGeocodingData2(lat, lng)
              });
            });
            //Listen for any clicks on the map.
            google.maps.event.addListener(mapa, 'click', function (event) {
              //Get the location that the user clicked.
              var clickedLocation = event.latLng;
              //If the marker hasn't been added.
              if (marker === false) {
                //Create the marker.
                marker = new google.maps.Marker({
                  position: clickedLocation,
                  map: mapa,
                  draggable: true //make it draggable
                });
                //Listen for drag events!
                google.maps.event.addListener(marker, 'dragend', function (event) {
                  // markerLocation();.
                  var currentLocation = marker.getPosition();
                  var lat = currentLocation.lat(); //latitude
                  var lng = currentLocation.lng(); //longitude

                });
              } else {
                //Marker has already been added, so just change its location.
                marker.setPosition(clickedLocation);
              }
              //Get the marker's location.
              markerLocation();
              //This function will get the marker's current location and then add the lat/long
              //values to our textfields so that we can save the location.
              function markerLocation() {
                //Get location.
                var currentLocation = marker.getPosition();
                var lat = currentLocation.lat(); //latitude
                var lng = currentLocation.lng(); //longitude
                var geocoder = new google.maps.Geocoder;
                var infowindow = new google.maps.InfoWindow;
                search_city(lat, lng);
                getReverseGeocodingData2(lat, lng);
                $('#lat').val(lat);
                $('#lng').val(lng);
              }
            });
            //getReverseGeocodingData2
            function getReverseGeocodingData2(lat, lng) {
              var latlng = new google.maps.LatLng(lat, lng);
              // This is making the Geocode request
              var geocoder = new google.maps.Geocoder();
              geocoder.geocode({
                'latLng': latlng
              }, function (results, status) {
                if (status !== google.maps.GeocoderStatus.OK) {
                  // alert(status);
                }
                // This is checking to see if the Geoeode Status is OK before proceeding
                if (status == google.maps.GeocoderStatus.OK) {
                  var seleccion_pais = null;
                  var address = (results[0].formatted_address);
                  var arrayDeCadenas = address.split(",");
                  var ciudad = results[0].address_components;
                  $('#pac-input').val(address);
                  if (arrayDeCadenas) {
                    if (arrayDeCadenas.length > 0) {
                      seleccion_pais = arrayDeCadenas[arrayDeCadenas.length - 1];
                    }
                  }
                  var nombre_pais = 'Ecuador';
                  if (nombre_pais != seleccion_pais.trim()) {
                    navigator.notification.alert(
                      'Lo sentimos solo estamos displonibes en Ecuador', // message
                      alertDismissed1, // callback
                      'Información', // title
                      'Aceptar' // buttonName
                    );
                    $('#pac-input').val("");
                    seleccion_pais = null;
                    modal.show();
                    setTimeout(function () {
                      cargar_mapa(anuncio_objecto.lat, anuncio_objecto.lng);
                      modal.hide();
                    }, 2500);

                  }
                }
              });
            }
            //search_city
            function search_city(lat, lng) {
              var latlng;
              latlng = new google.maps.LatLng(lat, lng); // New York, US
              new google.maps.Geocoder().geocode({
                'latLng': latlng
              }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  if (results[1]) {
                    var country = null,
                      countryCode = null,
                      city = null,
                      cityAlt = null;
                    var c, lc, component;
                    for (var r = 0, rl = results.length; r < rl; r += 1) {
                      var result = results[r];
                      if (!city && result.types[0] === 'locality') {
                        for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                          component = result.address_components[c];
                          if (component.types[0] === 'locality') {
                            city = component.long_name;
                            break;
                          }
                        }
                      } else if (!city && !cityAlt && result.types[0] ===
                        'administrative_area_level_1') {
                        for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                          component = result.address_components[c];
                          if (component.types[0] === 'administrative_area_level_1') {
                            cityAlt = component.long_name;
                            break;
                          }
                        }
                      } else if (!country && result.types[0] === 'country') {
                        country = result.address_components[0].long_name;
                        countryCode = result.address_components[0].short_name;
                      }
                      if (city && country) {
                        break;
                      }
                    }
                    $("#city_main").val(city);
                    // console.log("City: " + city + ", City2: " + cityAlt + ", Country: " + country + ", Country Code: " + countryCode);
                  }
                }
              });
            }
          }
        });
      }
    });
  }
  //funcion que se ejecuta para buscar la ciudad dando la latitud y longitud
  function search_city_2(lat, lng) {
    var latlng;
    latlng = new google.maps.LatLng(lat, lng);
    new google.maps.Geocoder().geocode({
      'latLng': latlng
    }, function (results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        if (results[1]) {
          var country = null,
            countryCode = null,
            city = null,
            cityAlt = null;
          var c, lc, component;
          for (var r = 0, rl = results.length; r < rl; r += 1) {
            var result = results[r];

            if (!city && result.types[0] === 'locality') {
              for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                component = result.address_components[c];

                if (component.types[0] === 'locality') {
                  city = component.long_name;
                  break;
                }
              }
            } else if (!city && !cityAlt && result.types[0] ===
              'administrative_area_level_1') {
              for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                component = result.address_components[c];
                if (component.types[0] === 'administrative_area_level_1') {
                  cityAlt = component.long_name;
                  break;
                }
              }
            } else if (!country && result.types[0] === 'country') {
              country = result.address_components[0].long_name;
              countryCode = result.address_components[0].short_name;
            }
            if (city && country) {
              break;
            }
          }
          $("#city_main").val(city);
          ubicacion_subasta = city
          // console.log("City: " + city + ", City2: " + cityAlt + ", Country: " + country + ", Country Code: " + countryCode);
        }
      }
    });
  }
  //funcion que busca en el mapa la ubicacion del mapa
  var onSuccess = function (position) {
    $('#mapa').empty();
    $('#btn_culminar_anuncio').show();
    $('#btn_actualizar_anuncio').hide();
    search_city_2(position.coords.latitude, position.coords.longitude);
    var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
    // This is making the Geocode request
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({
      'latLng': latlng
    }, function (results, status) {
      if (status !== google.maps.GeocoderStatus.OK) {
        // alert(status);
      }
      // This is checking to see if the Geoeode Status is OK before proceeding
      if (status == google.maps.GeocoderStatus.OK) {
        var direccion = (results[0].formatted_address);
        $('#pac-input').val(direccion);
        $.ajax({
          url: "https://maps.googleapis.com/maps/api/geocode/json?address=" + direccion +
            ",+EC&key=AIzaSyCxSjmDtXEki2dmimctXMPd5y-FQrZpGmQ",
          dataType: 'json',
          success: function (response) {
            var pos = {
              lat: parseFloat(response.results[0].geometry.location.lat),
              lng: parseFloat(response.results[0].geometry.location.lng)
            };
            var mapa = new google.maps.Map(document.getElementById('mapa'), {
              center: pos,
              scrollwheel: false,
              zoom: 13
            });
            var marker = new google.maps.Marker({
              position: pos,
              map: mapa,
              draggable: true
            });
            marker.addListener("dragend", function () {
              var currentLocation = marker.getPosition();
              var lat = currentLocation.lat(); //latitude
              var lng = currentLocation.lng(); //longitude
              search_city(lat, lng);
              getReverseGeocodingData2(lat, lng);
              $('#lat').val(lat);
              $('#lng').val(lng);
              mapa.setZoom(16);
              mapa.setCenter(currentLocation);

            });
            // Create the search box and link it to the UI element.
            var input = document.getElementById('pac-input');
            var searchBox = new google.maps.places.SearchBox(input);
            // map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
            $('#lat').val(pos.lat);
            $('#lng').val(pos.lng);
            // Bias the SearchBox results towards current map's viewport.
            mapa.addListener('bounds_changed', function () {
              searchBox.setBounds(mapa.getBounds());
            });
            var markers = [];
            // Listen for the event fired when the user selects a prediction and retrieve
            // more details for that place.
            searchBox.addListener('places_changed', function () {
              var places = searchBox.getPlaces();
              if (places.length == 0) {
                return;
              }
              // Clear out the old markers.
              markers.forEach(function (marker) {
                marker.setMap(null);
              });
              //  marker = [];
              // For each place, get the icon, name and location.
              var bounds = new google.maps.LatLngBounds();
              places.forEach(function (place) {
                if (!place.geometry) {
                  console.log("Returned place contains no geometry");
                  return;
                }
                var icon = {
                  url: "https://maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",
                  size: new google.maps.Size(71, 71),
                  origin: new google.maps.Point(0, 0),
                  anchor: new google.maps.Point(17, 34),
                  scaledSize: new google.maps.Size(25, 25)
                };
                if (marker === false) {
                  marker = new google.maps.Marker({
                    position: place.geometry.location,
                    map: mapa,
                    draggable: true //make it draggable
                  });
                } else {
                  marker.setPosition(place.geometry.location);
                }
                if (place.geometry.viewport) {
                  // Only geocodes have viewport.
                  bounds.union(place.geometry.viewport);
                } else {
                  bounds.extend(place.geometry.location);
                }
              });
              mapa.fitBounds(bounds);
              var currentLocation = marker.getPosition();
              var lat = currentLocation.lat(); //latitude
              var lng = currentLocation.lng(); //longitude
              $('#lat').val(lat);
              $('#lng').val(lng);
              search_city(lat, lng);
              getReverseGeocodingData2(lat, lng)
              google.maps.event.addListener(marker, 'dragend', function (event) {
                var currentLocation = marker.getPosition();
                var lat = currentLocation.lat(); //latitude
                var lng = currentLocation.lng(); //longitude
                $('#lat').val(lat);
                $('#lng').val(lng);
                search_city(lat, lng);
                getReverseGeocodingData2(lat, lng)
              });
            });
            //Listen for any clicks on the map.
            google.maps.event.addListener(mapa, 'click', function (event) {
              //Get the location that the user clicked.
              var clickedLocation = event.latLng;
              //If the marker hasn't been added.
              if (marker === false) {
                //Create the marker.
                marker = new google.maps.Marker({
                  position: clickedLocation,
                  map: mapa,
                  draggable: true //make it draggable
                });
                //Listen for drag events!
                google.maps.event.addListener(marker, 'dragend', function (event) {
                  // markerLocation();.
                  var currentLocation = marker.getPosition();
                  var lat = currentLocation.lat(); //latitude
                  var lng = currentLocation.lng(); //longitude

                });
              } else {
                //Marker has already been added, so just change its location.
                marker.setPosition(clickedLocation);
              }
              //Get the marker's location.
              markerLocation();
              //This function will get the marker's current location and then add the lat/long
              //values to our textfields so that we can save the location.
              function markerLocation() {
                //Get location.
                var currentLocation = marker.getPosition();
                var lat = currentLocation.lat(); //latitude
                var lng = currentLocation.lng(); //longitude
                var geocoder = new google.maps.Geocoder;
                var infowindow = new google.maps.InfoWindow;
                search_city(lat, lng);
                getReverseGeocodingData2(lat, lng);
                $('#lat').val(lat);
                $('#lng').val(lng);
              }
            });
            //getReverseGeocodingData2
            function getReverseGeocodingData2(lat, lng) {
              var latlng = new google.maps.LatLng(lat, lng);
              // This is making the Geocode request
              var geocoder = new google.maps.Geocoder();
              geocoder.geocode({
                'latLng': latlng
              }, function (results, status) {
                if (status !== google.maps.GeocoderStatus.OK) {
                  //  alert(status);
                }
                // This is checking to see if the Geoeode Status is OK before proceeding
                if (status == google.maps.GeocoderStatus.OK) {
                  var seleccion_pais = null;
                  var address = (results[0].formatted_address);
                  var arrayDeCadenas = address.split(",");
                  var ciudad = results[0].address_components;
                  $('#pac-input').val(address);
                  if (arrayDeCadenas) {
                    if (arrayDeCadenas.length > 0) {
                      seleccion_pais = arrayDeCadenas[arrayDeCadenas.length - 1];
                    }
                  }
                  var nombre_pais = 'Ecuador';
                  if (nombre_pais != seleccion_pais.trim()) {
                    navigator.notification.alert(
                      'Lo sentimos solo estamos displonibes en Ecuador', // message
                      alertDismissed1, // callback
                      'Información', // title
                      'Aceptar' // buttonName
                    );
                    $('#pac-input').val("");
                    seleccion_pais = null;
                    setTimeout(function () {
                      modal.show();
                      $('#mapa').empty();
                      mapa = null;
                      navigator.geolocation.getCurrentPosition(onSuccess, onError);
                      modal.hide();
                    }, 2500);

                  }
                }
              });
            }
            //search_city
            function search_city(lat, lng) {
              var latlng;
              latlng = new google.maps.LatLng(lat, lng); // New York, US
              new google.maps.Geocoder().geocode({
                'latLng': latlng
              }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  if (results[1]) {
                    var country = null,
                      countryCode = null,
                      city = null,
                      cityAlt = null;
                    var c, lc, component;
                    for (var r = 0, rl = results.length; r < rl; r += 1) {
                      var result = results[r];
                      if (!city && result.types[0] === 'locality') {
                        for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                          component = result.address_components[c];
                          if (component.types[0] === 'locality') {
                            city = component.long_name;
                            break;
                          }
                        }
                      } else if (!city && !cityAlt && result.types[0] ===
                        'administrative_area_level_1') {
                        for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                          component = result.address_components[c];
                          if (component.types[0] === 'administrative_area_level_1') {
                            cityAlt = component.long_name;
                            break;
                          }
                        }
                      } else if (!country && result.types[0] === 'country') {
                        country = result.address_components[0].long_name;
                        countryCode = result.address_components[0].short_name;
                      }
                      if (city && country) {
                        break;
                      }
                    }
                    $("#city_main").val(city);
                    // console.log("City: " + city + ", City2: " + cityAlt + ", Country: " + country + ", Country Code: " + countryCode);
                  }
                }
              });
            }
          }
        });
      }
    });
  };
  //error en la ubicacion del phone
  function onError(error) {
    modal.hide();
    navigator.notification.alert(
      'Ocurrio un error al obtener tu ubicación', // message
      pedir_ubicacion, // callback
      'Notificación', // title
      'Aceptar' // buttonName
    );
    /*  alert('code: ' + error.code + '\n' +
       'message: ' + error.message + '\n'); */
  }

  function pedir_ubicacion() {
    var init_lat = -1.831239;
    var init_lng = -78.18340599999999;
    cargar_mapa(init_lat, init_lng);
    // navigator.geolocation.getCurrentPosition(onSuccess, onError);
  }
  //funcion que se ejecuta al culminar anuncio
  function culminar_anuncio() {
    modal.show();
    $('#page_galeria').hide();
    $('#body_modal').text("Creando el anuncio...")
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/add';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      latidud = $('#lat').val();
      longitud = $('#lng').val();
      city = $('#city_main').val();
      direccion = $('#pac-input').val();
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        precio: precio_publicar,
        descripcion: descripcion_publicar,
        titulo: titulo_publicar,
        sub: subcategoria,
        phone: phone_publicar,
        lat: latidud,
        lng: longitud,
        city: city,
        direccion: direccion,
        'array': JSON.stringify(array_fotos)
      };
      send_data_server(url, data_to_server, success_add, error);
    }, 1000);
  }
  //funcion de respuesta de culminar_anuncio
  function success_add(response) {

    var status = response.status;
    if (status == 200) {
      valida_mis_anuncios = true;
      ads_objet = null;
      array_fotos = [];
      contador_fotos_id = 1
      $('#btn_culminar_anuncio').hide();
      $('#btn_actualizar_anuncio').hide();
      navigator.notification.alert(
        'Anuncio creado correctamente', // message
        mis_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrio un problema en la creación del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que se ejecuta al culminar anuncio
  function actualizar_anuncio() {
    modal.show();
    $('#page_galeria').hide();
    $('#body_modal').text("Actualizando el anuncio...")
    setTimeout(function () {
      var url = base_url + 'rest_anuncio/update';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      latidud = $('#lat').val();
      longitud = $('#lng').val();
      city = $('#city_main').val();
      direccion = $('#pac-input').val();
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        precio: precio_publicar,
        descripcion: descripcion_publicar,
        titulo: titulo_publicar,
        sub: subcategoria_update,
        phone: phone_publicar,
        lat: latidud,
        lng: longitud,
        city_main: city,
        direccion: direccion,
        anuncio_id: ads_objet.anuncio_id,
        'array': JSON.stringify(array_fotos)
      };
      send_data_server(url, data_to_server, success_update, error);
    }, 1000);
  }
  //funcion de respuesta de actualizar anuncio
  function success_update(response) {
    var status = response.status;
    if (status == 200) {
      ads_objet = null;
      array_fotos = [];
      contador_fotos_id = 1
      $('#btn_culminar_anuncio').hide();
      $('#btn_actualizar_anuncio').hide();
      /*  var array_nav_pages = document.querySelector('ons-navigator').pages;
      if(array_nav_pages.length >2){
      for (let i = 2; i < array_nav_pages.length; i++) {
      //  console.log( document.querySelector('ons-navigator').removePage(i));
        document.querySelector('ons-navigator').removePage(i);
      }
    } */
      valida_mis_anuncios = true;
      //  document.querySelector('ons-navigator').popPage({animation: "slide"});
      navigator.notification.alert(
        'Anuncio actualizado correctamente', // message
        mis_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'Ocurrio un problema en la actualización del anuncio', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que llama el home
  function llamar_anuncios() {
    // document.querySelector('ons-navigator').bringPageTop('home.html');
    window.location.href = 'dash.html';
  }

  function llamar_all() {
    document.querySelector('ons-navigator').resetToPage('tabbar.html');
    // window.location.href = 'dash.html';
  }
  //funcion de carga los anuncios del cliente

  function mis_anuncios() {

    modal.show();
    // alert(document.querySelector('ons-navigator').pages.length);
    /*     if (!valida_mis_anuncios) {
          pushPage('#appNavigator', 'mis_anuncios.html', '');
        } else {
          modal_notificacion.hide();
          document.querySelector('ons-navigator').bringPageTop('mis_anuncios.html');
        } */
    document.querySelector('ons-navigator').bringPageTop('mis_anuncios.html');
    $('#body_modal').text("Cargando mis anuncios...");
    $('#area_mis_anuncios').empty();
    var item_auth = get_data_local();
    //   console.log("entro en mis anuncios");

    setTimeout(function () {
      var url = base_url + 'rest_anuncio/cargar_mis_anuncios';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      comienza_mis_anuncios = 0;
      limite_mis_anuncios = 11;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza_mis_anuncios,
        limite: limite_mis_anuncios
      };
      send_data_server(url, data_to_server, success_mis_anuncios,
        error);
    }, 1000);


  }
  //funcion de respuesta al cargar los anuncios del cliente
  function success_mis_anuncios(response) {
    // Reset the whole stack instead of popping 1 page
    // document.querySelector('ons-navigator').resetToPage('dash.html');
    //  console.log(response);
    var status = response.status;
    //  response = JSON.parse(response.lista);
    // var status = response.status;
    if (status == 200) {
      // $('#area_subastas').show();
      lista = response.lista;
      cargar_mis_anuncios(lista);
      // $('#area_mis_anuncios').show();
    }
    if (status == 500) {
      modal.hide();
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      modal.hide();
      $('#area_mis_anuncios').empty();
      $('#area_mis_anuncios').html("<ons-col><h3 style='text-align: center;'>No tiene anuncios creados</h3></ons-col>");
      navigator.notification.alert(
        'No hay anuncios disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  //funcion que lista los anuncios
  function cargar_mis_anuncios(lista) {

    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        if (lista[i].anuncio_photo.indexOf("upload") >= 0) {
          img = base_url + lista[i].anuncio_photo;
        } else {
          img = lista[i].anuncio_photo;
        }
        var ads_destacado = ""
        if (lista[i].destacado == 1) {
          ads_destacado =
            "<span style='background: #00bb2d !important;font-size:10px !important ;position:absolute; top:2%;z-index:100; color:#fff !important; class='badge badge-danger'><strong> Destacado</strong></span>";
        } else {
          ads_destacado = "";
        }
        var visble_ads = ""
        if (lista[i].is_active == 1) {
          visble_ads = "<ons-icon  style='color:#2a3681'  size='16px, material:16px' icon='fa-eye'></ons-icon>"

        } else {
          visble_ads = "<ons-icon  style='color:#2a3681'  size='16px, material:16px' icon='fa-eye-slash'></ons-icon>";
        }
        cadena = cadena +
          "<ons-col width='50%'><ons-card onclick=acciones_anuncios('" + btoa(JSON.stringify(lista[i])) +
          "') style='height:220px !important' id='ver_mi_anuncio_" +
          lista[i].anuncio_id +
          "' onclick=''><div class='row'><div class='col-12'><h4 id='titulo_anuncio_" +
          lista[i].anuncio_id +
          "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
          lista[i].titulo +
          " </strong>" + visble_ads + " </h4></div><div class='col-12'>" +
          ads_destacado +
          "<div style='width:129.5px; height:129.5px'><img style='max-width:129.5px; position:relative; max-height:129.5px' class='rounded' src='" +
          img +
          "' alt='Card image cap'></div> <p class='text-center'><span style='margin-left:10% !important;margin-top:0px !important; background: #80232b !important' class='badge badge-danger'>$" +
          parseFloat(lista[i]
            .precio).toFixed(2) +
          "</span><br><span><i class='fa fa-map-marker' aria-hidden='true'></i> " +
          lista[i].ciudad +
          "</span></p></div></div></ons-card></ons-col>";

      }
      $('#area_mis_anuncios').append(cadena);
      $('#area_mis_anuncios').show();
      if (valida_mis_anuncios) {
        $('#btn_atras_ads').show();
        $('#btn_back_ads').hide();
      } else {
        $('#btn_atras_ads').hide();
        $('#btn_back_ads').show();
      }
      modal.hide();
    }
  }
  //infinito para los anuncios
  function infinito_mis_anuncio() {
    if (limite_mis_anuncios >= 11) {
      comienza_mis_anuncios = limite_mis_anuncios;
      limite_mis_anuncios = comienza_mis_anuncios + 11;
      setTimeout(function () {
        var url = base_url + 'rest_anuncio/cargar_mis_anuncios';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          comienza: comienza_mis_anuncios,
          limite: limite_mis_anuncios
        };
        send_data_server(url, data_to_server, success_mis_anuncios,
          error);
      }, 1000);

    }
  }
  //funcion que muestra el error
  function error(error) {
    console.log(error)
/*     if (error) {
      navigator.notification.alert(
        'Su conexión de internet no es suficientemente buena para realizar esta operación.', // message
        llamar_anuncios, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    } */
  }
  //alertDismissed1
  function alertDismissed1() {
    // do something
  }
  //alertDismissed1
  function alertDismissed() {
    // do something
  }

  function llamar_subasta_directa() {
    if (detalle_payment) {
      $('#entrar_subasta').hide();
      $('#pujar_subasta').show();
      modal_notificacion.hide();
    } else if (valida_piso_gratis) {
      $('#entrar_subasta').hide();
      $('#pujar_subasta').show();
      valida_piso_gratis = false;
      modal_notificacion.hide();
    } else {
      llamar_anuncios();
    }
  }

  function subasta_directa_pujar() {
    modal.show();
    $('#body_modal').text("Cargando...");
    setTimeout(function () {
      var url = base_url + 'rest_subasta/puja_alta';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id: subasta_id
      };
      send_data_server(url, data_to_server, success_prepare_puja,
        error);
    }, 1000);

  }

  function success_prepare_puja(response) {
    modal.hide();
    var status = response.status;
    if (status == 200) {
      if (response.subasta_user) {
        if (!response.user_win) {
          puja_mayor = parseFloat(response.subasta.valor_inicial).toFixed(2);
          $('#name_win_puja').empty();
          var cadena_win =
            "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-user'></i> Subasta anuncio <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
            parseFloat(response.subasta.valor_inicial).toFixed(2) +
            "</span> <i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i>";
          $('#name_win_puja').append(cadena_win);

        } else {
          if (response.user_win) {
            puja_mayor = parseFloat(response.puja_win.valor).toFixed(2);
            $('#name_win').empty();
            var cadena_win =
              "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-user'></i> " +
              response.user_win.name + " " + response.user_win.surname +
              " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
              parseFloat(response.puja_win.valor).toFixed(2) +
              "</span> <i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i>";
            $('#name_win_puja').append(cadena_win);

          }
        }
        modal_puja_directa.show();
        valida_modal_open = true;
      } else {
        navigator.notification.alert(
          'Dispulpe ocurrio un error intente otra vez', // message
          cerrar_push, // callback
          'Notificación', // title
          'Aceptar' // buttonName
        );
      }
    }
  }

  function cancelar_puja() {
    modal_puja_directa.hide();
    valida_modal_open = false;
  }
  $('#valor_puja_directa').change(function () {
    var valor_puja_directa = $('#valor_puja_directa').val();
    if (puja_mayor > valor_puja_directa) {
      navigator.notification.alert(
        'El valor a pujar es menor a la puja mayor', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }

  })

  function cerrar_modal_load() {
    modal.hide();
  }

  function confirmar_puja() {

    modal.show();
    $('#body_modal').text("Cargando...");
    var valor_puja_directa = $('#valor_puja_directa').val().trim();
    valor_puja_directa = parseFloat(parseFloat(valor_puja_directa).toFixed(2));
    puja_mayor = parseFloat(parseFloat(puja_mayor).toFixed(2));
    if (puja_mayor > valor_puja_directa) {
      modal.hide();
      navigator.notification.alert(
        'El valor a pujar es menor a la puja mayor', // message
        cerrar_modal_load, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    } else {
      modal_puja_directa.hide();
      // modal.show();
      setTimeout(function () {
        var url = base_url + 'rest_subasta/pujar_user';
        var user_id = item_auth.user_id;
        var security_token = item_auth.security_token;
        var valor_pujado = $('#valor_puja').val();
        var subasta_user_id = $('#subasta_user_id').val();
        data_to_server = {
          user_id: user_id,
          security_token: security_token,
          subasta_id: subasta_id,
          subasta_user_id: subasta_user_id,
          valor: valor_puja_directa
        };
        send_data_server(url, data_to_server, success_pujar_user,
          error);
      }, 1000);
    }

  }

  document.addEventListener("backbutton", onBackKeyDown, false);

  function onBackKeyDown() {
    if (valida_mis_anuncios) {
      llamar_anuncios();
    }
    if (valido_mis_subastas) {
      llamar_anuncios();
    }
    if (validar_terminos_condiciones) {
      modal_confirmacion.hide();
    }
  }

  //funcion de carga los anuncios del cliente
  function mis_subastas() {
    if (!valido_mis_subastas) {
      pushPage('#appNavigator', 'mis_subastas.html', '');
    } else {
      modal_notificacion.hide();
      document.querySelector('ons-navigator').bringPageTop('mis_subastas.html');
    }

    modal.show();
    $('#body_modal').text("Cargando mis subastas...");
    $('#area_mis_subastas').empty();
    var item_auth = get_data_local();
    setTimeout(function () {
      var url = base_url + 'rest_subasta/cargar_mis_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      comienza_mis_subastas = 0;
      limite_mis_subastas = 11;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza_mis_subastas,
      };
      send_data_server(url, data_to_server, success_mis_subastas,
        error);
    }, 1000);

  }

  function success_mis_subastas(response) {
    var status = response.status;
    if (status == 200) {
      var lista_subastas = response.lista;
      cargar_mis_subastas(lista_subastas);
    }
    if (status == 500) {
      modal.hide();
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404 && !response.infinito) {
      $('#area_mis_subastas').empty();
      $('#area_mis_subastas').html("<ons-col><h3 style='text-align: center;'>No tiene subasta</h3></ons-col>");
      modal.hide();
      navigator.notification.alert(
        'No hay subastas disponible', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }

  function cargar_mis_subastas(lista) {
    modal.hide();
    var cadena = "";
    if (lista.length > 0) {
      for (var i = 0; i < lista.length; i++) {
        var img = base_url + lista[i].photo;
        var tipo_subasta = "";
        var precio_subasta = 0
        var tipo_subasta_lista = null;
        if (lista[i].tipo_subasta == 1) {
          var cadena_nueva = "";
          var cadena_win = null;
          if (lista[i].user_win) {
            cadena_win =
              "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
              lista[i].user_win.name + " " + lista[i].user_win.surname +
              "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
              parseFloat(lista[i].puja_win.valor).toFixed(2) +
              "</span>";
          }
          if (cadena_win) {
            cadena_nueva = "<br><span id='name_win_portada_" + lista[i].subasta_id + "'>" + cadena_win +
              "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[i].ciudad.name_ciudad + "</span>";
          } else {
            cadena_nueva =
              "<br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
              lista[i].ciudad.name_ciudad + "</span>";
          }
          tipo_subasta_lista = 1;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100; color:#fff !important' class='badge badge-danger'> Directa</span>";
          precio_subasta = parseFloat(lista[i].valor_inicial).toFixed(2);
          cadena = cadena +
            "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas_" +
            lista[i].subasta_id +
            "' onclick=detalle_subasta('" + lista[i].subasta_id +
            "')><div class='row'><div class='col-12'><h4 id='desc_" +
            lista[i].subasta_id +
            "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
            lista[i].nombre_espa +
            " </strong></h4> </div><div class='col-12'>" + tipo_subasta +
            "<div style='width:129.5px; height:129.5px'><img style='width:100%; position:relative' class='rounded' src='" +
            img +
            "' alt='Card image cap'></div><p id='body_footer_" + lista[i].subasta_id +
            "' style='font-size:10px !important; text-align:center !important;' class='text-center'>Precio inicial <span style='margin-top:0px !important;margin-bottom:0px !important;  background: #80232b !important' class='badge badge-danger'>$" +
            precio_subasta +
            "</span>" + cadena_nueva + "</p></div></div></ons-card></ons-col>";
        } else {
          tipo_subasta_lista = 2;
          tipo_subasta =
            "<span style='background: #00bb2d !important;font-size:10px !important; position:absolute; top:2%;z-index:100;' class='badge badge-danger'> Inversa</span>";
          precio_subasta = parseFloat(lista[i].intervalo.valor).toFixed(2);
          cadena = cadena +
            "<ons-col width='50%'><ons-card style='height:220px !important' id='ver_mas_" +
            lista[i].subasta_id + "_" + i +
            "' onclick=detalle_subasta('" + lista[i].subasta_id + "','" + lista[i].intervalo_subasta_id +
            "')><div class='row'><div class='col-12'><h4 id='desc_" +
            lista[i].subasta_id +
            "' style='font-size:12px !important; color:#80232b !important; line-height:1.5px !important; margin-top:2px !important;' class='card-title'><strong>" +
            lista[i].nombre_espa +
            " </strong></h4> </div><div class='col-12'>" + tipo_subasta +
            "<div style='width:129.5px; height:129.5px'><img style='width:100%; position:relative' class='rounded' src='" +
            img +
            "' alt='Card image cap'></div><p id='body_footer_" + lista[i].subasta_id + "_" + i +
            "' style='font-size:10px !important; text-align:center !important;' class='text-center'>Adquirida <span style='margin-top:0px !important;margin-bottom:0px !important;  background: #80232b !important' class='badge badge-danger'>$" +
            precio_subasta +
            "</span><br><span style='font-size:10px !important;><i style='color:#80232b !important;' class='fa fa-map-marker'></i> " +
            lista[i].ciudad.name_ciudad + "</span></p></div></div></ons-card></ons-col>";
        }

      }
      $('#area_mis_subastas').append(cadena);
      if (valido_mis_subastas) {
        $('#btn_atras_subasta').show();
        $('#btn_back_subasta').hide();
      } else {
        $('#btn_atras_subasta').hide();
        $('#btn_back_subasta').show();
      }
    }

  }

  function infinito_mis_subastas() {

    comienza_mis_subastas = comienza_mis_subastas + 11;
    setTimeout(function () {
      var url = base_url + 'rest_subasta/cargar_mis_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        comienza: comienza_mis_subastas,
      };
      send_data_server(url, data_to_server, success_mis_subastas,
        error);
    }, 1000);
  }

  //funcion de la respuesta de pujar
  function success_pujar_user(response) {
    modal.hide();
    var status = response.status;
    if (status == 200) {
      navigator.notification.alert(
        'Tu puja fue realizada con exito', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
      $('#pujar_subasta').hide();
      valida_modal_open = false;
      $('#name_win').empty();
      var cadena_win =
        "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-user'></i>" +
        response.user_win.name + " " + response.user_win.surname +
        " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
        parseFloat(response.object.valor).toFixed(2) +
        "</span> <i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i>";
      $('#name_win').append(cadena_win);
      $('#win_subasta').show();
      puja_mayor = parseFloat(response.object.valor).toFixed(2);
    }
    if (status == 300) {
      navigator.notification.alert(
        'Tu puja no se realizo exite un valor mas alto', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );


    }
    if (status == 500) {
      navigator.notification.alert(
        'No tiene acceso a la plataforma', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
    if (status == 404) {
      navigator.notification.alert(
        'No se realizo el pago', // message
        cerrar_push, // callback
        'Notificación', // title
        'Aceptar' // buttonName
      );
    }
  }
  let y = setInterval(function () {

    if ($('#area_mis_subastas').is(':visible')) {
      var url = base_url + 'rest_subasta/all_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token
      };
      send_data_server(url, data_to_server, success_all_directas,
        error);

      function success_all_directas(response) {
        var status = response.status;
        var lista = response.lista;
        if (status == 200) {
          for (let k = 0; k < lista.length; k++) {
            var cadena_win = null;
            if (lista[k].user_win) {
              cadena_win =
                "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
                lista[k].user_win.name + " " + lista[k].user_win.surname +
                "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
                parseFloat(lista[k].puja_win.valor).toFixed(2) +
                "</span>";
              if (cadena_win) {
                $('#name_win_portada_' + lista[k].subasta_id).empty();
                $('#name_win_portada_' + lista[k].subasta_id).append(cadena_win)
              }
            }
          }
        }

      }
    }
    if ($('#area_autocomplete').is(':visible')) {
      var url = base_url + 'rest_subasta/all_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token
      };
      send_data_server(url, data_to_server, success_all_directas,
        error);

      function success_all_directas(response) {
        var status = response.status;
        var lista = response.lista;
        if (status == 200) {
          for (let k = 0; k < lista.length; k++) {
            var cadena_win = null;
            if (lista[k].user_win) {
              cadena_win =
                "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
                lista[k].user_win.name + " " + lista[k].user_win.surname +
                "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
                parseFloat(lista[k].puja_win.valor).toFixed(2) +
                "</span>";
              if (cadena_win) {
                $('#name_win_portada_buscar' + lista[k].subasta_id).empty();
                $('#name_win_portada_buscar' + lista[k].subasta_id).append(cadena_win)
              }
            }
          }
        }

      }
    }
    if (document.querySelector('ons-tabbar').getActiveTabIndex() == 0) {
      var url = base_url + 'rest_subasta/all_subastas';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token
      };
      send_data_server(url, data_to_server, success_all_directas,
        error);

      function success_all_directas(response) {
        var status = response.status;
        var lista = response.lista;
        if (status == 200) {
          for (let k = 0; k < lista.length; k++) {
            var cadena_win = null;
            if (lista[k].user_win) {
              cadena_win =
                "<i style='color:#80232b !important;font-size:10px !important;' class='fa fa-trophy'></i> <span style='font-size:10px !important;'>" +
                lista[k].user_win.name + " " + lista[k].user_win.surname +
                "</span> <span style='background: #00bb2d !important;font-size:10px !important;' class='badge badge-danger'>$" +
                parseFloat(lista[k].puja_win.valor).toFixed(2) +
                "</span>";
              if (cadena_win) {
                $('#name_win_portada_' + lista[k].subasta_id).empty();
                $('#name_win_portada_' + lista[k].subasta_id).append(cadena_win)
              }
            }
          }
        }

      }
    }
    if (page_active == "page_detalle_subasta" && tipo_inicial_subasta == 1 && !valida_modal_open) {
      var url = base_url + 'rest_subasta/puja_alta';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id: subasta_id
      };
      send_data_server(url, data_to_server, success_pujar_mayor,
        error);

      function success_pujar_mayor(response) {
        var status = response.status;
        if (status == 200) {
          if (response.subasta_user) {
            if (!response.puja_user.valor) {
              if (!response.user_win) {
                $('#name_win').empty();
                var cadena_win =
                  "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> Subasta anuncio <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                  parseFloat(response.subasta.valor_inicial).toFixed(2) +
                  "</span>";
                $('#name_win').append(cadena_win);
                $('#win_subasta').show();
                puja_mayor = parseFloat(response.subasta.valor_inicial).toFixed(2);
              } else {
                if (response.user_win) {
                  $('#name_win').empty();
                  var cadena_win =
                    "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                    response.user_win.name + " " + response.user_win.surname +
                    " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                    parseFloat(response.puja_win.valor).toFixed(2) +
                    "</span>";
                  $('#name_win').append(cadena_win);
                  $('#win_subasta').show();
                  puja_mayor = parseFloat(response.puja_win.valor).toFixed(2);
                }
              }
            } else {
              if (response.user_win) {
                $('#name_win').empty();
                var cadena_win =
                  "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                  response.user_win.name + " " + response.user_win.surname +
                  " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                  parseFloat(response.puja_win.valor).toFixed(2) +
                  "</span>";
                $('#name_win').append(cadena_win);
                puja_mayor = parseFloat(response.puja_win.valor).toFixed(2);
                $('#win_subasta').show();
              }
              if (response.puja_win.valor > response.puja_user.valor) {
                $('#pujar_subasta').show()
              } else {
                $('#pujar_subasta').hide()
              }

            }

          }

        }
      }
    }
    if (valida_modal_open) {
      var url = base_url + 'rest_subasta/puja_alta';
      var user_id = item_auth.user_id;
      var security_token = item_auth.security_token;
      data_to_server = {
        user_id: user_id,
        security_token: security_token,
        subasta_id: subasta_id
      };
      send_data_server(url, data_to_server, success_pujar_mayor2,
        error);

      function success_pujar_mayor2(response) {
        var status = response.status;
        if (status == 200) {
          if (response.subasta_user) {
            if (!response.puja_user.valor) {
              if (!response.user_win) {
                $('#name_win_puja').empty();
                var cadena_win =
                  "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> Subasta anuncio <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                  parseFloat(response.subasta.valor_inicial).toFixed(2) +
                  "</span>";
                $('#name_win_puja').append(cadena_win);
                puja_mayor = parseFloat(response.subasta.valor_inicial).toFixed(2);
              } else {
                if (response.user_win) {
                  $('#name_win_puja').empty();
                  var cadena_win =
                    "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                    response.user_win.name + " " + response.user_win.surname +
                    " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                    parseFloat(response.puja_win.valor).toFixed(2) +
                    "</span>";
                  $('#name_win_puja').append(cadena_win);
                  puja_mayor = parseFloat(response.puja_win.valor).toFixed(2);
                }
              }
            } else {
              if (response.user_win) {
                $('#name_win_puja').empty();
                var cadena_win =
                  "<i style='color:#80232b !important;font-size:20px !important;' class='fa fa-trophy'></i> " +
                  response.user_win.name + " " + response.user_win.surname +
                  " <span style='background: #00bb2d !important;font-size:14px !important;' class='badge badge-danger'>$" +
                  parseFloat(response.puja_win.valor).toFixed(2) +
                  "</span>";
                $('#name_win_puja').append(cadena_win);
                puja_mayor = parseFloat(response.puja_win.valor).toFixed(2);

              }

            }

          }

        }
      }
    }
  }, 6000);
</script>
<style>
  #input_id::placeholder {
    color: white;
  }

  .subcat_filter_anuncio {
    color: #80232b
  }

  .cat_filter_anuncio {
    color: #80232b
  }

  .ciudad_filter_anuncio {
    color: #80232b
  }

  .subcat_filter_subasta {
    color: #80232b
  }

  .cat_filter_subasta {
    color: #80232b
  }

  .ciudad_filter_subasta {
    color: #80232b
  }

  #map {
    height: 100%;
  }

  ons-splitter-side[animation=overlay] {
    border-left: 1px solid #bbb;
  }

  /*onse*/
  :checked+.tabbar--material__button {
    background-color: transparent;
    color: #2a3681;
  }

  .tabbar--material__border {
    height: 2px;
    background-color: #80232b;
  }

  .progress-circular__primary {
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
    stroke: #80232b;
    transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .page__background {
    background-color: #ebebeb;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    box-sizing: border-box;
  }

  .back-button--material__icon {

    fill: #fff;

  }

  .strikethrough {
    position: relative;
  }

  .strikethrough:before {
    position: absolute;
    content: "";
    left: 0;
    top: 50%;
    right: 0;
    border-top: 1px solid;
    border-color: #8c1822;

    -webkit-transform: rotate(-10deg);
    -moz-transform: rotate(-10deg);
    -ms-transform: rotate(-10deg);
    -o-transform: rotate(-10deg);
    transform: rotate(-10deg);
  }
</style>